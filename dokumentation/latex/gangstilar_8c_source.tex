\hypertarget{gangstilar_8c_source}{}\section{gangstilar.\+c}
\label{gangstilar_8c_source}\index{styr/styr/gangstilar.\+c@{styr/styr/gangstilar.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ *        File: gangstilar.c}
00003 \textcolor{comment}{ *     Version: 1.0}
00004 \textcolor{comment}{ * Last edited: 18/5/2016 }
00005 \textcolor{comment}{ *     Authors: jenma421}
00006 \textcolor{comment}{ */} 
00007 
00008 \textcolor{preprocessor}{#include "\hyperlink{gangstilar_8h}{gangstilar.h}"}
00009 
\hypertarget{gangstilar_8c_source.tex_l00010}{}\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{00010} uint8\_t \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l} = 24; \textcolor{comment}{//längd på stödfas}
\hypertarget{gangstilar_8c_source.tex_l00011}{}\hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{00011} uint8\_t \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l} = 12; \textcolor{comment}{//längd på svingfas }
\hypertarget{gangstilar_8c_source.tex_l00012}{}\hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{00012} uint8\_t \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length} = 36; \textcolor{comment}{//cykelängd = support\_l + swing\_l}
\hypertarget{gangstilar_8c_source.tex_l00013}{}\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{00013} uint8\_t \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} = 12; \textcolor{comment}{//index för benpar 1}
\hypertarget{gangstilar_8c_source.tex_l00014}{}\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{00014} uint8\_t \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} = 30; \textcolor{comment}{//index för benpar 2}
\hypertarget{gangstilar_8c_source.tex_l00015}{}\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{00015} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} = 11; \textcolor{comment}{//höjd senaste avslutade cykel}
\hypertarget{gangstilar_8c_source.tex_l00016}{}\hyperlink{gangstilar_8c_a661742ef73698e09fd0cc0352f5456ed}{00016} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a661742ef73698e09fd0cc0352f5456ed}{last\_speed} = 0; \textcolor{comment}{//speed senaste avslutade cykel}
\hypertarget{gangstilar_8c_source.tex_l00017}{}\hyperlink{gangstilar_8c_a85bd8e6f67b3521a995db392b0079ba9}{00017} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a85bd8e6f67b3521a995db392b0079ba9}{last\_theta} = 0; \textcolor{comment}{//theta senaste avslutade cykel}
\hypertarget{gangstilar_8c_source.tex_l00018}{}\hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{00018} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{theta\_max} = 0; \textcolor{comment}{//max tillåtna theta med aktuell speed}
\hypertarget{gangstilar_8c_source.tex_l00019}{}\hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{00019} uint8\_t \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down} = 0; \textcolor{comment}{//benpar 1 mot mark}
\hypertarget{gangstilar_8c_source.tex_l00020}{}\hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{00020} uint8\_t \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down} = 1; \textcolor{comment}{//benpar 2 mot mark}
\hypertarget{gangstilar_8c_source.tex_l00021}{}\hyperlink{gangstilar_8c_a0b45b9e41407b1bebe9114f0610eb27c}{00021} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a0b45b9e41407b1bebe9114f0610eb27c}{dance\_x} = 0; 
\hypertarget{gangstilar_8c_source.tex_l00022}{}\hyperlink{gangstilar_8c_a8596518927328da6f2b1e575890af503}{00022} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a8596518927328da6f2b1e575890af503}{dance\_y} = 0; 
00023 
\hypertarget{gangstilar_8c_source.tex_l00024}{}\hyperlink{gangstilar_8h_a1cdd1ec49baae5876bf4185c0696ee45}{00024} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a1cdd1ec49baae5876bf4185c0696ee45}{Adjust\_Stance\_Climbed}(\textcolor{keywordtype}{char} direction)
00025 \{
00026     \textcolor{keywordflow}{if}(direction == \textcolor{charliteral}{'u'})
00027     \{
00028         \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} = 14-6.3;
00029     \}
00030     \textcolor{keywordflow}{else} 
00031     \{
00032         \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} = 14;
00033     \}
00034     \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1}=\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2 + \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length}/2; 
00035 \}
00036 
00037 \textcolor{comment}{//LP-filtrerar input för att undvika våldsamheter. Sätter även theta\_max}
\hypertarget{gangstilar_8c_source.tex_l00038}{}\hyperlink{gangstilar_8h_a4228f615ac009f6808bc8cbf5fed939a}{00038} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a4228f615ac009f6808bc8cbf5fed939a}{LP\_Filter\_And\_Limit\_Input}(\textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed}, \textcolor{keywordtype}{int} sgn\_speed, \textcolor{keywordtype}{float} theta, \textcolor{keywordtype}{int} 
      sgn\_theta, \textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height}, \textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a6b061c378131aa307e80484d3165a27c}{dx}, \textcolor{keywordtype}{int} sgn\_dx)
00039 \{
00040     speed = \hyperlink{gangstilar_8c_a0c08306dd068f49ba9bdb5c063d6ae6d}{Limit\_Speed}(speed, sgn\_speed, dx, sgn\_dx);
00041     \hyperlink{structdouble__float}{double\_float} thetas = \hyperlink{gangstilar_8c_adda531189948a09fca5b2ba7eb85ed72}{Limit\_Theta}(speed, sgn\_speed, theta, sgn\_theta);
00042     height = \hyperlink{gangstilar_8c_a7a64feb9f04fb68c5c7c44afb5975acf}{Limit\_Height}(height);
00043     theta = thetas.\hyperlink{structdouble__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a};
00044     \hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{theta\_max} = thetas.\hyperlink{structdouble__float_a83fc1af92e29717b4513d121b0c72c7d}{b};
00045     
00046     \textcolor{keywordtype}{float} speed\_diff = speed - \hyperlink{gangstilar_8c_a661742ef73698e09fd0cc0352f5456ed}{last\_speed};
00047     \textcolor{keywordtype}{float} theta\_diff = theta - \hyperlink{gangstilar_8c_a85bd8e6f67b3521a995db392b0079ba9}{last\_theta};
00048     \textcolor{keywordtype}{float} height\_diff = height - \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height};
00049     
00050     \textcolor{keywordflow}{if}(speed\_diff > 3)
00051     \{
00052         speed = last\_speed + 3;
00053     \}
00054     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(speed\_diff < -3)
00055     \{
00056         speed = last\_speed - 3;
00057     \}
00058 
00059     \textcolor{comment}{/*if(theta\_diff > 0.54)}
00060 \textcolor{comment}{    \{}
00061 \textcolor{comment}{        theta = last\_theta + 0.54;}
00062 \textcolor{comment}{    \}}
00063 \textcolor{comment}{    else if(theta\_diff < -0.54)}
00064 \textcolor{comment}{    \{}
00065 \textcolor{comment}{        theta = last\_theta - 0.54;}
00066 \textcolor{comment}{    \}*/}
00067     
00068     \textcolor{keywordflow}{if}(height\_diff > 2)
00069     \{
00070         height = last\_height + 2;
00071     \}
00072     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(height\_diff < - 4)
00073     \{
00074         height = last\_height - 4;
00075     \}
00076     
00077     last\_speed = \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed};
00078     last\_theta = theta;
00079     \textcolor{keywordflow}{return} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height};
00080 \}
00081 
00082 \textcolor{comment}{//Justerar servospeed efter förhållande mellan theta o thetamax}
\hypertarget{gangstilar_8c_source.tex_l00083}{}\hyperlink{gangstilar_8h_a6bb8056658634de06f155394bd298410}{00083} \hyperlink{structtriple__float}{triple\_float} \hyperlink{gangstilar_8c_a6bb8056658634de06f155394bd298410}{Calc\_Servo\_Speed}(\textcolor{keywordtype}{float} theta, \textcolor{keywordtype}{int} sgn\_theta, int8\_t leg\_down, \textcolor{keywordtype}{
      float} \hyperlink{styr_2styr_2main_8c_a6b061c378131aa307e80484d3165a27c}{dx}, \textcolor{keywordtype}{int} sgn\_dx)
00084 \{    
00085     \textcolor{keywordtype}{int} \hyperlink{over__hinder_8c_ae104a742861491ef3fa14b9926deb4ff}{speed\_inner} ;
00086     \textcolor{keywordtype}{int} \hyperlink{over__hinder_8c_a37e34fcb133065290754a0c320fa04d9}{speed\_middle};
00087     \textcolor{keywordtype}{int} \hyperlink{over__hinder_8c_a92f49a1710c0649467c996317430aec8}{speed\_outer};
00088     
00089     \textcolor{keywordflow}{if}(leg\_down == 1)
00090         \{
00091         speed\_inner =  270 + 170 * (sgn\_theta * theta - \hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{theta\_max});
00092         speed\_middle  = 100 + 10 * dx * sgn\_dx;
00093         speed\_outer  =  100 + 20 * dx * sgn\_dx;
00094         \}     
00095         \textcolor{keywordflow}{else} 
00096         \{                                                                   
00097         speed\_inner =  270 + 170 * (sgn\_theta * theta - \hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{theta\_max});
00098         speed\_middle  = 270 + 280 * (sgn\_theta * theta - \hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{theta\_max}) + 40 * dx * sgn\_dx;
00099         speed\_outer  =  270  + 260 * (sgn\_theta * theta - \hyperlink{gangstilar_8c_aa99d587e22b149bc7ce358fb0827d12e}{theta\_max}) + 40 * dx * sgn\_dx;
00100         \}
00101         
00102  \textcolor{keywordflow}{return} \hyperlink{structs_8c_a32f52471299d0d08c34e0dc70f2296d6}{create\_triple\_float}(speed\_inner, speed\_middle, speed\_outer);
00103 \}   
00104 
00105 \textcolor{comment}{//Skickar kartersiska koordianter och hastigheter till ben}
\hypertarget{gangstilar_8c_source.tex_l00106}{}\hyperlink{gangstilar_8h_a457024b585cd87287d5e05809a848e94}{00106} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a457024b585cd87287d5e05809a848e94}{Send\_Legs\_Kar}(\hyperlink{structtriple__float}{triple\_float} kar\_p1, \hyperlink{structtriple__float}{triple\_float} kar\_p2, \textcolor{keywordtype}{float} 
      \hyperlink{over__hinder_8c_ae9651b009c7f17475dac0accfd2ddf98}{corner\_pitch}, \hyperlink{structtriple__float}{triple\_float} speed\_p1, \hyperlink{structtriple__float}{triple\_float} speed\_p2, \textcolor{keywordtype}{float} dx\_p1
      , \textcolor{keywordtype}{float} dx\_p2) 
00107 \{
00108     \hyperlink{servo___u_a_r_t_8c_a7cd98c6b9c0d2127feb9dfece072b3b0}{Send\_Leg5\_Kar\_And\_Velocity}(kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + dx\_p1, kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} - corner\_pitch, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}); 
00109     \hyperlink{servo___u_a_r_t_8c_a1501df88c7ba1630f81577522ac2bbeb}{Send\_Leg1\_Kar\_And\_Velocity}(kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + dx\_p1, kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + corner\_pitch, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});   
00110     \hyperlink{servo___u_a_r_t_8c_a15260e1c5159c1047ca8ec867a8fc56c}{Send\_Leg3\_Kar\_And\_Velocity}(kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + dx\_p2, kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}); 
00111     \hyperlink{servo___u_a_r_t_8c_ae1cff60ca27b892abf86b8a55b6b4ccd}{Send\_Leg4\_Kar\_And\_Velocity}(kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - dx\_p1, kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}); 
00112     \hyperlink{servo___u_a_r_t_8c_a7ab1230fdabe0bcf16d18c331c75057e}{Send\_Leg2\_Kar\_And\_Velocity}(kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - dx\_p2, kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + corner\_pitch, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00113     \hyperlink{servo___u_a_r_t_8c_a8cd710e0714336201bd84b46a1e1877d}{Send\_Leg6\_Kar\_And\_Velocity}(kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - dx\_p2, kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} - corner\_pitch, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00114 \}
00115 
00116 \textcolor{comment}{//Roterar och skickar ut koordinater till ben ev: fixa så den lyfter ett av (beror på rotationsriktning) hörnbenen
       extra}
\hypertarget{gangstilar_8c_source.tex_l00117}{}\hyperlink{gangstilar_8h_a0ad2cf3e9047e6311cdac98a8bce6ed6}{00117} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a0ad2cf3e9047e6311cdac98a8bce6ed6}{Rotate\_And\_Send\_Legs}(\hyperlink{structtriple__float}{triple\_float} kar\_p1, 
      \hyperlink{structtriple__float}{triple\_float} kar\_p2, \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_ae9651b009c7f17475dac0accfd2ddf98}{corner\_pitch}, \textcolor{keywordtype}{int} sgn\_speed, \textcolor{keywordtype}{float} theta, 
      \hyperlink{structtriple__float}{triple\_float} speed\_p1, \hyperlink{structtriple__float}{triple\_float} speed\_p2, \textcolor{keywordtype}{float} dx\_p1, \textcolor{keywordtype}{float} dx\_p2)
00118 \{           
00119     \textcolor{comment}{//koord för par 1 omvandlas till cyl}
00120     \hyperlink{structtriple__float}{triple\_float} cyl4 = \hyperlink{invers__kinematik_8c_aaaaddfbb21d42ca2d7f2ff855a3b1a01}{Kar\_To\_Cyl\_Leg4}(kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - dx\_p1, kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}); 
00121     \hyperlink{structtriple__float}{triple\_float} cyl1 = \hyperlink{invers__kinematik_8c_ae696af5df234c2f15694317bcf2a4bec}{Kar\_To\_Cyl\_Leg1}(kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + dx\_p1, kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + corner\_pitch, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00122     \hyperlink{structtriple__float}{triple\_float} cyl5 = \hyperlink{invers__kinematik_8c_abc3e6e1ada8dc2e48c5b0dc980c0dc81}{Kar\_To\_Cyl\_Leg5}(kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + dx\_p1, kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} - corner\_pitch, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00123     
00124     \textcolor{comment}{//koord för par 2 omvandlas till cyl}
00125     \hyperlink{structtriple__float}{triple\_float} cyl3 = \hyperlink{invers__kinematik_8c_a60f2e45cc22b107f9c5020ca85c6ab31}{Kar\_To\_Cyl\_Leg3}(kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + dx\_p2, kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}); 
00126     \hyperlink{structtriple__float}{triple\_float} cyl2 = \hyperlink{invers__kinematik_8c_addfbc7c7fdb83567e74239fb6333d92c}{Kar\_To\_Cyl\_Leg2}(kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - dx\_p2, kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + corner\_pitch, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00127     \hyperlink{structtriple__float}{triple\_float} cyl6 = \hyperlink{invers__kinematik_8c_aac6d276df2445e288447c993547ecbc4}{Kar\_To\_Cyl\_Leg6}(kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - dx\_p2, kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} - corner\_pitch, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00128     
00129     \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} <= \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) 
00130     \{
00131         \textcolor{comment}{//Stegvis rotation på p1 stödfas}
00132         cyl1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * (- theta/2 + \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} * theta/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l});
00133         cyl4.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl4.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * (- theta/2 + \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} * theta/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l});
00134         cyl5.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl5.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * (- theta/2 + \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} * theta/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l});
00135     \}
00136     \textcolor{keywordflow}{else} 
00137     \{
00138             \textcolor{comment}{//Stegvis rotation på p1 svingfas}
00139         cyl1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * ( theta/2 - (\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * theta/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l});
00140         cyl4.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl4.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * ( theta/2 - (\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * theta/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l});
00141         cyl5.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl5.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * ( theta/2 - (\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * theta/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l});  
00142     \}
00143     
00144     \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} <= \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) 
00145     \{
00146             \textcolor{comment}{//Stegvis rotation på p2 stödfas}
00147             cyl3.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl3.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * (- theta/2 + \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} * theta/
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l});
00148             cyl2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * (- theta/2 + \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} * theta/
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l});
00149             cyl6.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl6.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * (- theta/2 + \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} * theta/
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l});
00150     \}
00151     \textcolor{keywordflow}{else}
00152     \{
00153             \textcolor{comment}{//Stegvis rotation på p2 svingfas}
00154             cyl3.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl3.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * ( theta/2 - (\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * theta/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l});
00155             cyl2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * ( theta/2 - (\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * theta/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l});
00156             cyl6.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} = cyl6.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b} + sgn\_speed * ( theta/2 - (\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * theta/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l});
00157     \}
00158 
00159     \textcolor{comment}{//skicka ut cyl koord}
00160     \hyperlink{servo___u_a_r_t_8c_a6cddf44c6a11c7907911d03af1e3f127}{Send\_Leg4\_Cyl\_And\_Velocity}(cyl4.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, cyl4.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, cyl4.
      \hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00161     \hyperlink{servo___u_a_r_t_8c_a7783d05fa4457ed256d04d0eac4713cc}{Send\_Leg1\_Cyl\_And\_Velocity}(cyl1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, cyl1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, cyl1.
      \hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00162     \hyperlink{servo___u_a_r_t_8c_aacc5d4be18de766587abbb83098916a3}{Send\_Leg5\_Cyl\_And\_Velocity}(cyl5.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, cyl5.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, cyl5.
      \hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p1.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00163     \hyperlink{servo___u_a_r_t_8c_a3f98bedbfd8c6462fbc873fd56ad6094}{Send\_Leg3\_Cyl\_And\_Velocity}(cyl3.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, cyl3.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, cyl3.
      \hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00164     \hyperlink{servo___u_a_r_t_8c_a16c2e98e0befea13b10d322b5a13c24a}{Send\_Leg2\_Cyl\_And\_Velocity}(cyl2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, cyl2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, cyl2.
      \hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00165     \hyperlink{servo___u_a_r_t_8c_a3f6d26397b69e462327480969aa40d1b}{Send\_Leg6\_Cyl\_And\_Velocity}(cyl6.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, cyl6.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, cyl6.
      \hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, speed\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a}, speed\_p2.\hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, speed\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c});
00166 \}           
00167 
00168 \textcolor{comment}{//begränsar maxhastighet.}
\hypertarget{gangstilar_8c_source.tex_l00169}{}\hyperlink{gangstilar_8h_a0c08306dd068f49ba9bdb5c063d6ae6d}{00169} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a0c08306dd068f49ba9bdb5c063d6ae6d}{Limit\_Speed}(\textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed}, \textcolor{keywordtype}{int} sgn\_speed,  \textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a6b061c378131aa307e80484d3165a27c}{dx}, \textcolor{keywordtype}{int} sgn\_dx)
00170 \{
00171     \textcolor{keywordflow}{if}( ((\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} <= 9) || (\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} >= 12)) && (speed * sgn\_speed > 5))
00172     \{
00173         speed = 5 * sgn\_speed;
00174     \}
00175     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(speed * sgn\_speed > ( 6 - dx * sgn\_dx/4))  
00176     \{
00177         speed = 6 * sgn\_speed - dx * sgn\_dx/4;
00178     \}
00179     \textcolor{keywordflow}{return} \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed};
00180 \}
00181 
00182 \textcolor{comment}{//Begränsar höjd Limit\_Height(float height)
\{
    if(height > 14)
    \{
        height = 14;
    \}
    else if(height < 7)
    \{
        height = 7;
    \}
    return height;
\}

//Begränsar theta baserat på speed, steglös Returnerar max tillåtna theta och begränsat theta
double\_float Limit\_Theta(float speed, int sgn\_speed, float theta, int sgn\_theta )
\{
    speed = speed * sgn\_speed;
    int speed\_int = speed;
    float speed\_dec = speed - speed\_int;
    float thlimits[7] = \{0.57,0.45,0.35,0.33,0.23,0.13,0.04\};
    float thlin[7] =    \{-0.12,-0.1,-0.02,-0.1,-0.1,-0.09,0\};
    
    //th\_max beräknas med linjärsering mellan heltal av speed.
    float th\_max = thlimits[speed\_int] + speed\_dec * thlin[speed\_int];
    
    if( theta * sgn\_theta > th\_max )
    \{
        theta = sgn\_theta * th\_max;
    \}
    return create\_double\_float(theta, th\_max);
\}

//Generar tripod gång 
triple\_float Tripod(float x, float stroke, float height,float lift, uint8\_t n)
\{
    float y = 0;
    float z = 0;
    
    if(n <= support\_l - 1)//stödfas
    \{
        y = stroke/2 - stroke * n/support\_l;
        z= - height;
    \}
    else if( n <= support\_l)//börjar lyfta ben med fortsatt benrörelse bakåt
   \{
        y = stroke/2 - stroke * n/support\_l;
        z = lift - height;
    \}
    else if( n <= cycle\_length - 1) // för ben frammmåt mot startpos
    \{
        y = -stroke/2 + (n - support\_l) * stroke/swing\_l;
        z = lift - height;
    \}
    
    return create\_triple\_float(x,y,z);
\}

//Går en halv cykel
void Walk\_Half\_Cycle(float speed, float theta, float height, float dx)
\{

    float l = 12; //fötters förskjuting från kropp i x-led 
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 
    
    int sgn\_dx = (dx >= 0) - (dx < 0);
    int sgn\_speed = (speed >= 0) - (speed < 0);
    int sgn\_theta = (theta >= 0) - (theta < 0);
    uint8\_t walk\_break = 1;
    
    if( dx * sgn\_dx > 6)
    \{
        dx = 6 * sgn\_dx;
    \}
    
    //filtrerade o begränsade värden kommer som globala last\_
    height = LP\_Filter\_And\_Limit\_Input(speed, sgn\_speed, theta, sgn\_theta, height, dx, sgn\_dx);
    //sätter parametrar till LP-filtrerade
    speed = last\_speed;
    theta = last\_theta;
    sgn\_speed = (speed >= 0) - (speed < 0) ;
    sgn\_theta = (theta >= 0) - (theta < 0) ;
    float height\_step = 2 * (height - last\_height)/cycle\_length;
    float lift = 1.2 + sgn\_speed * speed/12;//benens lyfthöjd justeras efter speed 
    float stroke =  1.8 * speed; 
    float dx\_p1 = 0;
    float dx\_p2 = 0;
    triple\_float kar\_p1;
    triple\_float kar\_p2;
    triple\_float speed\_p1;
    triple\_float speed\_p2;
    
    if( (speed*sgn\_speed < 0.2 ) && (theta * sgn\_theta < 0.01) && (height\_step == 0) &&(dx * sgn\_dx < 0.5))
       // gör inget
    \{
        return;
    \}
    
    if( (speed*sgn\_speed < 0.2 ) && (theta * sgn\_theta < 0.01)&&(dx * sgn\_dx < 0.5) ) //justera höjd utan att
       gå
	\{
        stroke = 0;
        lift = 0;
        dx = 0;
    \}
    
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        //stegvis höjdjustering
        last\_height += height\_step;
        n\_2= n\_1 + cycle\_length/2; //benpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1; //berättar om benpar ska sättas ner
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
    
        if(n\_1 <= support\_l)
        \{
            dx\_p1 = (n\_1-support\_l/2) * dx/support\_l;
        \}
        else
        \{
            dx\_p1 = (support\_l + swing\_l/2 - n\_1) * dx/swing\_l;
        \}
        
        if(n\_2 <= support\_l)
        \{
            dx\_p2 = (n\_2-support\_l/2) * dx/support\_l;
        \}
        else
        \{
            dx\_p2 = (support\_l + swing\_l/2 - n\_2) * dx/swing\_l;
        \}
    
        speed\_p1 = Calc\_Servo\_Speed(theta, sgn\_theta, p1\_down, dx, sgn\_dx);
        speed\_p2 = Calc\_Servo\_Speed(theta, sgn\_theta, p2\_down, dx, sgn\_dx);

        if(theta * sgn\_theta < 0.01) //behöver ej gå via cyl koord vid rak gång.
        \{
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Legs\_Kar(kar\_p1, kar\_p2, corner\_pitch, speed\_p1, speed\_p2, dx\_p1, dx\_p2);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); //för kart skippar på sista loopen, pga tid som mainloop tar 
            \}
        \}
        else //om sväng
        \{
            lift = 1.5 + theta * sgn\_theta * 1.2; 
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Rotate\_And\_Send\_Legs(kar\_p1, kar\_p2, corner\_pitch, sgn\_speed, theta, speed\_p1, speed\_p2, dx\_p1,
       dx\_p2);
            
            if( walk\_break || ( n\_1 != support\_l/2 && n\_2  !=  support\_l/2))
            \{
            \_delay\_ms(5); //Delay för cyl skippar på sista loopen, pga tids som mainloop tar TEST
            \}
        \}
    \}
    last\_height = height;
\}

//Går en halv cykel crabgång
void Walk\_Half\_Crab\_Cycle(int8\_t speed)// höger är possitivt
\{
    
    float l = 12;//fötters förskjuting från kropp i x-led 
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 
    int sgn\_speed = (speed >= 0) - (speed < 0) ;
    uint8\_t walk\_break = 1;
    float stroke =speed;  //steglängd 
    if(speed * sgn\_speed <2)
    \{
        return;
    \}
    if(speed* sgn\_speed > 6)
    \{
        speed = 6* sgn\_speed;
    \}

    if(speed == 0) // gör inget
    \{
        return;
    \}
    //justerar höjd om den är på oönskad nivå
	if(last\_height != 11)
    \{
        Walk\_Half\_Cycle(0,0,11,0);
    \}
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        n\_2= n\_1 + cycle\_length/2; //barnpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1;
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
        
        triple\_float kar\_p1;
        triple\_float kar\_p2;
        
        //servospeeds
        float speed\_p1\_middle = 310- 80 * p1\_down;
        float speed\_p1\_outer = 310 - 80 * p1\_down;
        float speed\_p2\_middle = 310 - 80 * p2\_down;
        float speed\_p2\_outer = 310 - 80 * p2\_down;

        float lift =1.4; 
    
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Leg5\_Kar\_And\_Velocity( kar\_p1.a - kar\_p1.b, - corner\_pitch, kar\_p1.c, 100,
       speed\_p1\_middle, speed\_p1\_outer);   
            Send\_Leg3\_Kar\_And\_Velocity( kar\_p2.a - kar\_p2.b, 0, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer); 
            Send\_Leg4\_Kar\_And\_Velocity( kar\_p1.a +  kar\_p1.b, 0, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer);   
            Send\_Leg1\_Kar\_And\_Velocity( kar\_p1.a -  kar\_p1.b, corner\_pitch, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer); 
            Send\_Leg2\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, corner\_pitch, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer);
            Send\_Leg6\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, - corner\_pitch, kar\_p2.c, 100,
       speed\_p2\_middle, speed\_p2\_outer);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); 
            \}
        \}
\}

void Dance(float x, float y)
\{
    float l = 12;//fötters förskjuting från kropp i x-led OBS orginal = 13, numera 12
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 4
    int speed\_inner\_dance= 180;
    int speed\_middle\_dance= 200;
    int speed\_outer\_dance  = 200;
    float max\_r = 7; 
    float max\_step= 0.3; 
    float height\_step = 0.5; 
        
    // höjdjustering
    float height; 
    if(last\_height>12)
    \{
        height=last\_height-height\_step; 
    \}
    if(last\_height<10)
    \{
        height=last\_height+height\_step; 
    \}
    else 
    \{
        height=11;
    \}
    last\_height = height; 
        
    // lågpass 
    float direction\_x = x-dance\_x; 
    float direction\_y = y-dance\_y; 
    float diff= sqrt(pow(direction\_x,2) + pow(direction\_y,2));
    if(diff>max\_step)
    \{
        dance\_x = dance\_x + direction\_x/diff*max\_step;
        dance\_y = dance\_y + direction\_y/diff*max\_step;
    \}
    else
    \{
    dance\_x = dance\_x + direction\_x; 
    dance\_y = dance\_y + direction\_y;
        
    \}
        
    //Begränsningar i radie;
    dance\_r = sqrt(pow(dance\_y,2) + pow(dance\_x,2));
    if(dance\_r>max\_r)
    \{
        dance\_x= dance\_x/dance\_r*max\_r;
        dance\_y= dance\_y/dance\_r*max\_r;
    \}
        
    Send\_Leg1\_Kar\_And\_Velocity(l+dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg2\_Kar\_And\_Velocity(l-dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg3\_Kar\_And\_Velocity(l+dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg4\_Kar\_And\_Velocity(l-dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg5\_Kar\_And\_Velocity(l+dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg6\_Kar\_And\_Velocity(l-dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    \_delay\_ms(15);
    
\}

void Dance\_Cyl(float r, float th)
\{
    float x = r *cos(th);
    float y = r * sin(th); 
    Dance(x,y);
\}

void Victory\_Dance(void)
\{
    float pi = 3.14159265359;
    
    //fixa rörelsemönster 
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01);
    \}
    for(float i = 1; i< 200; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,6-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6+6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0, 6*0.05*i);
    \}
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(0, 2*pi*0.01);
    \}
\}

}
\hypertarget{gangstilar_8c_source.tex_l00183}{}\hyperlink{gangstilar_8h_a7a64feb9f04fb68c5c7c44afb5975acf}{00183} \textcolor{keywordtype}{float} \hyperlink{gangstilar_8c_a7a64feb9f04fb68c5c7c44afb5975acf}{Limit\_Height}(\textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height})
00184 \{
00185     \textcolor{keywordflow}{if}(height > 14)
00186     \{
00187         height = 14;
00188     \}
00189     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(height < 7)
00190     \{
00191         height = 7;
00192     \}
00193     \textcolor{keywordflow}{return} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height};
00194 \}
00195 
00196 \textcolor{comment}{//Begränsar theta baserat på speed, steglös Returnerar max tillåtna theta och begränsat theta}
\hypertarget{gangstilar_8c_source.tex_l00197}{}\hyperlink{gangstilar_8h_adda531189948a09fca5b2ba7eb85ed72}{00197} \hyperlink{structdouble__float}{double\_float} \hyperlink{gangstilar_8c_adda531189948a09fca5b2ba7eb85ed72}{Limit\_Theta}(\textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed}, \textcolor{keywordtype}{int} sgn\_speed, \textcolor{keywordtype}{float} theta, \textcolor{keywordtype}{int} sgn\_theta
       )
00198 \{
00199     speed = speed * sgn\_speed;
00200     \textcolor{keywordtype}{int} speed\_int = \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed};
00201     \textcolor{keywordtype}{float} speed\_dec = speed - speed\_int;
00202     \textcolor{keywordtype}{float} thlimits[7] = \{0.57,0.45,0.35,0.33,0.23,0.13,0.04\};
00203     \textcolor{keywordtype}{float} thlin[7] =    \{-0.12,-0.1,-0.02,-0.1,-0.1,-0.09,0\};
00204     
00205     \textcolor{comment}{//th\_max beräknas med linjärsering mellan heltal av speed.}
00206     \textcolor{keywordtype}{float} th\_max = thlimits[speed\_int] + speed\_dec * thlin[speed\_int];
00207     
00208     \textcolor{keywordflow}{if}( theta * sgn\_theta > th\_max )
00209     \{
00210         theta = sgn\_theta * th\_max;
00211     \}
00212     \textcolor{keywordflow}{return} \hyperlink{structs_8c_a85207aa5455eaa4d4cf9c71e9094ae46}{create\_double\_float}(theta, th\_max);
00213 \}
00214 
00215 \textcolor{comment}{//Generar tripod gång }
\hypertarget{gangstilar_8c_source.tex_l00216}{}\hyperlink{gangstilar_8h_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{00216} \hyperlink{structtriple__float}{triple\_float} \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(\textcolor{keywordtype}{float} \hyperlink{sensor_8h_a6c4b361d72eb3767ba424ac9a6ecf52b}{x}, \textcolor{keywordtype}{float} stroke, \textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height},\textcolor{keywordtype}{float} 
      \hyperlink{over__hinder_8c_a5e433c2d90f9d7f1ff1868b9e8b91868}{lift}, uint8\_t n)
00217 \{
00218     \textcolor{keywordtype}{float} \hyperlink{sensor_8h_a0ed6a908288e0cd87f79c1b5ab56d07c}{y} = 0;
00219     \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_af73583b1e980b0aa03f9884812e9fd4d}{z} = 0;
00220     
00221     \textcolor{keywordflow}{if}(n <= \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l} - 1)\textcolor{comment}{//stödfas}
00222     \{
00223         y = stroke/2 - stroke * n/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l};
00224         z= - \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height};
00225     \}
00226     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( n <= \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l})\textcolor{comment}{//börjar lyfta ben med fortsatt benrörelse bakåt  \{
        y = stroke/2 - stroke * n/support\_l;
        z = lift - height;
    \}
    else if( n <= cycle\_length - 1) // för ben frammmåt mot startpos
    \{
        y = -stroke/2 + (n - support\_l) * stroke/swing\_l;
        z = lift - height;
    \}
    
    return create\_triple\_float(x,y,z);
\}

//Går en halv cykel
void Walk\_Half\_Cycle(float speed, float theta, float height, float dx)
\{

    float l = 12; //fötters förskjuting från kropp i x-led 
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 
    
    int sgn\_dx = (dx >= 0) - (dx < 0);
    int sgn\_speed = (speed >= 0) - (speed < 0);
    int sgn\_theta = (theta >= 0) - (theta < 0);
    uint8\_t walk\_break = 1;
    
    if( dx * sgn\_dx > 6)
    \{
        dx = 6 * sgn\_dx;
    \}
    
    //filtrerade o begränsade värden kommer som globala last\_
    height = LP\_Filter\_And\_Limit\_Input(speed, sgn\_speed, theta, sgn\_theta, height, dx, sgn\_dx);
    //sätter parametrar till LP-filtrerade
    speed = last\_speed;
    theta = last\_theta;
    sgn\_speed = (speed >= 0) - (speed < 0) ;
    sgn\_theta = (theta >= 0) - (theta < 0) ;
    float height\_step = 2 * (height - last\_height)/cycle\_length;
    float lift = 1.2 + sgn\_speed * speed/12;//benens lyfthöjd justeras efter speed 
    float stroke =  1.8 * speed; 
    float dx\_p1 = 0;
    float dx\_p2 = 0;
    triple\_float kar\_p1;
    triple\_float kar\_p2;
    triple\_float speed\_p1;
    triple\_float speed\_p2;
    
    if( (speed*sgn\_speed < 0.2 ) && (theta * sgn\_theta < 0.01) && (height\_step == 0) &&(dx * sgn\_dx < 0.5))
       // gör inget
    \{
        return;
    \}
    
    if( (speed*sgn\_speed < 0.2 ) && (theta * sgn\_theta < 0.01)&&(dx * sgn\_dx < 0.5) ) //justera höjd utan att
       gå
	\{
        stroke = 0;
        lift = 0;
        dx = 0;
    \}
    
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        //stegvis höjdjustering
        last\_height += height\_step;
        n\_2= n\_1 + cycle\_length/2; //benpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1; //berättar om benpar ska sättas ner
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
    
        if(n\_1 <= support\_l)
        \{
            dx\_p1 = (n\_1-support\_l/2) * dx/support\_l;
        \}
        else
        \{
            dx\_p1 = (support\_l + swing\_l/2 - n\_1) * dx/swing\_l;
        \}
        
        if(n\_2 <= support\_l)
        \{
            dx\_p2 = (n\_2-support\_l/2) * dx/support\_l;
        \}
        else
        \{
            dx\_p2 = (support\_l + swing\_l/2 - n\_2) * dx/swing\_l;
        \}
    
        speed\_p1 = Calc\_Servo\_Speed(theta, sgn\_theta, p1\_down, dx, sgn\_dx);
        speed\_p2 = Calc\_Servo\_Speed(theta, sgn\_theta, p2\_down, dx, sgn\_dx);

        if(theta * sgn\_theta < 0.01) //behöver ej gå via cyl koord vid rak gång.
        \{
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Legs\_Kar(kar\_p1, kar\_p2, corner\_pitch, speed\_p1, speed\_p2, dx\_p1, dx\_p2);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); //för kart skippar på sista loopen, pga tid som mainloop tar 
            \}
        \}
        else //om sväng
        \{
            lift = 1.5 + theta * sgn\_theta * 1.2; 
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Rotate\_And\_Send\_Legs(kar\_p1, kar\_p2, corner\_pitch, sgn\_speed, theta, speed\_p1, speed\_p2, dx\_p1,
       dx\_p2);
            
            if( walk\_break || ( n\_1 != support\_l/2 && n\_2  !=  support\_l/2))
            \{
            \_delay\_ms(5); //Delay för cyl skippar på sista loopen, pga tids som mainloop tar TEST
            \}
        \}
    \}
    last\_height = height;
\}

//Går en halv cykel crabgång
void Walk\_Half\_Crab\_Cycle(int8\_t speed)// höger är possitivt
\{
    
    float l = 12;//fötters förskjuting från kropp i x-led 
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 
    int sgn\_speed = (speed >= 0) - (speed < 0) ;
    uint8\_t walk\_break = 1;
    float stroke =speed;  //steglängd 
    if(speed * sgn\_speed <2)
    \{
        return;
    \}
    if(speed* sgn\_speed > 6)
    \{
        speed = 6* sgn\_speed;
    \}

    if(speed == 0) // gör inget
    \{
        return;
    \}
    //justerar höjd om den är på oönskad nivå
	if(last\_height != 11)
    \{
        Walk\_Half\_Cycle(0,0,11,0);
    \}
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        n\_2= n\_1 + cycle\_length/2; //barnpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1;
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
        
        triple\_float kar\_p1;
        triple\_float kar\_p2;
        
        //servospeeds
        float speed\_p1\_middle = 310- 80 * p1\_down;
        float speed\_p1\_outer = 310 - 80 * p1\_down;
        float speed\_p2\_middle = 310 - 80 * p2\_down;
        float speed\_p2\_outer = 310 - 80 * p2\_down;

        float lift =1.4; 
    
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Leg5\_Kar\_And\_Velocity( kar\_p1.a - kar\_p1.b, - corner\_pitch, kar\_p1.c, 100,
       speed\_p1\_middle, speed\_p1\_outer);   
            Send\_Leg3\_Kar\_And\_Velocity( kar\_p2.a - kar\_p2.b, 0, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer); 
            Send\_Leg4\_Kar\_And\_Velocity( kar\_p1.a +  kar\_p1.b, 0, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer);   
            Send\_Leg1\_Kar\_And\_Velocity( kar\_p1.a -  kar\_p1.b, corner\_pitch, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer); 
            Send\_Leg2\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, corner\_pitch, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer);
            Send\_Leg6\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, - corner\_pitch, kar\_p2.c, 100,
       speed\_p2\_middle, speed\_p2\_outer);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); 
            \}
        \}
\}

void Dance(float x, float y)
\{
    float l = 12;//fötters förskjuting från kropp i x-led OBS orginal = 13, numera 12
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 4
    int speed\_inner\_dance= 180;
    int speed\_middle\_dance= 200;
    int speed\_outer\_dance  = 200;
    float max\_r = 7; 
    float max\_step= 0.3; 
    float height\_step = 0.5; 
        
    // höjdjustering
    float height; 
    if(last\_height>12)
    \{
        height=last\_height-height\_step; 
    \}
    if(last\_height<10)
    \{
        height=last\_height+height\_step; 
    \}
    else 
    \{
        height=11;
    \}
    last\_height = height; 
        
    // lågpass 
    float direction\_x = x-dance\_x; 
    float direction\_y = y-dance\_y; 
    float diff= sqrt(pow(direction\_x,2) + pow(direction\_y,2));
    if(diff>max\_step)
    \{
        dance\_x = dance\_x + direction\_x/diff*max\_step;
        dance\_y = dance\_y + direction\_y/diff*max\_step;
    \}
    else
    \{
    dance\_x = dance\_x + direction\_x; 
    dance\_y = dance\_y + direction\_y;
        
    \}
        
    //Begränsningar i radie;
    dance\_r = sqrt(pow(dance\_y,2) + pow(dance\_x,2));
    if(dance\_r>max\_r)
    \{
        dance\_x= dance\_x/dance\_r*max\_r;
        dance\_y= dance\_y/dance\_r*max\_r;
    \}
        
    Send\_Leg1\_Kar\_And\_Velocity(l+dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg2\_Kar\_And\_Velocity(l-dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg3\_Kar\_And\_Velocity(l+dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg4\_Kar\_And\_Velocity(l-dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg5\_Kar\_And\_Velocity(l+dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg6\_Kar\_And\_Velocity(l-dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    \_delay\_ms(15);
    
\}

void Dance\_Cyl(float r, float th)
\{
    float x = r *cos(th);
    float y = r * sin(th); 
    Dance(x,y);
\}

void Victory\_Dance(void)
\{
    float pi = 3.14159265359;
    
    //fixa rörelsemönster 
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01);
    \}
    for(float i = 1; i< 200; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,6-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6+6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0, 6*0.05*i);
    \}
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(0, 2*pi*0.01);
    \}
\}

}
00227     \{
00228         y = stroke/2 - stroke * n/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l};
00229         z = lift - \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height};
00230     \}
00231     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( n <= \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length} - 1) \textcolor{comment}{// för ben frammmåt mot startpos}
00232     \{
00233         y = -stroke/2 + (n - \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}) * stroke/\hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l};
00234         z = lift - \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height};
00235     \}
00236     
00237     \textcolor{keywordflow}{return} \hyperlink{structs_8c_a32f52471299d0d08c34e0dc70f2296d6}{create\_triple\_float}(x,y,z);
00238 \}
00239 
00240 \textcolor{comment}{//Går en halv cykel}
\hypertarget{gangstilar_8c_source.tex_l00241}{}\hyperlink{gangstilar_8h_a8b22e9229a15d20adb676428ad7f6dac}{00241} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a8b22e9229a15d20adb676428ad7f6dac}{Walk\_Half\_Cycle}(\textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed}, \textcolor{keywordtype}{float} theta, \textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height}, \textcolor{keywordtype}{float} 
      \hyperlink{styr_2styr_2main_8c_a6b061c378131aa307e80484d3165a27c}{dx})
00242 \{
00243 
00244     \textcolor{keywordtype}{float} l = 12; \textcolor{comment}{//fötters förskjuting från kropp i x-led }
00245     \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_ae9651b009c7f17475dac0accfd2ddf98}{corner\_pitch} = 4; \textcolor{comment}{//förskjutning av arbetsområde i y-led för hörnben }
00246     
00247     \textcolor{keywordtype}{int} sgn\_dx = (dx >= 0) - (dx < 0);
00248     \textcolor{keywordtype}{int} sgn\_speed = (speed >= 0) - (speed < 0);
00249     \textcolor{keywordtype}{int} sgn\_theta = (theta >= 0) - (theta < 0);
00250     uint8\_t walk\_break = 1;
00251     
00252     \textcolor{keywordflow}{if}( dx * sgn\_dx > 6)
00253     \{
00254         dx = 6 * sgn\_dx;
00255     \}
00256     
00257     \textcolor{comment}{//filtrerade o begränsade värden kommer som globala last\_}
00258     height = \hyperlink{gangstilar_8c_a4228f615ac009f6808bc8cbf5fed939a}{LP\_Filter\_And\_Limit\_Input}(speed, sgn\_speed, theta, sgn\_theta, height,
       dx, sgn\_dx);
00259     \textcolor{comment}{//sätter parametrar till LP-filtrerade}
00260     speed = \hyperlink{gangstilar_8c_a661742ef73698e09fd0cc0352f5456ed}{last\_speed};
00261     theta = \hyperlink{gangstilar_8c_a85bd8e6f67b3521a995db392b0079ba9}{last\_theta};
00262     sgn\_speed = (speed >= 0) - (speed < 0) ;
00263     sgn\_theta = (theta >= 0) - (theta < 0) ;
00264     \textcolor{keywordtype}{float} height\_step = 2 * (height - \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height})/\hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length};
00265     \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_a5e433c2d90f9d7f1ff1868b9e8b91868}{lift} = 1.2 + sgn\_speed * speed/12;\textcolor{comment}{//benens lyfthöjd justeras efter speed }
00266     \textcolor{keywordtype}{float} stroke =  1.8 * \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed}; 
00267     \textcolor{keywordtype}{float} dx\_p1 = 0;
00268     \textcolor{keywordtype}{float} dx\_p2 = 0;
00269     \hyperlink{structtriple__float}{triple\_float} kar\_p1;
00270     \hyperlink{structtriple__float}{triple\_float} kar\_p2;
00271     \hyperlink{structtriple__float}{triple\_float} speed\_p1;
00272     \hyperlink{structtriple__float}{triple\_float} speed\_p2;
00273     
00274     \textcolor{keywordflow}{if}( (speed*sgn\_speed < 0.2 ) && (theta * sgn\_theta < 0.01) && (height\_step == 0) &&(dx * sgn\_dx < 0.5))
       \textcolor{comment}{// gör inget}
00275     \{
00276         \textcolor{keywordflow}{return};
00277     \}
00278     
00279     \textcolor{keywordflow}{if}( (speed*sgn\_speed < 0.2 ) && (theta * sgn\_theta < 0.01)&&(dx * sgn\_dx < 0.5) ) \textcolor{comment}{//justera höjd utan att
       gå
        stroke = 0;
        lift = 0;
        dx = 0;
    \}
    
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        //stegvis höjdjustering
        last\_height += height\_step;
        n\_2= n\_1 + cycle\_length/2; //benpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1; //berättar om benpar ska sättas ner
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
    
        if(n\_1 <= support\_l)
        \{
            dx\_p1 = (n\_1-support\_l/2) * dx/support\_l;
        \}
        else
        \{
            dx\_p1 = (support\_l + swing\_l/2 - n\_1) * dx/swing\_l;
        \}
        
        if(n\_2 <= support\_l)
        \{
            dx\_p2 = (n\_2-support\_l/2) * dx/support\_l;
        \}
        else
        \{
            dx\_p2 = (support\_l + swing\_l/2 - n\_2) * dx/swing\_l;
        \}
    
        speed\_p1 = Calc\_Servo\_Speed(theta, sgn\_theta, p1\_down, dx, sgn\_dx);
        speed\_p2 = Calc\_Servo\_Speed(theta, sgn\_theta, p2\_down, dx, sgn\_dx);

        if(theta * sgn\_theta < 0.01) //behöver ej gå via cyl koord vid rak gång.
        \{
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Legs\_Kar(kar\_p1, kar\_p2, corner\_pitch, speed\_p1, speed\_p2, dx\_p1, dx\_p2);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); //för kart skippar på sista loopen, pga tid som mainloop tar 
            \}
        \}
        else //om sväng
        \{
            lift = 1.5 + theta * sgn\_theta * 1.2; 
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Rotate\_And\_Send\_Legs(kar\_p1, kar\_p2, corner\_pitch, sgn\_speed, theta, speed\_p1, speed\_p2, dx\_p1,
       dx\_p2);
            
            if( walk\_break || ( n\_1 != support\_l/2 && n\_2  !=  support\_l/2))
            \{
            \_delay\_ms(5); //Delay för cyl skippar på sista loopen, pga tids som mainloop tar TEST
            \}
        \}
    \}
    last\_height = height;
\}

//Går en halv cykel crabgång
void Walk\_Half\_Crab\_Cycle(int8\_t speed)// höger är possitivt
\{
    
    float l = 12;//fötters förskjuting från kropp i x-led 
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 
    int sgn\_speed = (speed >= 0) - (speed < 0) ;
    uint8\_t walk\_break = 1;
    float stroke =speed;  //steglängd 
    if(speed * sgn\_speed <2)
    \{
        return;
    \}
    if(speed* sgn\_speed > 6)
    \{
        speed = 6* sgn\_speed;
    \}

    if(speed == 0) // gör inget
    \{
        return;
    \}
    //justerar höjd om den är på oönskad nivå
	if(last\_height != 11)
    \{
        Walk\_Half\_Cycle(0,0,11,0);
    \}
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        n\_2= n\_1 + cycle\_length/2; //barnpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1;
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
        
        triple\_float kar\_p1;
        triple\_float kar\_p2;
        
        //servospeeds
        float speed\_p1\_middle = 310- 80 * p1\_down;
        float speed\_p1\_outer = 310 - 80 * p1\_down;
        float speed\_p2\_middle = 310 - 80 * p2\_down;
        float speed\_p2\_outer = 310 - 80 * p2\_down;

        float lift =1.4; 
    
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Leg5\_Kar\_And\_Velocity( kar\_p1.a - kar\_p1.b, - corner\_pitch, kar\_p1.c, 100,
       speed\_p1\_middle, speed\_p1\_outer);   
            Send\_Leg3\_Kar\_And\_Velocity( kar\_p2.a - kar\_p2.b, 0, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer); 
            Send\_Leg4\_Kar\_And\_Velocity( kar\_p1.a +  kar\_p1.b, 0, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer);   
            Send\_Leg1\_Kar\_And\_Velocity( kar\_p1.a -  kar\_p1.b, corner\_pitch, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer); 
            Send\_Leg2\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, corner\_pitch, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer);
            Send\_Leg6\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, - corner\_pitch, kar\_p2.c, 100,
       speed\_p2\_middle, speed\_p2\_outer);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); 
            \}
        \}
\}

void Dance(float x, float y)
\{
    float l = 12;//fötters förskjuting från kropp i x-led OBS orginal = 13, numera 12
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 4
    int speed\_inner\_dance= 180;
    int speed\_middle\_dance= 200;
    int speed\_outer\_dance  = 200;
    float max\_r = 7; 
    float max\_step= 0.3; 
    float height\_step = 0.5; 
        
    // höjdjustering
    float height; 
    if(last\_height>12)
    \{
        height=last\_height-height\_step; 
    \}
    if(last\_height<10)
    \{
        height=last\_height+height\_step; 
    \}
    else 
    \{
        height=11;
    \}
    last\_height = height; 
        
    // lågpass 
    float direction\_x = x-dance\_x; 
    float direction\_y = y-dance\_y; 
    float diff= sqrt(pow(direction\_x,2) + pow(direction\_y,2));
    if(diff>max\_step)
    \{
        dance\_x = dance\_x + direction\_x/diff*max\_step;
        dance\_y = dance\_y + direction\_y/diff*max\_step;
    \}
    else
    \{
    dance\_x = dance\_x + direction\_x; 
    dance\_y = dance\_y + direction\_y;
        
    \}
        
    //Begränsningar i radie;
    dance\_r = sqrt(pow(dance\_y,2) + pow(dance\_x,2));
    if(dance\_r>max\_r)
    \{
        dance\_x= dance\_x/dance\_r*max\_r;
        dance\_y= dance\_y/dance\_r*max\_r;
    \}
        
    Send\_Leg1\_Kar\_And\_Velocity(l+dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg2\_Kar\_And\_Velocity(l-dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg3\_Kar\_And\_Velocity(l+dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg4\_Kar\_And\_Velocity(l-dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg5\_Kar\_And\_Velocity(l+dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg6\_Kar\_And\_Velocity(l-dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    \_delay\_ms(15);
    
\}

void Dance\_Cyl(float r, float th)
\{
    float x = r *cos(th);
    float y = r * sin(th); 
    Dance(x,y);
\}

void Victory\_Dance(void)
\{
    float pi = 3.14159265359;
    
    //fixa rörelsemönster 
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01);
    \}
    for(float i = 1; i< 200; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,6-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6+6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0, 6*0.05*i);
    \}
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(0, 2*pi*0.01);
    \}
\}

}
00280     \{
00281         stroke = 0;
00282         lift = 0;
00283         dx = 0;
00284     \}
00285     
00286     \textcolor{comment}{//gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde}
00287     \textcolor{keywordflow}{while}( walk\_break || ( \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} != \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2 && \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} !=  
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2))
00288     \{
00289         walk\_break = 0;
00290             \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} < \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length})
00291         \{
00292             \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} += 1; \textcolor{comment}{//stegar upp index}
00293         \}
00294         \textcolor{keywordflow}{else}
00295         \{
00296             \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} = 1; \textcolor{comment}{//nollar index}
00297         \}
00298         
00299         \textcolor{comment}{//stegvis höjdjustering}
00300         \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} += height\_step;
00301         \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}= \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} + \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length}/2; \textcolor{comment}{//benpar 2 förskjuts en halv fas}
00302         
00303         \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} > \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length}) \textcolor{comment}{//ser till att det blir cykliskt}
00304         \{
00305             \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} -= \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length};
00306         \}
00307         
00308         \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} <= 4 )
00309         \{
00310             \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down} =1; \textcolor{comment}{//berättar om benpar ska sättas ner}
00311         \}
00312         \textcolor{keywordflow}{else}
00313         \{
00314             \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down} = 0;
00315         \}
00316                 
00317         \textcolor{keywordflow}{if}((\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} <= 4))
00318         \{
00319             \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down} =1;
00320         \}
00321         \textcolor{keywordflow}{else}
00322         \{
00323             \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down} = 0;
00324         \}
00325     
00326         \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} <= \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l})
00327         \{
00328             dx\_p1 = (\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1}-\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2) * dx/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l};
00329         \}
00330         \textcolor{keywordflow}{else}
00331         \{
00332             dx\_p1 = (\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l} + \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l}/2 - \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1}) * dx/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l};
00333         \}
00334         
00335         \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} <= \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l})
00336         \{
00337             dx\_p2 = (\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}-\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2) * dx/\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l};
00338         \}
00339         \textcolor{keywordflow}{else}
00340         \{
00341             dx\_p2 = (\hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l} + \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l}/2 - \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}) * dx/
      \hyperlink{gangstilar_8c_a9a74797712c10908dbbc9d01ace4fadd}{swing\_l};
00342         \}
00343     
00344         speed\_p1 = \hyperlink{gangstilar_8c_a6bb8056658634de06f155394bd298410}{Calc\_Servo\_Speed}(theta, sgn\_theta, \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down}, dx, sgn\_dx);
00345         speed\_p2 = \hyperlink{gangstilar_8c_a6bb8056658634de06f155394bd298410}{Calc\_Servo\_Speed}(theta, sgn\_theta, \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down}, dx, sgn\_dx);
00346 
00347         \textcolor{keywordflow}{if}(theta * sgn\_theta < 0.01) \textcolor{comment}{//behöver ej gå via cyl koord vid rak gång.}
00348         \{
00349             kar\_p1 = \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(l, stroke, \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}, lift, \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1}); \textcolor{comment}{//kart koord för par 1}
00350             kar\_p2 = \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(l, stroke, \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}, lift, \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}); \textcolor{comment}{//kart koord för par 2}
00351             
00352             \hyperlink{gangstilar_8c_a457024b585cd87287d5e05809a848e94}{Send\_Legs\_Kar}(kar\_p1, kar\_p2, corner\_pitch, speed\_p1, speed\_p2, dx\_p1, dx\_p2);
00353             
00354             \textcolor{keywordflow}{if}( walk\_break || (\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} != \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2 && \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} != 
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2))
00355             \{
00356             \_delay\_ms(7); \textcolor{comment}{//för kart skippar på sista loopen, pga tid som mainloop tar }
00357             \}
00358         \}
00359         \textcolor{keywordflow}{else} \textcolor{comment}{//om sväng}
00360         \{
00361             lift = 1.5 + theta * sgn\_theta * 1.2; 
00362             kar\_p1 = \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(l, stroke, \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}, lift, \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1}); \textcolor{comment}{//kart koord för par 1}
00363             kar\_p2 = \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(l, stroke, \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}, lift, \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}); \textcolor{comment}{//kart koord för par 2}
00364             
00365             \hyperlink{gangstilar_8c_a0ad2cf3e9047e6311cdac98a8bce6ed6}{Rotate\_And\_Send\_Legs}(kar\_p1, kar\_p2, corner\_pitch, sgn\_speed, theta, 
      speed\_p1, speed\_p2, dx\_p1, dx\_p2);
00366             
00367             \textcolor{keywordflow}{if}( walk\_break || ( \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} != \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2 && \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}  !=  
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2))
00368             \{
00369             \_delay\_ms(5); \textcolor{comment}{//Delay för cyl skippar på sista loopen, pga tids som mainloop tar TEST}
00370             \}
00371         \}
00372     \}
00373     \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} = \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height};
00374 \}
00375 
00376 \textcolor{comment}{//Går en halv cykel crabgång}
\hypertarget{gangstilar_8c_source.tex_l00377}{}\hyperlink{gangstilar_8h_ad538f984b6d02e469da2ce39d51bf4b5}{00377} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_ad538f984b6d02e469da2ce39d51bf4b5}{Walk\_Half\_Crab\_Cycle}(int8\_t \hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed})\textcolor{comment}{// höger är possitivt}
00378 \{
00379     
00380     \textcolor{keywordtype}{float} l = 12;\textcolor{comment}{//fötters förskjuting från kropp i x-led }
00381     \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_ae9651b009c7f17475dac0accfd2ddf98}{corner\_pitch} = 4; \textcolor{comment}{//förskjutning av arbetsområde i y-led för hörnben }
00382     \textcolor{keywordtype}{int} sgn\_speed = (speed >= 0) - (speed < 0) ;
00383     uint8\_t walk\_break = 1;
00384     \textcolor{keywordtype}{float} stroke =\hyperlink{styr_2styr_2main_8c_a7f7e4724cf57d59513b39c5ecc81adc8}{speed};  \textcolor{comment}{//steglängd }
00385     \textcolor{keywordflow}{if}(speed * sgn\_speed <2)
00386     \{
00387         \textcolor{keywordflow}{return};
00388     \}
00389     \textcolor{keywordflow}{if}(speed* sgn\_speed > 6)
00390     \{
00391         speed = 6* sgn\_speed;
00392     \}
00393 
00394     \textcolor{keywordflow}{if}(speed == 0) \textcolor{comment}{// gör inget}
00395     \{
00396         \textcolor{keywordflow}{return};
00397     \}
00398     \textcolor{comment}{//justerar höjd om den är på oönskad nivå != 11)
    \{
        Walk\_Half\_Cycle(0,0,11,0);
    \}
    //gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde
    while( walk\_break || ( n\_1 != support\_l/2 && n\_2 !=  support\_l/2))
    \{
        walk\_break = 0;
            if(n\_1 < cycle\_length)
        \{
            n\_1 += 1; //stegar upp index
        \}
        else
        \{
            n\_1 = 1; //nollar index
        \}
        
        n\_2= n\_1 + cycle\_length/2; //barnpar 2 förskjuts en halv fas
        
        if(n\_2 > cycle\_length) //ser till att det blir cykliskt
        \{
            n\_2 -= cycle\_length;
        \}
        
        if(n\_1 <= 4 )
        \{
            p1\_down =1;
        \}
        else
        \{
            p1\_down = 0;
        \}
                
        if((n\_2 <= 4))
        \{
            p2\_down =1;
        \}
        else
        \{
            p2\_down = 0;
        \}
        
        triple\_float kar\_p1;
        triple\_float kar\_p2;
        
        //servospeeds
        float speed\_p1\_middle = 310- 80 * p1\_down;
        float speed\_p1\_outer = 310 - 80 * p1\_down;
        float speed\_p2\_middle = 310 - 80 * p2\_down;
        float speed\_p2\_outer = 310 - 80 * p2\_down;

        float lift =1.4; 
    
            kar\_p1 = Tripod(l, stroke, last\_height, lift, n\_1); //kart koord för par 1
            kar\_p2 = Tripod(l, stroke, last\_height, lift, n\_2); //kart koord för par 2
            
            Send\_Leg5\_Kar\_And\_Velocity( kar\_p1.a - kar\_p1.b, - corner\_pitch, kar\_p1.c, 100,
       speed\_p1\_middle, speed\_p1\_outer);   
            Send\_Leg3\_Kar\_And\_Velocity( kar\_p2.a - kar\_p2.b, 0, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer); 
            Send\_Leg4\_Kar\_And\_Velocity( kar\_p1.a +  kar\_p1.b, 0, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer);   
            Send\_Leg1\_Kar\_And\_Velocity( kar\_p1.a -  kar\_p1.b, corner\_pitch, kar\_p1.c, 100, speed\_p1\_middle,
       speed\_p1\_outer); 
            Send\_Leg2\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, corner\_pitch, kar\_p2.c, 100, speed\_p2\_middle,
       speed\_p2\_outer);
            Send\_Leg6\_Kar\_And\_Velocity( kar\_p2.a + kar\_p2.b, - corner\_pitch, kar\_p2.c, 100,
       speed\_p2\_middle, speed\_p2\_outer);
            
            if( walk\_break || (n\_1 != support\_l/2 && n\_2 != support\_l/2))
            \{
            \_delay\_ms(7); 
            \}
        \}
\}

void Dance(float x, float y)
\{
    float l = 12;//fötters förskjuting från kropp i x-led OBS orginal = 13, numera 12
    float corner\_pitch = 4; //förskjutning av arbetsområde i y-led för hörnben 4
    int speed\_inner\_dance= 180;
    int speed\_middle\_dance= 200;
    int speed\_outer\_dance  = 200;
    float max\_r = 7; 
    float max\_step= 0.3; 
    float height\_step = 0.5; 
        
    // höjdjustering
    float height; 
    if(last\_height>12)
    \{
        height=last\_height-height\_step; 
    \}
    if(last\_height<10)
    \{
        height=last\_height+height\_step; 
    \}
    else 
    \{
        height=11;
    \}
    last\_height = height; 
        
    // lågpass 
    float direction\_x = x-dance\_x; 
    float direction\_y = y-dance\_y; 
    float diff= sqrt(pow(direction\_x,2) + pow(direction\_y,2));
    if(diff>max\_step)
    \{
        dance\_x = dance\_x + direction\_x/diff*max\_step;
        dance\_y = dance\_y + direction\_y/diff*max\_step;
    \}
    else
    \{
    dance\_x = dance\_x + direction\_x; 
    dance\_y = dance\_y + direction\_y;
        
    \}
        
    //Begränsningar i radie;
    dance\_r = sqrt(pow(dance\_y,2) + pow(dance\_x,2));
    if(dance\_r>max\_r)
    \{
        dance\_x= dance\_x/dance\_r*max\_r;
        dance\_y= dance\_y/dance\_r*max\_r;
    \}
        
    Send\_Leg1\_Kar\_And\_Velocity(l+dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg2\_Kar\_And\_Velocity(l-dance\_x, -dance\_y + corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg3\_Kar\_And\_Velocity(l+dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg4\_Kar\_And\_Velocity(l-dance\_x, -dance\_y, -height, speed\_inner\_dance, speed\_middle\_dance,
       speed\_outer\_dance);
    Send\_Leg5\_Kar\_And\_Velocity(l+dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    Send\_Leg6\_Kar\_And\_Velocity(l-dance\_x, -dance\_y - corner\_pitch, -height, speed\_inner\_dance,
       speed\_middle\_dance, speed\_outer\_dance);
    \_delay\_ms(15);
    
\}

void Dance\_Cyl(float r, float th)
\{
    float x = r *cos(th);
    float y = r * sin(th); 
    Dance(x,y);
\}

void Victory\_Dance(void)
\{
    float pi = 3.14159265359;
    
    //fixa rörelsemönster 
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01);
    \}
    for(float i = 1; i< 200; ++i)
    \{
        Dance\_Cyl(6, 2*pi*0.01*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,6-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0,-6+6*0.05*i);
    \}
    for(float i = 1; i< 20; ++i)
    \{
        Dance(0, 6*0.05*i);
    \}
    for(float i = 1; i< 10; ++i)
    \{
        Dance\_Cyl(0, 2*pi*0.01);
    \}
\}

}
00399     \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} != 11)
00400     \{
00401         \hyperlink{gangstilar_8c_a8b22e9229a15d20adb676428ad7f6dac}{Walk\_Half\_Cycle}(0,0,11,0);
00402     \}
00403     \textcolor{comment}{//gångloop, utför en halv gångfas och stannar när stödjande ben är i mitten av arbetsområde}
00404     \textcolor{keywordflow}{while}( walk\_break || ( \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} != \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2 && \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} !=  
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2))
00405     \{
00406         walk\_break = 0;
00407             \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} < \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length})
00408         \{
00409             \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} += 1; \textcolor{comment}{//stegar upp index}
00410         \}
00411         \textcolor{keywordflow}{else}
00412         \{
00413             \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} = 1; \textcolor{comment}{//nollar index}
00414         \}
00415         
00416         \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}= \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} + \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length}/2; \textcolor{comment}{//barnpar 2 förskjuts en halv fas}
00417         
00418         \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} > \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length}) \textcolor{comment}{//ser till att det blir cykliskt}
00419         \{
00420             \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} -= \hyperlink{gangstilar_8c_a55033c7806947634d32adf5ad4b27c72}{cycle\_length};
00421         \}
00422         
00423         \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} <= 4 )
00424         \{
00425             \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down} =1;
00426         \}
00427         \textcolor{keywordflow}{else}
00428         \{
00429             \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down} = 0;
00430         \}
00431                 
00432         \textcolor{keywordflow}{if}((\hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} <= 4))
00433         \{
00434             \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down} =1;
00435         \}
00436         \textcolor{keywordflow}{else}
00437         \{
00438             \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down} = 0;
00439         \}
00440         
00441         \hyperlink{structtriple__float}{triple\_float} kar\_p1;
00442         \hyperlink{structtriple__float}{triple\_float} kar\_p2;
00443         
00444         \textcolor{comment}{//servospeeds}
00445         \textcolor{keywordtype}{float} speed\_p1\_middle = 310- 80 * \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down};
00446         \textcolor{keywordtype}{float} speed\_p1\_outer = 310 - 80 * \hyperlink{gangstilar_8c_a0fb4659f2b5bb60bc4952b0ce04a729a}{p1\_down};
00447         \textcolor{keywordtype}{float} speed\_p2\_middle = 310 - 80 * \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down};
00448         \textcolor{keywordtype}{float} speed\_p2\_outer = 310 - 80 * \hyperlink{gangstilar_8c_a45aa440e6a2fcc55e6cfccf902041f66}{p2\_down};
00449 
00450         \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_a5e433c2d90f9d7f1ff1868b9e8b91868}{lift} =1.4; 
00451     
00452             kar\_p1 = \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(l, stroke, \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}, lift, \hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1}); \textcolor{comment}{//kart koord för par 1}
00453             kar\_p2 = \hyperlink{gangstilar_8c_ac6bbb42bb1b2d403d560a2a2b15c1cc8}{Tripod}(l, stroke, \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}, lift, \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2}); \textcolor{comment}{//kart koord för par 2}
00454             
00455             \hyperlink{servo___u_a_r_t_8c_a7cd98c6b9c0d2127feb9dfece072b3b0}{Send\_Leg5\_Kar\_And\_Velocity}( kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, - corner\_pitch, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, 100, speed\_p1\_middle, speed\_p1\_outer);   
00456             \hyperlink{servo___u_a_r_t_8c_a15260e1c5159c1047ca8ec867a8fc56c}{Send\_Leg3\_Kar\_And\_Velocity}( kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} - kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, 0, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, 100, speed\_p2\_middle, speed\_p2\_outer); 
00457             \hyperlink{servo___u_a_r_t_8c_ae1cff60ca27b892abf86b8a55b6b4ccd}{Send\_Leg4\_Kar\_And\_Velocity}( kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} +  kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, 0, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, 100, speed\_p1\_middle, speed\_p1\_outer);    
00458             \hyperlink{servo___u_a_r_t_8c_a1501df88c7ba1630f81577522ac2bbeb}{Send\_Leg1\_Kar\_And\_Velocity}( kar\_p1.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} -  kar\_p1.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, corner\_pitch, kar\_p1.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, 100, speed\_p1\_middle, speed\_p1\_outer); 
00459             \hyperlink{servo___u_a_r_t_8c_a7ab1230fdabe0bcf16d18c331c75057e}{Send\_Leg2\_Kar\_And\_Velocity}( kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, corner\_pitch, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, 100, speed\_p2\_middle, speed\_p2\_outer);
00460             \hyperlink{servo___u_a_r_t_8c_a8cd710e0714336201bd84b46a1e1877d}{Send\_Leg6\_Kar\_And\_Velocity}( kar\_p2.\hyperlink{structtriple__float_a4aec1a5be9d9a4a394a2e49e9744286e}{a} + kar\_p2.
      \hyperlink{structtriple__float_a83fc1af92e29717b4513d121b0c72c7d}{b}, - corner\_pitch, kar\_p2.\hyperlink{structtriple__float_ae78103ab33f03590e84ff7bc735629d7}{c}, 100, speed\_p2\_middle, speed\_p2\_outer);
00461             
00462             \textcolor{keywordflow}{if}( walk\_break || (\hyperlink{gangstilar_8c_a910b6f9f09db8ef105682d48271387a0}{n\_1} != \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2 && \hyperlink{gangstilar_8c_a6c5756c1471acfef79bf1d39a054d2f5}{n\_2} != 
      \hyperlink{gangstilar_8c_ad3c8cf64391a5b011898f0f8aece4161}{support\_l}/2))
00463             \{
00464             \_delay\_ms(7); 
00465             \}
00466         \}
00467 \}
00468 
\hypertarget{gangstilar_8c_source.tex_l00469}{}\hyperlink{gangstilar_8h_a52ff26f8e5f26305582c67be8be4417b}{00469} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a52ff26f8e5f26305582c67be8be4417b}{Dance}(\textcolor{keywordtype}{float} \hyperlink{sensor_8h_a6c4b361d72eb3767ba424ac9a6ecf52b}{x}, \textcolor{keywordtype}{float} \hyperlink{sensor_8h_a0ed6a908288e0cd87f79c1b5ab56d07c}{y})
00470 \{
00471     \textcolor{keywordtype}{float} l = 12;\textcolor{comment}{//fötters förskjuting från kropp i x-led OBS orginal = 13, numera 12}
00472     \textcolor{keywordtype}{float} \hyperlink{over__hinder_8c_ae9651b009c7f17475dac0accfd2ddf98}{corner\_pitch} = 4; \textcolor{comment}{//förskjutning av arbetsområde i y-led för hörnben 4}
00473     \textcolor{keywordtype}{int} speed\_inner\_dance= 180;
00474     \textcolor{keywordtype}{int} speed\_middle\_dance= 200;
00475     \textcolor{keywordtype}{int} speed\_outer\_dance  = 200;
00476     \textcolor{keywordtype}{float} max\_r = 7; 
00477     \textcolor{keywordtype}{float} max\_step= 0.3; 
00478     \textcolor{keywordtype}{float} height\_step = 0.5; 
00479         
00480     \textcolor{comment}{// höjdjustering}
00481     \textcolor{keywordtype}{float} \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height}; 
00482     \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}>12)
00483     \{
00484         height=\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}-height\_step; 
00485     \}
00486     \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}<10)
00487     \{
00488         height=\hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height}+height\_step; 
00489     \}
00490     \textcolor{keywordflow}{else} 
00491     \{
00492         height=11;
00493     \}
00494     \hyperlink{gangstilar_8c_abb6e5203c6a2802d8de6f3ac6730feee}{last\_height} = \hyperlink{styr_2styr_2main_8c_a48083b65ac9a863566dc3e3fff09a5b4}{height}; 
00495         
00496     \textcolor{comment}{// lågpass }
00497     \textcolor{keywordtype}{float} direction\_x = x-\hyperlink{gangstilar_8c_a0b45b9e41407b1bebe9114f0610eb27c}{dance\_x}; 
00498     \textcolor{keywordtype}{float} direction\_y = y-\hyperlink{gangstilar_8c_a8596518927328da6f2b1e575890af503}{dance\_y}; 
00499     \textcolor{keywordtype}{float} diff= sqrt(pow(direction\_x,2) + pow(direction\_y,2));
00500     \textcolor{keywordflow}{if}(diff>max\_step)
00501     \{
00502         dance\_x = dance\_x + direction\_x/diff*max\_step;
00503         dance\_y = dance\_y + direction\_y/diff*max\_step;
00504     \}
00505     \textcolor{keywordflow}{else}
00506     \{
00507     dance\_x = dance\_x + direction\_x; 
00508     dance\_y = dance\_y + direction\_y;
00509         
00510     \}
00511         
00512     \textcolor{comment}{//Begränsningar i radie;}
00513     \hyperlink{gangstilar_8h_a53714f6e2fcbc2539af246d0a0446cbe}{dance\_r} = sqrt(pow(dance\_y,2) + pow(dance\_x,2));
00514     \textcolor{keywordflow}{if}(\hyperlink{gangstilar_8h_a53714f6e2fcbc2539af246d0a0446cbe}{dance\_r}>max\_r)
00515     \{
00516         dance\_x= dance\_x/\hyperlink{gangstilar_8h_a53714f6e2fcbc2539af246d0a0446cbe}{dance\_r}*max\_r;
00517         dance\_y= dance\_y/\hyperlink{gangstilar_8h_a53714f6e2fcbc2539af246d0a0446cbe}{dance\_r}*max\_r;
00518     \}
00519         
00520     \hyperlink{servo___u_a_r_t_8c_a1501df88c7ba1630f81577522ac2bbeb}{Send\_Leg1\_Kar\_And\_Velocity}(l+dance\_x, -dance\_y + corner\_pitch, -height, 
      speed\_inner\_dance, speed\_middle\_dance, speed\_outer\_dance);
00521     \hyperlink{servo___u_a_r_t_8c_a7ab1230fdabe0bcf16d18c331c75057e}{Send\_Leg2\_Kar\_And\_Velocity}(l-dance\_x, -dance\_y + corner\_pitch, -height, 
      speed\_inner\_dance, speed\_middle\_dance, speed\_outer\_dance);
00522     \hyperlink{servo___u_a_r_t_8c_a15260e1c5159c1047ca8ec867a8fc56c}{Send\_Leg3\_Kar\_And\_Velocity}(l+dance\_x, -dance\_y, -height, speed\_inner\_dance, 
      speed\_middle\_dance, speed\_outer\_dance);
00523     \hyperlink{servo___u_a_r_t_8c_ae1cff60ca27b892abf86b8a55b6b4ccd}{Send\_Leg4\_Kar\_And\_Velocity}(l-dance\_x, -dance\_y, -height, speed\_inner\_dance, 
      speed\_middle\_dance, speed\_outer\_dance);
00524     \hyperlink{servo___u_a_r_t_8c_a7cd98c6b9c0d2127feb9dfece072b3b0}{Send\_Leg5\_Kar\_And\_Velocity}(l+dance\_x, -dance\_y - corner\_pitch, -height, 
      speed\_inner\_dance, speed\_middle\_dance, speed\_outer\_dance);
00525     \hyperlink{servo___u_a_r_t_8c_a8cd710e0714336201bd84b46a1e1877d}{Send\_Leg6\_Kar\_And\_Velocity}(l-dance\_x, -dance\_y - corner\_pitch, -height, 
      speed\_inner\_dance, speed\_middle\_dance, speed\_outer\_dance);
00526     \_delay\_ms(15);
00527     
00528 \}
00529 
\hypertarget{gangstilar_8c_source.tex_l00530}{}\hyperlink{gangstilar_8h_a47315f1535b41ff12e6a00ad36e681d7}{00530} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a47315f1535b41ff12e6a00ad36e681d7}{Dance\_Cyl}(\textcolor{keywordtype}{float} r, \textcolor{keywordtype}{float} th)
00531 \{
00532     \textcolor{keywordtype}{float} \hyperlink{sensor_8h_a6c4b361d72eb3767ba424ac9a6ecf52b}{x} = r *cos(th);
00533     \textcolor{keywordtype}{float} \hyperlink{sensor_8h_a0ed6a908288e0cd87f79c1b5ab56d07c}{y} = r * sin(th); 
00534     \hyperlink{gangstilar_8c_a52ff26f8e5f26305582c67be8be4417b}{Dance}(x,y);
00535 \}
00536 
\hypertarget{gangstilar_8c_source.tex_l00537}{}\hyperlink{gangstilar_8h_a74e3cb81b1d6c82b020d36f856b0b1f7}{00537} \textcolor{keywordtype}{void} \hyperlink{gangstilar_8c_a74e3cb81b1d6c82b020d36f856b0b1f7}{Victory\_Dance}(\textcolor{keywordtype}{void})
00538 \{
00539     \textcolor{keywordtype}{float} pi = 3.14159265359;
00540     
00541     \textcolor{comment}{//fixa rörelsemönster }
00542     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 10; ++i)
00543     \{
00544         \hyperlink{gangstilar_8c_a47315f1535b41ff12e6a00ad36e681d7}{Dance\_Cyl}(6, 2*pi*0.01);
00545     \}
00546     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 200; ++i)
00547     \{
00548         \hyperlink{gangstilar_8c_a47315f1535b41ff12e6a00ad36e681d7}{Dance\_Cyl}(6, 2*pi*0.01*i);
00549     \}
00550     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 20; ++i)
00551     \{
00552         \hyperlink{gangstilar_8c_a52ff26f8e5f26305582c67be8be4417b}{Dance}(0,6-6*0.05*i);
00553     \}
00554     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 20; ++i)
00555     \{
00556         \hyperlink{gangstilar_8c_a52ff26f8e5f26305582c67be8be4417b}{Dance}(0,-6*0.05*i);
00557     \}
00558     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 20; ++i)
00559     \{
00560         \hyperlink{gangstilar_8c_a52ff26f8e5f26305582c67be8be4417b}{Dance}(0,-6+6*0.05*i);
00561     \}
00562     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 20; ++i)
00563     \{
00564         \hyperlink{gangstilar_8c_a52ff26f8e5f26305582c67be8be4417b}{Dance}(0, 6*0.05*i);
00565     \}
00566     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{float} i = 1; i< 10; ++i)
00567     \{
00568         \hyperlink{gangstilar_8c_a47315f1535b41ff12e6a00ad36e681d7}{Dance\_Cyl}(0, 2*pi*0.01);
00569     \}
00570 \}
00571 
\end{DoxyCode}
