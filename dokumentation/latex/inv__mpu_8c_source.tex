\hypertarget{inv__mpu_8c_source}{}\section{inv\+\_\+mpu.\+c}
\label{inv__mpu_8c_source}\index{sensor/sensor/inv\+\_\+mpu.\+c@{sensor/sensor/inv\+\_\+mpu.\+c}}

\begin{DoxyCode}
00001 
\hypertarget{inv__mpu_8c_source.tex_l00008}{}\hyperlink{inv__mpu_8c_a43bafb28b29491ec7f871319b5a3b2f8}{00008} \textcolor{preprocessor}{#define F\_CPU 16000000UL}
00009 
00010 \textcolor{preprocessor}{#include <stdio.h>}
00011 \textcolor{preprocessor}{#include <stdint.h>}
00012 \textcolor{preprocessor}{#include <stdlib.h>}
00013 \textcolor{preprocessor}{#include <string.h>}
00014 \textcolor{preprocessor}{#include <math.h>}
00015 \textcolor{preprocessor}{#include <util/delay.h>}
00016 \textcolor{preprocessor}{#include "\hyperlink{inv__mpu_8h}{inv\_mpu.h}"}
00017 
00018 \textcolor{comment}{/* The following functions must be defined for this platform:}
00019 \textcolor{comment}{ * i2c\_write(unsigned char slave\_addr, unsigned char reg\_addr,}
00020 \textcolor{comment}{ *      unsigned char length, unsigned char const *data)}
00021 \textcolor{comment}{ * i2c\_read(unsigned char slave\_addr, unsigned char reg\_addr,}
00022 \textcolor{comment}{ *      unsigned char length, unsigned char *data)}
00023 \textcolor{comment}{ * delay\_ms(unsigned long num\_ms)}
00024 \textcolor{comment}{ * get\_ms(unsigned long *count)}
00025 \textcolor{comment}{ * reg\_int\_cb(void (*cb)(void), unsigned char port, unsigned char pin)}
00026 \textcolor{comment}{ * labs(long x)}
00027 \textcolor{comment}{ * fabsf(float x)}
00028 \textcolor{comment}{ * min(int a, int b)}
00029 \textcolor{comment}{ */}
00030 \textcolor{comment}{//#if defined MOTION\_DRIVER\_TARGET\_MSP430}
00031 \textcolor{comment}{//#include "msp430.h"}
00032 \textcolor{comment}{//#include "msp430\_i2c.h"}
00033 \textcolor{comment}{//#include "msp430\_clock.h"}
00034 \textcolor{comment}{//#include "msp430\_interrupt.h"}
00035 \textcolor{comment}{//#define i2c\_write   msp430\_i2c\_write}
00036 \textcolor{comment}{//#define i2c\_read    msp430\_i2c\_read}
00037 \textcolor{comment}{//#define delay\_ms    msp430\_delay\_ms}
00038 \textcolor{comment}{//#define get\_ms      msp430\_get\_clock\_ms}
00039 \textcolor{comment}{//static inline int reg\_int\_cb(struct int\_param\_s *int\_param)}
00040 \textcolor{comment}{//\{}
00041     \textcolor{comment}{//return msp430\_reg\_int\_cb(int\_param->cb, int\_param->pin, int\_param->lp\_exit,}
00042         \textcolor{comment}{//int\_param->active\_low);}
00043 \textcolor{comment}{//\}}
00044 \textcolor{comment}{//#define log\_i(...)     do \{\} while (0)}
00045 \textcolor{comment}{//#define log\_e(...)     do \{\} while (0)}
00048 \textcolor{comment}{}\textcolor{comment}{//#define fabs        fabsf}
00049 \textcolor{comment}{//#define min(a,b) ((a<b)?a:b)}
00050 \textcolor{comment}{//#elif defined EMPL\_TARGET\_MSP430}
00051 \textcolor{comment}{//#include "msp430.h"}
00052 \textcolor{comment}{//#include "msp430\_i2c.h"}
00053 \textcolor{comment}{//#include "msp430\_clock.h"}
00054 \textcolor{comment}{//#include "msp430\_interrupt.h"}
00055 \textcolor{comment}{//#include "log.h"}
00056 \textcolor{comment}{//#define i2c\_write   msp430\_i2c\_write}
00057 \textcolor{comment}{//#define i2c\_read    msp430\_i2c\_read}
00058 \textcolor{comment}{//#define delay\_ms    msp430\_delay\_ms}
00059 \textcolor{comment}{//#define get\_ms      msp430\_get\_clock\_ms}
00060 \textcolor{comment}{//static inline int reg\_int\_cb(struct int\_param\_s *int\_param)}
00061 \textcolor{comment}{//\{}
00062     \textcolor{comment}{//return msp430\_reg\_int\_cb(int\_param->cb, int\_param->pin, int\_param->lp\_exit,}
00063         \textcolor{comment}{//int\_param->active\_low);}
00064 \textcolor{comment}{//\}}
00065 \textcolor{comment}{//#define log\_i       MPL\_LOGI}
00066 \textcolor{comment}{//#define log\_e       MPL\_LOGE}
00069 \textcolor{comment}{}\textcolor{comment}{//#define fabs        fabsf}
00070 \textcolor{comment}{//#define min(a,b) ((a<b)?a:b)}
00071 \textcolor{comment}{//#elif defined EMPL\_TARGET\_UC3L0}
00073 \textcolor{comment}{} \textcolor{comment}{//* a TWI driver that follows the slave address + register address convention.}
00074  \textcolor{comment}{//*/}
00075 \textcolor{comment}{//#include "twi.h"}
00076 \textcolor{comment}{//#include "delay.h"}
00077 \textcolor{comment}{//#include "sysclk.h"}
00078 \textcolor{comment}{//#include "log.h"}
00079 \textcolor{comment}{//#include "sensors\_xplained.h"}
00080 \textcolor{comment}{//#include "uc3l0\_clock.h"}
00081 \textcolor{comment}{//#define i2c\_write(a, b, c, d)   twi\_write(a, b, d, c)}
00082 \textcolor{comment}{//#define i2c\_read(a, b, c, d)    twi\_read(a, b, d, c)}
00084 \textcolor{comment}{}\textcolor{comment}{//#define get\_ms  uc3l0\_get\_clock\_ms}
00085 \textcolor{comment}{//static inline int reg\_int\_cb(struct int\_param\_s *int\_param)}
00086 \textcolor{comment}{//\{}
00087     \textcolor{comment}{//sensor\_board\_irq\_connect(int\_param->pin, int\_param->cb, int\_param->arg);}
00088     \textcolor{comment}{//return 0;}
00089 \textcolor{comment}{//\}}
00090 \textcolor{comment}{//#define log\_i       MPL\_LOGI}
00091 \textcolor{comment}{//#define log\_e       MPL\_LOGE}
00093 \textcolor{comment}{}\textcolor{comment}{//#define labs        abs}
00094 \textcolor{comment}{//#define fabs(x)     (((x)>0)?(x):-(x))}
00095 \textcolor{comment}{//}
00096 \textcolor{comment}{//#else}
00097 \textcolor{comment}{//#error  Gyro driver is missing the system layer implementations.}
00098 \textcolor{comment}{//#endif}
00099 
\hypertarget{inv__mpu_8c_source.tex_l00100}{}\hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{00100} \textcolor{preprocessor}{#define log\_i(...)     do \{\} while (0)}
00101 \textcolor{comment}{//static inline int log\_i(const char *format, ...)}
00102 \textcolor{comment}{//\{}
00103 \textcolor{comment}{//  va\_list     marker;}
00104 \textcolor{comment}{//  char message[50];}
00105 \textcolor{comment}{//}
00106 \textcolor{comment}{//  va\_start(marker, format);}
00107 \textcolor{comment}{//  vsnprintf(message, 50, format, marker);}
00108 \textcolor{comment}{//  va\_end(marker);}
00109 \textcolor{comment}{//}
00110 \textcolor{comment}{//  Serial.print(message);}
00111 \textcolor{comment}{//\}}
00112 
00113 \textcolor{comment}{//static inline int log\_e(const char *message)}
00114 \textcolor{comment}{//\{}
00115     \textcolor{comment}{//Serial.print(message);}
00116 \textcolor{comment}{//\}}
00117 
00118 \textcolor{comment}{//#define i2c\_write   i2c\_write                                                 (XXXXXXX)}
00119 \textcolor{comment}{//#define i2c\_read    i2c\_read}
\hypertarget{inv__mpu_8c_source.tex_l00120}{}\hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{00120} \textcolor{preprocessor}{#define delay\_ms    \_delay\_ms}
00121 
00123 \textcolor{comment}{//\{}
00124     \textcolor{comment}{//pinMode(int\_param->pin, INPUT);}
00125     \textcolor{comment}{//attachInterrupt(int\_param->pin, int\_param->cb, RISING);}
00126 \textcolor{comment}{//\}}
00127 
00128 \textcolor{preprocessor}{#if !defined MPU6050 && !defined MPU9150 && !defined MPU6500 && !defined MPU9250}
00129 \textcolor{preprocessor}{#error  Which gyro are you using? Define MPUxxxx in your compiler options.}
00130 \textcolor{preprocessor}{#endif}
00131 
00132 \textcolor{comment}{/* Time for some messy macro work. =]}
00133 \textcolor{comment}{ * #define MPU9150}
00134 \textcolor{comment}{ * is equivalent to..}
00135 \textcolor{comment}{ * #define MPU6050}
00136 \textcolor{comment}{ * #define AK8975\_SECONDARY}
00137 \textcolor{comment}{ *}
00138 \textcolor{comment}{ * #define MPU9250}
00139 \textcolor{comment}{ * is equivalent to..}
00140 \textcolor{comment}{ * #define MPU6500}
00141 \textcolor{comment}{ * #define AK8963\_SECONDARY}
00142 \textcolor{comment}{ */}
00143 \textcolor{preprocessor}{#if defined MPU9150}
00144 \textcolor{preprocessor}{#ifndef MPU6050}
00145 \textcolor{preprocessor}{#define MPU6050}
00146 \textcolor{preprocessor}{#endif                          }\textcolor{comment}{/* #ifndef MPU6050 */}\textcolor{preprocessor}{}
00147 \textcolor{preprocessor}{#if defined AK8963\_SECONDARY}
00148 \textcolor{preprocessor}{#error "MPU9150 and AK8963\_SECONDARY cannot both be defined."}
00149 \textcolor{preprocessor}{#elif !defined AK8975\_SECONDARY }\textcolor{comment}{/* #if defined AK8963\_SECONDARY */}\textcolor{preprocessor}{}
00150 \textcolor{preprocessor}{#define AK8975\_SECONDARY}
00151 \textcolor{preprocessor}{#endif                          }\textcolor{comment}{/* #if defined AK8963\_SECONDARY */}\textcolor{preprocessor}{}
00152 \textcolor{preprocessor}{#elif defined MPU9250           }\textcolor{comment}{/* #if defined MPU9150 */}\textcolor{preprocessor}{}
00153 \textcolor{preprocessor}{#ifndef MPU6500}
00154 \textcolor{preprocessor}{#define MPU6500}
00155 \textcolor{preprocessor}{#endif                          }\textcolor{comment}{/* #ifndef MPU6500 */}\textcolor{preprocessor}{}
00156 \textcolor{preprocessor}{#if defined AK8975\_SECONDARY}
00157 \textcolor{preprocessor}{#error "MPU9250 and AK8975\_SECONDARY cannot both be defined."}
00158 \textcolor{preprocessor}{#elif !defined AK8963\_SECONDARY }\textcolor{comment}{/* #if defined AK8975\_SECONDARY */}\textcolor{preprocessor}{}
00159 \textcolor{preprocessor}{#define AK8963\_SECONDARY}
00160 \textcolor{preprocessor}{#endif                          }\textcolor{comment}{/* #if defined AK8975\_SECONDARY */}\textcolor{preprocessor}{}
00161 \textcolor{preprocessor}{#endif                          }\textcolor{comment}{/* #if defined MPU9150 */}\textcolor{preprocessor}{}
00162 
00163 \textcolor{preprocessor}{#if defined AK8975\_SECONDARY || defined AK8963\_SECONDARY}
00164 \textcolor{preprocessor}{#define AK89xx\_SECONDARY}
00165 \textcolor{preprocessor}{#else}
00166 \textcolor{comment}{/* #warning "No compass = less profit for Invensense. Lame." */}
00167 \textcolor{preprocessor}{#endif}
00168 
00169 \textcolor{keyword}{static} \textcolor{keywordtype}{int} set\_int\_enable(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} enable);
00170 
00171 \textcolor{comment}{/* Hardware registers needed by driver. */}
\hypertarget{inv__mpu_8c_source.tex_l00172}{}\hyperlink{structgyro__reg__s}{00172} \textcolor{keyword}{struct }\hyperlink{structgyro__reg__s}{gyro\_reg\_s} \{
\hypertarget{inv__mpu_8c_source.tex_l00173}{}\hyperlink{structgyro__reg__s_aa52d78bb2b62fee23a0b759e545dba4b}{00173}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_aa52d78bb2b62fee23a0b759e545dba4b}{who\_am\_i};
\hypertarget{inv__mpu_8c_source.tex_l00174}{}\hyperlink{structgyro__reg__s_a401bb6ee7e48a2bf55398cbaf70c0dc3}{00174}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a401bb6ee7e48a2bf55398cbaf70c0dc3}{rate\_div};
\hypertarget{inv__mpu_8c_source.tex_l00175}{}\hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{00175}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf};
\hypertarget{inv__mpu_8c_source.tex_l00176}{}\hyperlink{structgyro__reg__s_ae6ca290ca1a107f4cb7986047071d7d9}{00176}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ae6ca290ca1a107f4cb7986047071d7d9}{prod\_id};
\hypertarget{inv__mpu_8c_source.tex_l00177}{}\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{00177}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl};
\hypertarget{inv__mpu_8c_source.tex_l00178}{}\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{00178}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en};
\hypertarget{inv__mpu_8c_source.tex_l00179}{}\hyperlink{structgyro__reg__s_ac2b87a25876eb44862043cd56d33d49b}{00179}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ac2b87a25876eb44862043cd56d33d49b}{gyro\_cfg};
\hypertarget{inv__mpu_8c_source.tex_l00180}{}\hyperlink{structgyro__reg__s_a3e39cea9e122765d4770876d4ce6adc7}{00180}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a3e39cea9e122765d4770876d4ce6adc7}{accel\_cfg};
\hypertarget{inv__mpu_8c_source.tex_l00181}{}\hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{00181}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{accel\_cfg2};
\hypertarget{inv__mpu_8c_source.tex_l00182}{}\hyperlink{structgyro__reg__s_a14a0bff136c827f3f58f619f8045788b}{00182}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a14a0bff136c827f3f58f619f8045788b}{lp\_accel\_odr};
\hypertarget{inv__mpu_8c_source.tex_l00183}{}\hyperlink{structgyro__reg__s_a31322df7c5727b98480d1fcb18e040c5}{00183}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a31322df7c5727b98480d1fcb18e040c5}{motion\_thr};
\hypertarget{inv__mpu_8c_source.tex_l00184}{}\hyperlink{structgyro__reg__s_af858b8611ee183ec175c41ddb5db3511}{00184}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_af858b8611ee183ec175c41ddb5db3511}{motion\_dur};
\hypertarget{inv__mpu_8c_source.tex_l00185}{}\hyperlink{structgyro__reg__s_a769e352846cc0f576d321f5655f7c11c}{00185}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a769e352846cc0f576d321f5655f7c11c}{fifo\_count\_h};
\hypertarget{inv__mpu_8c_source.tex_l00186}{}\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{00186}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w};
\hypertarget{inv__mpu_8c_source.tex_l00187}{}\hyperlink{structgyro__reg__s_a1366c90aec04a4e1d212de76d3f0b6cc}{00187}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a1366c90aec04a4e1d212de76d3f0b6cc}{raw\_gyro};
\hypertarget{inv__mpu_8c_source.tex_l00188}{}\hyperlink{structgyro__reg__s_a3a78e67f9066b6b8601f375fcaadf005}{00188}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a3a78e67f9066b6b8601f375fcaadf005}{raw\_accel};
\hypertarget{inv__mpu_8c_source.tex_l00189}{}\hyperlink{structgyro__reg__s_abe413cb96d839cbe31417aa52d920f21}{00189}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_abe413cb96d839cbe31417aa52d920f21}{temp};
\hypertarget{inv__mpu_8c_source.tex_l00190}{}\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{00190}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable};
\hypertarget{inv__mpu_8c_source.tex_l00191}{}\hyperlink{structgyro__reg__s_a5362f39039c1bbcc9aaa5a973eb762da}{00191}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a5362f39039c1bbcc9aaa5a973eb762da}{dmp\_int\_status};
\hypertarget{inv__mpu_8c_source.tex_l00192}{}\hyperlink{structgyro__reg__s_a39621694d9d5d0c0488c66fa8d088562}{00192}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a39621694d9d5d0c0488c66fa8d088562}{int\_status};
\hypertarget{inv__mpu_8c_source.tex_l00193}{}\hyperlink{structgyro__reg__s_a9c4b97b2bf0f2fcee9538e74fcaf5c3f}{00193}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a9c4b97b2bf0f2fcee9538e74fcaf5c3f}{accel\_intel};
\hypertarget{inv__mpu_8c_source.tex_l00194}{}\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{00194}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1};
\hypertarget{inv__mpu_8c_source.tex_l00195}{}\hyperlink{structgyro__reg__s_adc9ae0e35f199b3349174ac09e219ecb}{00195}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_adc9ae0e35f199b3349174ac09e219ecb}{pwr\_mgmt\_2};
\hypertarget{inv__mpu_8c_source.tex_l00196}{}\hyperlink{structgyro__reg__s_a135c6ee7cb6bdbf6ef9471ce5a6e1724}{00196}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a135c6ee7cb6bdbf6ef9471ce5a6e1724}{int\_pin\_cfg};
\hypertarget{inv__mpu_8c_source.tex_l00197}{}\hyperlink{structgyro__reg__s_a1e6aa9b45ef18f1e5f6369c6383e1f0f}{00197}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a1e6aa9b45ef18f1e5f6369c6383e1f0f}{mem\_r\_w};
\hypertarget{inv__mpu_8c_source.tex_l00198}{}\hyperlink{structgyro__reg__s_a29bdc7a4514a6d9714e6f95958272a21}{00198}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a29bdc7a4514a6d9714e6f95958272a21}{accel\_offs};
\hypertarget{inv__mpu_8c_source.tex_l00199}{}\hyperlink{structgyro__reg__s_af48ab798d6b786068dfbba8bb176bf1e}{00199}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_af48ab798d6b786068dfbba8bb176bf1e}{i2c\_mst};
\hypertarget{inv__mpu_8c_source.tex_l00200}{}\hyperlink{structgyro__reg__s_ac5fa957c7e1347ce8cf61f4a5fc52a5c}{00200}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ac5fa957c7e1347ce8cf61f4a5fc52a5c}{bank\_sel};
\hypertarget{inv__mpu_8c_source.tex_l00201}{}\hyperlink{structgyro__reg__s_ae2cfd68006c94f82add6eab04990c73b}{00201}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ae2cfd68006c94f82add6eab04990c73b}{mem\_start\_addr};
\hypertarget{inv__mpu_8c_source.tex_l00202}{}\hyperlink{structgyro__reg__s_a0813e85e389743e828cc84c5b903ada1}{00202}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_a0813e85e389743e828cc84c5b903ada1}{prgm\_start\_h};
00203 \textcolor{preprocessor}{#if defined AK89xx\_SECONDARY}
00204     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s0\_addr;
00205     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s0\_reg;
00206     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s0\_ctrl;
00207     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s1\_addr;
00208     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s1\_reg;
00209     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s1\_ctrl;
00210     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s4\_ctrl;
00211     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s0\_do;
00212     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} s1\_do;
00213     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} i2c\_delay\_ctrl;
00214     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} raw\_compass;
00215     \textcolor{comment}{/* The I2C\_MST\_VDDIO bit is in this register. */}
00216     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} yg\_offs\_tc;
00217 \textcolor{preprocessor}{#endif}
00218 \};
00219 
00220 \textcolor{comment}{/* Information specific to a particular device. */}
\hypertarget{inv__mpu_8c_source.tex_l00221}{}\hyperlink{structhw__s}{00221} \textcolor{keyword}{struct }\hyperlink{structhw__s}{hw\_s} \{
\hypertarget{inv__mpu_8c_source.tex_l00222}{}\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{00222}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr};
\hypertarget{inv__mpu_8c_source.tex_l00223}{}\hyperlink{structhw__s_a36e9e2aea952cea137504c539cdb97dc}{00223}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structhw__s_a36e9e2aea952cea137504c539cdb97dc}{max\_fifo};
\hypertarget{inv__mpu_8c_source.tex_l00224}{}\hyperlink{structhw__s_a0c4fc172c338358ef1754c16c627eb08}{00224}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structhw__s_a0c4fc172c338358ef1754c16c627eb08}{num\_reg};
\hypertarget{inv__mpu_8c_source.tex_l00225}{}\hyperlink{structhw__s_ab73e7066167ecd424b3a619cddd0939a}{00225}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structhw__s_ab73e7066167ecd424b3a619cddd0939a}{temp\_sens};
\hypertarget{inv__mpu_8c_source.tex_l00226}{}\hyperlink{structhw__s_ac3cd6878189d0ca0cb389c5ab11c8395}{00226}     \textcolor{keywordtype}{short} \hyperlink{structhw__s_ac3cd6878189d0ca0cb389c5ab11c8395}{temp\_offset};
\hypertarget{inv__mpu_8c_source.tex_l00227}{}\hyperlink{structhw__s_a9e26f1784621a59cabcbfff28dc0b8ba}{00227}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structhw__s_a9e26f1784621a59cabcbfff28dc0b8ba}{bank\_size};
00228 \textcolor{preprocessor}{#if defined AK89xx\_SECONDARY}
00229     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} compass\_fsr;
00230 \textcolor{preprocessor}{#endif}
00231 \};
00232 
00233 \textcolor{comment}{/* When entering motion interrupt mode, the driver keeps track of the}
00234 \textcolor{comment}{ * previous state so that it can be restored at a later time.}
00235 \textcolor{comment}{ * TODO: This is tacky. Fix it.}
00236 \textcolor{comment}{ */}
\hypertarget{inv__mpu_8c_source.tex_l00237}{}\hyperlink{structmotion__int__cache__s}{00237} \textcolor{keyword}{struct }\hyperlink{structmotion__int__cache__s}{motion\_int\_cache\_s} \{
\hypertarget{inv__mpu_8c_source.tex_l00238}{}\hyperlink{structmotion__int__cache__s_a6424d033f39042e9e1105c14f6fa89d7}{00238}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structmotion__int__cache__s_a6424d033f39042e9e1105c14f6fa89d7}{gyro\_fsr};
\hypertarget{inv__mpu_8c_source.tex_l00239}{}\hyperlink{structmotion__int__cache__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{00239}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structmotion__int__cache__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr};
\hypertarget{inv__mpu_8c_source.tex_l00240}{}\hyperlink{structmotion__int__cache__s_a0ba1d4e0bb375eb3050352ddef12d25f}{00240}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structmotion__int__cache__s_a0ba1d4e0bb375eb3050352ddef12d25f}{lpf};
\hypertarget{inv__mpu_8c_source.tex_l00241}{}\hyperlink{structmotion__int__cache__s_a1aa4e026c4d2f691506f2d713a405aea}{00241}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structmotion__int__cache__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate};
\hypertarget{inv__mpu_8c_source.tex_l00242}{}\hyperlink{structmotion__int__cache__s_a90574f8e8515ef8fee3114ba7e0ddc5c}{00242}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structmotion__int__cache__s_a90574f8e8515ef8fee3114ba7e0ddc5c}{sensors\_on};
\hypertarget{inv__mpu_8c_source.tex_l00243}{}\hyperlink{structmotion__int__cache__s_ae3cc01b3471d10bd06f81fbf628f3e19}{00243}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structmotion__int__cache__s_ae3cc01b3471d10bd06f81fbf628f3e19}{fifo\_sensors};
\hypertarget{inv__mpu_8c_source.tex_l00244}{}\hyperlink{structmotion__int__cache__s_a49fb51079238683b21264827348b5968}{00244}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structmotion__int__cache__s_a49fb51079238683b21264827348b5968}{dmp\_on};
00245 \};
00246 
00247 \textcolor{comment}{/* Cached chip configuration data.}
00248 \textcolor{comment}{ * TODO: A lot of these can be handled with a bitmask.}
00249 \textcolor{comment}{ */}
\hypertarget{inv__mpu_8c_source.tex_l00250}{}\hyperlink{structchip__cfg__s}{00250} \textcolor{keyword}{struct }\hyperlink{structchip__cfg__s}{chip\_cfg\_s} \{
00251     \textcolor{comment}{/* Matches gyro\_cfg >> 3 & 0x03 */}
\hypertarget{inv__mpu_8c_source.tex_l00252}{}\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{00252}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr};
00253     \textcolor{comment}{/* Matches accel\_cfg >> 3 & 0x03 */}
\hypertarget{inv__mpu_8c_source.tex_l00254}{}\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{00254}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr};
00255     \textcolor{comment}{/* Enabled sensors. Uses same masks as fifo\_en, NOT pwr\_mgmt\_2. */}
\hypertarget{inv__mpu_8c_source.tex_l00256}{}\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{00256}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors};
00257     \textcolor{comment}{/* Matches config register. */}
\hypertarget{inv__mpu_8c_source.tex_l00258}{}\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{00258}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf};
\hypertarget{inv__mpu_8c_source.tex_l00259}{}\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{00259}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src};
00260     \textcolor{comment}{/* Sample rate, NOT rate divider. */}
\hypertarget{inv__mpu_8c_source.tex_l00261}{}\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{00261}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate};
00262     \textcolor{comment}{/* Matches fifo\_en register. */}
\hypertarget{inv__mpu_8c_source.tex_l00263}{}\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{00263}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable};
00264     \textcolor{comment}{/* Matches int enable register. */}
\hypertarget{inv__mpu_8c_source.tex_l00265}{}\hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{00265}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable};
00266     \textcolor{comment}{/* 1 if devices on auxiliary I2C bus appear on the primary. */}
\hypertarget{inv__mpu_8c_source.tex_l00267}{}\hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{00267}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{bypass\_mode};
00268     \textcolor{comment}{/* 1 if half-sensitivity.}
00269 \textcolor{comment}{     * NOTE: This doesn't belong here, but everything else in hw\_s is const,}
00270 \textcolor{comment}{     * and this allows us to save some precious RAM.}
00271 \textcolor{comment}{     */}
\hypertarget{inv__mpu_8c_source.tex_l00272}{}\hyperlink{structchip__cfg__s_af73df77287fdeba8d408c18f3905650f}{00272}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_af73df77287fdeba8d408c18f3905650f}{accel\_half};
00273     \textcolor{comment}{/* 1 if device in low-power accel-only mode. */}
\hypertarget{inv__mpu_8c_source.tex_l00274}{}\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{00274}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode};
00275     \textcolor{comment}{/* 1 if interrupts are only triggered on motion events. */}
\hypertarget{inv__mpu_8c_source.tex_l00276}{}\hyperlink{structchip__cfg__s_a28c5c373e0d7189a11c4ae5ca351ca30}{00276}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a28c5c373e0d7189a11c4ae5ca351ca30}{int\_motion\_only};
\hypertarget{inv__mpu_8c_source.tex_l00277}{}\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{00277}     \textcolor{keyword}{struct }\hyperlink{structmotion__int__cache__s}{motion\_int\_cache\_s} cache;
00278     \textcolor{comment}{/* 1 for active low interrupts. */}
\hypertarget{inv__mpu_8c_source.tex_l00279}{}\hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{00279}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{active\_low\_int};
00280     \textcolor{comment}{/* 1 for latched interrupts. */}
\hypertarget{inv__mpu_8c_source.tex_l00281}{}\hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{00281}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{latched\_int};
00282     \textcolor{comment}{/* 1 if DMP is enabled. */}
\hypertarget{inv__mpu_8c_source.tex_l00283}{}\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{00283}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on};
00284     \textcolor{comment}{/* Ensures that DMP will only be loaded once. */}
\hypertarget{inv__mpu_8c_source.tex_l00285}{}\hyperlink{structchip__cfg__s_afc32c3e58317c589014257dc9b1ee04b}{00285}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structchip__cfg__s_afc32c3e58317c589014257dc9b1ee04b}{dmp\_loaded};
00286     \textcolor{comment}{/* Sampling rate used when DMP is enabled. */}
\hypertarget{inv__mpu_8c_source.tex_l00287}{}\hyperlink{structchip__cfg__s_a5d17c6049cc8cb74faf5cdb942988294}{00287}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structchip__cfg__s_a5d17c6049cc8cb74faf5cdb942988294}{dmp\_sample\_rate};
00288 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00289     \textcolor{comment}{/* Compass sample rate. */}
00290     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} compass\_sample\_rate;
00291     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} compass\_addr;
00292     \textcolor{keywordtype}{short} mag\_sens\_adj[3];
00293 \textcolor{preprocessor}{#endif}
00294 \};
00295 
00296 \textcolor{comment}{/* Information for self-test. */}
\hypertarget{inv__mpu_8c_source.tex_l00297}{}\hyperlink{structtest__s}{00297} \textcolor{keyword}{struct }\hyperlink{structtest__s}{test\_s} \{
\hypertarget{inv__mpu_8c_source.tex_l00298}{}\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{00298}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens};
\hypertarget{inv__mpu_8c_source.tex_l00299}{}\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{00299}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens};
\hypertarget{inv__mpu_8c_source.tex_l00300}{}\hyperlink{structtest__s_a82f9074fa4cc93f3d21f826a9e739294}{00300}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structtest__s_a82f9074fa4cc93f3d21f826a9e739294}{reg\_rate\_div};
\hypertarget{inv__mpu_8c_source.tex_l00301}{}\hyperlink{structtest__s_a794ee75f43ca70e89a68b43642eb2c59}{00301}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structtest__s_a794ee75f43ca70e89a68b43642eb2c59}{reg\_lpf};
\hypertarget{inv__mpu_8c_source.tex_l00302}{}\hyperlink{structtest__s_a6063bc7c719cdaddf88633b1148fd323}{00302}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structtest__s_a6063bc7c719cdaddf88633b1148fd323}{reg\_gyro\_fsr};
\hypertarget{inv__mpu_8c_source.tex_l00303}{}\hyperlink{structtest__s_a08dc2a906129744a045950c3642a9023}{00303}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structtest__s_a08dc2a906129744a045950c3642a9023}{reg\_accel\_fsr};
\hypertarget{inv__mpu_8c_source.tex_l00304}{}\hyperlink{structtest__s_a0abed830f8dc38c7bd17ce78ee2530d8}{00304}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structtest__s_a0abed830f8dc38c7bd17ce78ee2530d8}{wait\_ms};
\hypertarget{inv__mpu_8c_source.tex_l00305}{}\hyperlink{structtest__s_aa8dbf099c1734ea67c1ef1938c0baec8}{00305}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structtest__s_aa8dbf099c1734ea67c1ef1938c0baec8}{packet\_thresh};
\hypertarget{inv__mpu_8c_source.tex_l00306}{}\hyperlink{structtest__s_a73ee82e1de6d3bdc4cc37282c012f0e1}{00306}     \textcolor{keywordtype}{float} \hyperlink{structtest__s_a73ee82e1de6d3bdc4cc37282c012f0e1}{min\_dps};
\hypertarget{inv__mpu_8c_source.tex_l00307}{}\hyperlink{structtest__s_a9085b0647fbd57e7ed8e0c4371ad1de2}{00307}     \textcolor{keywordtype}{float} \hyperlink{structtest__s_a9085b0647fbd57e7ed8e0c4371ad1de2}{max\_dps};
\hypertarget{inv__mpu_8c_source.tex_l00308}{}\hyperlink{structtest__s_a629a75454f5af8caaff2fe8388975d32}{00308}     \textcolor{keywordtype}{float} \hyperlink{structtest__s_a629a75454f5af8caaff2fe8388975d32}{max\_gyro\_var};
\hypertarget{inv__mpu_8c_source.tex_l00309}{}\hyperlink{structtest__s_aa295cc026745ef7378eeff0c72638ed0}{00309}     \textcolor{keywordtype}{float} \hyperlink{structtest__s_aa295cc026745ef7378eeff0c72638ed0}{min\_g};
\hypertarget{inv__mpu_8c_source.tex_l00310}{}\hyperlink{structtest__s_a30dbaf47c9d41bf9e86370664d661bd0}{00310}     \textcolor{keywordtype}{float} \hyperlink{structtest__s_a30dbaf47c9d41bf9e86370664d661bd0}{max\_g};
\hypertarget{inv__mpu_8c_source.tex_l00311}{}\hyperlink{structtest__s_ad5bc54ab7d1b1a0f158ca1a79359c3bc}{00311}     \textcolor{keywordtype}{float} \hyperlink{structtest__s_ad5bc54ab7d1b1a0f158ca1a79359c3bc}{max\_accel\_var};
00312 \textcolor{preprocessor}{#ifdef MPU6500}
00313     \textcolor{keywordtype}{float} max\_g\_offset;
00314     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} sample\_wait\_ms;
00315 \textcolor{preprocessor}{#endif}
00316 \};
00317 
00318 \textcolor{comment}{/* Gyro driver state variables. */}
\hypertarget{inv__mpu_8c_source.tex_l00319}{}\hyperlink{structgyro__state__s}{00319} \textcolor{keyword}{struct }\hyperlink{structgyro__state__s}{gyro\_state\_s} \{
\hypertarget{inv__mpu_8c_source.tex_l00320}{}\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{00320}     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structgyro__reg__s}{gyro\_reg\_s} *\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg};
\hypertarget{inv__mpu_8c_source.tex_l00321}{}\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{00321}     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structhw__s}{hw\_s} *\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw};
\hypertarget{inv__mpu_8c_source.tex_l00322}{}\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{00322}     \textcolor{keyword}{struct }\hyperlink{structchip__cfg__s}{chip\_cfg\_s} chip\_cfg;
\hypertarget{inv__mpu_8c_source.tex_l00323}{}\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{00323}     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structtest__s}{test\_s} *\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test};
00324 \};
00325 
00326 \textcolor{comment}{/* Filter configurations. */}
\hypertarget{inv__mpu_8c_source.tex_l00327}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9}{00327} \textcolor{keyword}{enum} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9}{lpf\_e} \{
\hypertarget{inv__mpu_8c_source.tex_l00328}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a9f0263fbbdccd3c5a18fcb65be278d24}{00328}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a9f0263fbbdccd3c5a18fcb65be278d24}{INV\_FILTER\_256HZ\_NOLPF2} = 0,
\hypertarget{inv__mpu_8c_source.tex_l00329}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9ab58e52e0b6be4cbaf0c7f32705a9fcec}{00329}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9ab58e52e0b6be4cbaf0c7f32705a9fcec}{INV\_FILTER\_188HZ},
\hypertarget{inv__mpu_8c_source.tex_l00330}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a0f288da0c97b325a6cb57f1223f0cf98}{00330}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a0f288da0c97b325a6cb57f1223f0cf98}{INV\_FILTER\_98HZ},
\hypertarget{inv__mpu_8c_source.tex_l00331}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a995b18a52a5bd919aa9c1411a2292110}{00331}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a995b18a52a5bd919aa9c1411a2292110}{INV\_FILTER\_42HZ},
\hypertarget{inv__mpu_8c_source.tex_l00332}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9aebecb86604e475ed8e2cb68340010ff1}{00332}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9aebecb86604e475ed8e2cb68340010ff1}{INV\_FILTER\_20HZ},
\hypertarget{inv__mpu_8c_source.tex_l00333}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a327619f406c6b2f6a221793881013508}{00333}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a327619f406c6b2f6a221793881013508}{INV\_FILTER\_10HZ},
\hypertarget{inv__mpu_8c_source.tex_l00334}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9abdaaf85666fd6a490ee01dcd8a315678}{00334}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9abdaaf85666fd6a490ee01dcd8a315678}{INV\_FILTER\_5HZ},
\hypertarget{inv__mpu_8c_source.tex_l00335}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a76de97a6c2f8eb3c5d1a73d717513f5d}{00335}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a76de97a6c2f8eb3c5d1a73d717513f5d}{INV\_FILTER\_2100HZ\_NOLPF},
\hypertarget{inv__mpu_8c_source.tex_l00336}{}\hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a053f39f04904f6103090bcba3002c4a3}{00336}     \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a053f39f04904f6103090bcba3002c4a3}{NUM\_FILTER}
00337 \};
00338 
00339 \textcolor{comment}{/* Full scale ranges. */}
\hypertarget{inv__mpu_8c_source.tex_l00340}{}\hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90}{00340} \textcolor{keyword}{enum} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90}{gyro\_fsr\_e} \{
\hypertarget{inv__mpu_8c_source.tex_l00341}{}\hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a5b8251a49db5cb8a676076b0b308ae35}{00341}     \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a5b8251a49db5cb8a676076b0b308ae35}{INV\_FSR\_250DPS} = 0,
\hypertarget{inv__mpu_8c_source.tex_l00342}{}\hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a50901470ff389927fd010081e2b8fd09}{00342}     \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a50901470ff389927fd010081e2b8fd09}{INV\_FSR\_500DPS},
\hypertarget{inv__mpu_8c_source.tex_l00343}{}\hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90aee922e0daa4fbb404c3db6c49d897a13}{00343}     \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90aee922e0daa4fbb404c3db6c49d897a13}{INV\_FSR\_1000DPS},
\hypertarget{inv__mpu_8c_source.tex_l00344}{}\hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ac0c37efc1c8acd6f70c0c5a768e5b8be}{00344}     \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ac0c37efc1c8acd6f70c0c5a768e5b8be}{INV\_FSR\_2000DPS},
\hypertarget{inv__mpu_8c_source.tex_l00345}{}\hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ab50b300433c5bc3cbc7ae8adb980c815}{00345}     \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ab50b300433c5bc3cbc7ae8adb980c815}{NUM\_GYRO\_FSR}
00346 \};
00347 
00348 \textcolor{comment}{/* Full scale ranges. */}
\hypertarget{inv__mpu_8c_source.tex_l00349}{}\hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81e}{00349} \textcolor{keyword}{enum} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81e}{accel\_fsr\_e} \{
\hypertarget{inv__mpu_8c_source.tex_l00350}{}\hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eae27c6f69463dab7de81fac0c51ff8aa7}{00350}     \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eae27c6f69463dab7de81fac0c51ff8aa7}{INV\_FSR\_2G} = 0,
\hypertarget{inv__mpu_8c_source.tex_l00351}{}\hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eaa91e3a89d0bbd01149fe71148595be6d}{00351}     \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eaa91e3a89d0bbd01149fe71148595be6d}{INV\_FSR\_4G},
\hypertarget{inv__mpu_8c_source.tex_l00352}{}\hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea0a40371bdda397d234c53d0ee2f3be8b}{00352}     \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea0a40371bdda397d234c53d0ee2f3be8b}{INV\_FSR\_8G},
\hypertarget{inv__mpu_8c_source.tex_l00353}{}\hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6712e8563c97c11b458ef721d4f5f9d5}{00353}     \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6712e8563c97c11b458ef721d4f5f9d5}{INV\_FSR\_16G},
\hypertarget{inv__mpu_8c_source.tex_l00354}{}\hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6d466b2f73b176f1dfc8a3f94ae8a4df}{00354}     \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6d466b2f73b176f1dfc8a3f94ae8a4df}{NUM\_ACCEL\_FSR}
00355 \};
00356 
00357 \textcolor{comment}{/* Clock sources. */}
\hypertarget{inv__mpu_8c_source.tex_l00358}{}\hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207}{00358} \textcolor{keyword}{enum} \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207}{clock\_sel\_e} \{
\hypertarget{inv__mpu_8c_source.tex_l00359}{}\hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a92059acf8d0ff5b7e12580c15f88466f}{00359}     \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a92059acf8d0ff5b7e12580c15f88466f}{INV\_CLK\_INTERNAL} = 0,
\hypertarget{inv__mpu_8c_source.tex_l00360}{}\hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{00360}     \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{INV\_CLK\_PLL},
\hypertarget{inv__mpu_8c_source.tex_l00361}{}\hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a7f075b0360037232fdf24f90de7be1d7}{00361}     \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a7f075b0360037232fdf24f90de7be1d7}{NUM\_CLK}
00362 \};
00363 
00364 \textcolor{comment}{/* Low-power accel wakeup rates. */}
\hypertarget{inv__mpu_8c_source.tex_l00365}{}\hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7}{00365} \textcolor{keyword}{enum} \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7}{lp\_accel\_rate\_e} \{
00366 \textcolor{preprocessor}{#if defined MPU6050}
\hypertarget{inv__mpu_8c_source.tex_l00367}{}\hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7ab44c7d0127a9466747853533a537b567}{00367}     \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7ab44c7d0127a9466747853533a537b567}{INV\_LPA\_1\_25HZ},
\hypertarget{inv__mpu_8c_source.tex_l00368}{}\hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7a474cac76bff369dd656cc973207a1ca5}{00368}     \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7a474cac76bff369dd656cc973207a1ca5}{INV\_LPA\_5HZ},
\hypertarget{inv__mpu_8c_source.tex_l00369}{}\hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7accaaf47c58dfe32cbf2ffa11fdb83108}{00369}     \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7accaaf47c58dfe32cbf2ffa11fdb83108}{INV\_LPA\_20HZ},
\hypertarget{inv__mpu_8c_source.tex_l00370}{}\hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7a798d2b86eafcf3fc7c7fe775f46cb4cb}{00370}     \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7a798d2b86eafcf3fc7c7fe775f46cb4cb}{INV\_LPA\_40HZ}
00371 \textcolor{preprocessor}{#elif defined MPU6500}
00372     INV\_LPA\_0\_24HZ,
00373     INV\_LPA\_0\_49HZ,
00374     INV\_LPA\_0\_98HZ,
00375     INV\_LPA\_1\_95HZ,
00376     INV\_LPA\_3\_91HZ,
00377     INV\_LPA\_7\_81HZ,
00378     INV\_LPA\_15\_63HZ,
00379     INV\_LPA\_31\_25HZ,
00380     INV\_LPA\_62\_50HZ,
00381     INV\_LPA\_125HZ,
00382     INV\_LPA\_250HZ,
00383     INV\_LPA\_500HZ
00384 \textcolor{preprocessor}{#endif}
00385 \};
00386 
\hypertarget{inv__mpu_8c_source.tex_l00387}{}\hyperlink{inv__mpu_8c_ac52d7caf4efc485ef6faa1211bfe60dc}{00387} \textcolor{preprocessor}{#define BIT\_I2C\_MST\_VDDIO   (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00388}{}\hyperlink{inv__mpu_8c_ae3c4a18accb84992faaf2534a84a147c}{00388} \textcolor{preprocessor}{#define BIT\_FIFO\_EN         (0x40)}
\hypertarget{inv__mpu_8c_source.tex_l00389}{}\hyperlink{inv__mpu_8c_a02c3e9ddd63128f1c3cf50bf1e9b5fe6}{00389} \textcolor{preprocessor}{#define BIT\_DMP\_EN          (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00390}{}\hyperlink{inv__mpu_8c_aeae2cc64314ad05f3a93d2358a2369db}{00390} \textcolor{preprocessor}{#define BIT\_FIFO\_RST        (0x04)}
\hypertarget{inv__mpu_8c_source.tex_l00391}{}\hyperlink{inv__mpu_8c_a37d5ceb74c3568e4bab6dcdd0afaa95b}{00391} \textcolor{preprocessor}{#define BIT\_DMP\_RST         (0x08)}
\hypertarget{inv__mpu_8c_source.tex_l00392}{}\hyperlink{inv__mpu_8c_afb9b49ce5dd973b3c29ae72680924fa7}{00392} \textcolor{preprocessor}{#define BIT\_FIFO\_OVERFLOW   (0x10)}
\hypertarget{inv__mpu_8c_source.tex_l00393}{}\hyperlink{inv__mpu_8c_a45eec9dbc46778c356703dcf90b9e0c3}{00393} \textcolor{preprocessor}{#define BIT\_DATA\_RDY\_EN     (0x01)}
\hypertarget{inv__mpu_8c_source.tex_l00394}{}\hyperlink{inv__mpu_8c_a4dc5309ed09fc683d8e5a247feaad69d}{00394} \textcolor{preprocessor}{#define BIT\_DMP\_INT\_EN      (0x02)}
\hypertarget{inv__mpu_8c_source.tex_l00395}{}\hyperlink{inv__mpu_8c_a6a8f2f7f3dd17bc05d9c6286d15c7ada}{00395} \textcolor{preprocessor}{#define BIT\_MOT\_INT\_EN      (0x40)}
\hypertarget{inv__mpu_8c_source.tex_l00396}{}\hyperlink{inv__mpu_8c_a2d9aff1be96b1fc021ca96f251c3e72b}{00396} \textcolor{preprocessor}{#define BITS\_FSR            (0x18)}
\hypertarget{inv__mpu_8c_source.tex_l00397}{}\hyperlink{inv__mpu_8c_a4d83411e736da86163a61828816a200a}{00397} \textcolor{preprocessor}{#define BITS\_LPF            (0x07)}
\hypertarget{inv__mpu_8c_source.tex_l00398}{}\hyperlink{inv__mpu_8c_a3c9c0234d4a71c9d35bb0da64ea867eb}{00398} \textcolor{preprocessor}{#define BITS\_HPF            (0x07)}
\hypertarget{inv__mpu_8c_source.tex_l00399}{}\hyperlink{inv__mpu_8c_a1823f90ac353cf4cde25d297a8627dd4}{00399} \textcolor{preprocessor}{#define BITS\_CLK            (0x07)}
\hypertarget{inv__mpu_8c_source.tex_l00400}{}\hyperlink{inv__mpu_8c_a3769fd3fa71deaef1e77ce14c26f679d}{00400} \textcolor{preprocessor}{#define BIT\_FIFO\_SIZE\_1024  (0x40)}
\hypertarget{inv__mpu_8c_source.tex_l00401}{}\hyperlink{inv__mpu_8c_a0fa95b278851b0c05a9995f65ba2b895}{00401} \textcolor{preprocessor}{#define BIT\_FIFO\_SIZE\_2048  (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00402}{}\hyperlink{inv__mpu_8c_ac067df9d789eaae04585abfc5ffdb2b6}{00402} \textcolor{preprocessor}{#define BIT\_FIFO\_SIZE\_4096  (0xC0)}
\hypertarget{inv__mpu_8c_source.tex_l00403}{}\hyperlink{inv__mpu_8c_af4ce49fd1fc9b1461b5241f9ef4812f4}{00403} \textcolor{preprocessor}{#define BIT\_RESET           (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00404}{}\hyperlink{inv__mpu_8c_a1fed8bd436e9b7dfccb1cae99ca89103}{00404} \textcolor{preprocessor}{#define BIT\_SLEEP           (0x40)}
\hypertarget{inv__mpu_8c_source.tex_l00405}{}\hyperlink{inv__mpu_8c_ac4b33689dd697c1cf2411638a017c009}{00405} \textcolor{preprocessor}{#define BIT\_S0\_DELAY\_EN     (0x01)}
\hypertarget{inv__mpu_8c_source.tex_l00406}{}\hyperlink{inv__mpu_8c_a22e4452fe8abca7fe12a2dc45194e6df}{00406} \textcolor{preprocessor}{#define BIT\_S2\_DELAY\_EN     (0x04)}
\hypertarget{inv__mpu_8c_source.tex_l00407}{}\hyperlink{inv__mpu_8c_abc5c2ee59baeb02a0f761740466f3c28}{00407} \textcolor{preprocessor}{#define BITS\_SLAVE\_LENGTH   (0x0F)}
\hypertarget{inv__mpu_8c_source.tex_l00408}{}\hyperlink{inv__mpu_8c_a5e8f3ccff1b3eeb95a938b207ca873ff}{00408} \textcolor{preprocessor}{#define BIT\_SLAVE\_BYTE\_SW   (0x40)}
\hypertarget{inv__mpu_8c_source.tex_l00409}{}\hyperlink{inv__mpu_8c_af616c3ecf97ffd7bde444f0b74e7453e}{00409} \textcolor{preprocessor}{#define BIT\_SLAVE\_GROUP     (0x10)}
\hypertarget{inv__mpu_8c_source.tex_l00410}{}\hyperlink{inv__mpu_8c_ae9440f48b6d70d900366dc040a8714d7}{00410} \textcolor{preprocessor}{#define BIT\_SLAVE\_EN        (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00411}{}\hyperlink{inv__mpu_8c_a8ef1963ec6fb3df5586e50959cf00a70}{00411} \textcolor{preprocessor}{#define BIT\_I2C\_READ        (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00412}{}\hyperlink{inv__mpu_8c_ab470b625fa05ff228b3fdb94802b1c0d}{00412} \textcolor{preprocessor}{#define BITS\_I2C\_MASTER\_DLY (0x1F)}
\hypertarget{inv__mpu_8c_source.tex_l00413}{}\hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{00413} \textcolor{preprocessor}{#define BIT\_AUX\_IF\_EN       (0x20)}
\hypertarget{inv__mpu_8c_source.tex_l00414}{}\hyperlink{inv__mpu_8c_a8467782bedc44051c95643e303543655}{00414} \textcolor{preprocessor}{#define BIT\_ACTL            (0x80)}
\hypertarget{inv__mpu_8c_source.tex_l00415}{}\hyperlink{inv__mpu_8c_a588b5a95724c4a68c6868faa78fd3a7f}{00415} \textcolor{preprocessor}{#define BIT\_LATCH\_EN        (0x20)}
\hypertarget{inv__mpu_8c_source.tex_l00416}{}\hyperlink{inv__mpu_8c_a1f50796ca0363292d9ac9cc1d29d9225}{00416} \textcolor{preprocessor}{#define BIT\_ANY\_RD\_CLR      (0x10)}
\hypertarget{inv__mpu_8c_source.tex_l00417}{}\hyperlink{inv__mpu_8c_add12a8d89e1a4c4e008b12a96dd4c75d}{00417} \textcolor{preprocessor}{#define BIT\_BYPASS\_EN       (0x02)}
\hypertarget{inv__mpu_8c_source.tex_l00418}{}\hyperlink{inv__mpu_8c_a75b1479e451b747afb3b24cbc4df99f7}{00418} \textcolor{preprocessor}{#define BITS\_WOM\_EN         (0xC0)}
\hypertarget{inv__mpu_8c_source.tex_l00419}{}\hyperlink{inv__mpu_8c_a63e6f23af37626aa1498d8c248f259e7}{00419} \textcolor{preprocessor}{#define BIT\_LPA\_CYCLE       (0x20)}
\hypertarget{inv__mpu_8c_source.tex_l00420}{}\hyperlink{inv__mpu_8c_acfc46ee2ea036d16b3df45c8fb241b5b}{00420} \textcolor{preprocessor}{#define BIT\_STBY\_XA         (0x20)}
\hypertarget{inv__mpu_8c_source.tex_l00421}{}\hyperlink{inv__mpu_8c_a49e6d38569bfc4b58ccc45dbb19001fa}{00421} \textcolor{preprocessor}{#define BIT\_STBY\_YA         (0x10)}
\hypertarget{inv__mpu_8c_source.tex_l00422}{}\hyperlink{inv__mpu_8c_afac8114288bae2db7ea7dbf0f6fb755c}{00422} \textcolor{preprocessor}{#define BIT\_STBY\_ZA         (0x08)}
\hypertarget{inv__mpu_8c_source.tex_l00423}{}\hyperlink{inv__mpu_8c_a82256fedeffe5b2443ab3ae34cf032d9}{00423} \textcolor{preprocessor}{#define BIT\_STBY\_XG         (0x04)}
\hypertarget{inv__mpu_8c_source.tex_l00424}{}\hyperlink{inv__mpu_8c_abf1c0a844906a5e887a659971a4af417}{00424} \textcolor{preprocessor}{#define BIT\_STBY\_YG         (0x02)}
\hypertarget{inv__mpu_8c_source.tex_l00425}{}\hyperlink{inv__mpu_8c_a30967a4efdf3c3f1e39814e72a4168b0}{00425} \textcolor{preprocessor}{#define BIT\_STBY\_ZG         (0x01)}
\hypertarget{inv__mpu_8c_source.tex_l00426}{}\hyperlink{inv__mpu_8c_a04a57159e34387dafe9b86b171c4654c}{00426} \textcolor{preprocessor}{#define BIT\_STBY\_XYZA       (BIT\_STBY\_XA | BIT\_STBY\_YA | BIT\_STBY\_ZA)}
\hypertarget{inv__mpu_8c_source.tex_l00427}{}\hyperlink{inv__mpu_8c_a4e2ef22b94b90f9b83394dfe1f688ce4}{00427} \textcolor{preprocessor}{#define BIT\_STBY\_XYZG       (BIT\_STBY\_XG | BIT\_STBY\_YG | BIT\_STBY\_ZG)}
\hypertarget{inv__mpu_8c_source.tex_l00428}{}\hyperlink{inv__mpu_8c_a51c6f0bce9d0ad115514fd5d343c76e9}{00428} \textcolor{preprocessor}{#define BIT\_ACCL\_FC\_B       (0x08)}
00429 
00430 \textcolor{preprocessor}{#if defined AK8975\_SECONDARY}
00431 \textcolor{preprocessor}{#define SUPPORTS\_AK89xx\_HIGH\_SENS   (0x00)}
00432 \textcolor{preprocessor}{#define AK89xx\_FSR                  (9830)}
00433 \textcolor{preprocessor}{#elif defined AK8963\_SECONDARY}
00434 \textcolor{preprocessor}{#define SUPPORTS\_AK89xx\_HIGH\_SENS   (0x10)}
00435 \textcolor{preprocessor}{#define AK89xx\_FSR                  (4915)}
00436 \textcolor{preprocessor}{#endif}
00437 
00438 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00439 \textcolor{preprocessor}{#define AKM\_REG\_WHOAMI      (0x00)}
00440 
00441 \textcolor{preprocessor}{#define AKM\_REG\_ST1         (0x02)}
00442 \textcolor{preprocessor}{#define AKM\_REG\_HXL         (0x03)}
00443 \textcolor{preprocessor}{#define AKM\_REG\_ST2         (0x09)}
00444 
00445 \textcolor{preprocessor}{#define AKM\_REG\_CNTL        (0x0A)}
00446 \textcolor{preprocessor}{#define AKM\_REG\_ASTC        (0x0C)}
00447 \textcolor{preprocessor}{#define AKM\_REG\_ASAX        (0x10)}
00448 \textcolor{preprocessor}{#define AKM\_REG\_ASAY        (0x11)}
00449 \textcolor{preprocessor}{#define AKM\_REG\_ASAZ        (0x12)}
00450 
00451 \textcolor{preprocessor}{#define AKM\_DATA\_READY      (0x01)}
00452 \textcolor{preprocessor}{#define AKM\_DATA\_OVERRUN    (0x02)}
00453 \textcolor{preprocessor}{#define AKM\_OVERFLOW        (0x80)}
00454 \textcolor{preprocessor}{#define AKM\_DATA\_ERROR      (0x40)}
00455 
00456 \textcolor{preprocessor}{#define AKM\_BIT\_SELF\_TEST   (0x40)}
00457 
00458 \textcolor{preprocessor}{#define AKM\_POWER\_DOWN          (0x00 | SUPPORTS\_AK89xx\_HIGH\_SENS)}
00459 \textcolor{preprocessor}{#define AKM\_SINGLE\_MEASUREMENT  (0x01 | SUPPORTS\_AK89xx\_HIGH\_SENS)}
00460 \textcolor{preprocessor}{#define AKM\_FUSE\_ROM\_ACCESS     (0x0F | SUPPORTS\_AK89xx\_HIGH\_SENS)}
00461 \textcolor{preprocessor}{#define AKM\_MODE\_SELF\_TEST      (0x08 | SUPPORTS\_AK89xx\_HIGH\_SENS)}
00462 
00463 \textcolor{preprocessor}{#define AKM\_WHOAMI      (0x48)}
00464 \textcolor{preprocessor}{#endif}
00465 
00466 \textcolor{preprocessor}{#if defined MPU6050}
\hypertarget{inv__mpu_8c_source.tex_l00467}{}\hyperlink{inv__mpu_8c_a5448c351fc95ff052b110eee80e5f75c}{00467} \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structgyro__reg__s}{gyro\_reg\_s} \hyperlink{inv__mpu_8c_a5448c351fc95ff052b110eee80e5f75c}{reg} = \{
00468     .\hyperlink{structgyro__reg__s_aa52d78bb2b62fee23a0b759e545dba4b}{who\_am\_i}       = 0x75,
00469     .rate\_div       = 0x19,
00470     .lpf            = 0x1A,
00471     .prod\_id        = 0x0C,
00472     .user\_ctrl      = 0x6A,
00473     .fifo\_en        = 0x23,
00474     .gyro\_cfg       = 0x1B,
00475     .accel\_cfg      = 0x1C,
00476     .motion\_thr     = 0x1F,
00477     .motion\_dur     = 0x20,
00478     .fifo\_count\_h   = 0x72,
00479     .fifo\_r\_w       = 0x74,
00480     .raw\_gyro       = 0x43,
00481     .raw\_accel      = 0x3B,
00482     .temp           = 0x41,
00483     .int\_enable     = 0x38,
00484     .dmp\_int\_status = 0x39,
00485     .int\_status     = 0x3A,
00486     .pwr\_mgmt\_1     = 0x6B,
00487     .pwr\_mgmt\_2     = 0x6C,
00488     .int\_pin\_cfg    = 0x37,
00489     .mem\_r\_w        = 0x6F,
00490     .accel\_offs     = 0x06,
00491     .i2c\_mst        = 0x24,
00492     .bank\_sel       = 0x6D,
00493     .mem\_start\_addr = 0x6E,
00494     .prgm\_start\_h   = 0x70
00495 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00496     ,.raw\_compass   = 0x49,
00497     .yg\_offs\_tc     = 0x01,
00498     .s0\_addr        = 0x25,
00499     .s0\_reg         = 0x26,
00500     .s0\_ctrl        = 0x27,
00501     .s1\_addr        = 0x28,
00502     .s1\_reg         = 0x29,
00503     .s1\_ctrl        = 0x2A,
00504     .s4\_ctrl        = 0x34,
00505     .s0\_do          = 0x63,
00506     .s1\_do          = 0x64,
00507     .i2c\_delay\_ctrl = 0x67
00508 \textcolor{preprocessor}{#endif}
00509 \};
\hypertarget{inv__mpu_8c_source.tex_l00510}{}\hyperlink{inv__mpu_8c_a7fefd0bb47e09b7e39e25e9795cd7edc}{00510} \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structhw__s}{hw\_s} \hyperlink{inv__mpu_8c_a7fefd0bb47e09b7e39e25e9795cd7edc}{hw} = \{
00511     .\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}           = 0x68,
00512     .max\_fifo       = 1024,
00513     .num\_reg        = 118,
00514     .temp\_sens      = 340,
00515     .temp\_offset    = -521,
00516     .bank\_size      = 256
00517 \textcolor{preprocessor}{#if defined AK89xx\_SECONDARY}
00518     ,.compass\_fsr    = AK89xx\_FSR
00519 \textcolor{preprocessor}{#endif}
00520 \};
00521 
\hypertarget{inv__mpu_8c_source.tex_l00522}{}\hyperlink{inv__mpu_8c_a1e8f8b1ef7fb2c429e1ce7c2f9985530}{00522} \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structtest__s}{test\_s} \hyperlink{inv__mpu_8c_a1e8f8b1ef7fb2c429e1ce7c2f9985530}{test} = \{
00523     .\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens}      = 32768/250,
00524     .accel\_sens     = 32768/16,
00525     .reg\_rate\_div   = 0,    \textcolor{comment}{/* 1kHz. */}
00526     .reg\_lpf        = 1,    \textcolor{comment}{/* 188Hz. */}
00527     .reg\_gyro\_fsr   = 0,    \textcolor{comment}{/* 250dps. */}
00528     .reg\_accel\_fsr  = 0x18, \textcolor{comment}{/* 16g. */}
00529     .wait\_ms        = 50,
00530     .packet\_thresh  = 5,    \textcolor{comment}{/* 5% */}
00531     .min\_dps        = 10.f,
00532     .max\_dps        = 105.f,
00533     .max\_gyro\_var   = 0.14f,
00534     .min\_g          = 0.3f,
00535     .max\_g          = 0.95f,
00536     .max\_accel\_var  = 0.14f
00537 \};
00538 
00539 \textcolor{keyword}{static} \textcolor{keyword}{struct }\hyperlink{structgyro__state__s}{gyro\_state\_s} st = \{
00540     .\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg} = &\hyperlink{inv__mpu_8c_a5448c351fc95ff052b110eee80e5f75c}{reg},
00541     .hw = &\hyperlink{inv__mpu_8c_a7fefd0bb47e09b7e39e25e9795cd7edc}{hw},
00542     .test = &test
00543 \};
00544 \textcolor{preprocessor}{#elif defined MPU6500}
00545 \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structgyro__reg__s}{gyro\_reg\_s} reg = \{
00546     .\hyperlink{structgyro__reg__s_aa52d78bb2b62fee23a0b759e545dba4b}{who\_am\_i}       = 0x75,
00547     .rate\_div       = 0x19,
00548     .lpf            = 0x1A,
00549     .prod\_id        = 0x0C,
00550     .user\_ctrl      = 0x6A,
00551     .fifo\_en        = 0x23,
00552     .gyro\_cfg       = 0x1B,
00553     .accel\_cfg      = 0x1C,
00554     .accel\_cfg2     = 0x1D,
00555     .lp\_accel\_odr   = 0x1E,
00556     .motion\_thr     = 0x1F,
00557     .motion\_dur     = 0x20,
00558     .fifo\_count\_h   = 0x72,
00559     .fifo\_r\_w       = 0x74,
00560     .raw\_gyro       = 0x43,
00561     .raw\_accel      = 0x3B,
00562     .temp           = 0x41,
00563     .int\_enable     = 0x38,
00564     .dmp\_int\_status = 0x39,
00565     .int\_status     = 0x3A,
00566     .accel\_intel    = 0x69,
00567     .pwr\_mgmt\_1     = 0x6B,
00568     .pwr\_mgmt\_2     = 0x6C,
00569     .int\_pin\_cfg    = 0x37,
00570     .mem\_r\_w        = 0x6F,
00571     .accel\_offs     = 0x77,
00572     .i2c\_mst        = 0x24,
00573     .bank\_sel       = 0x6D,
00574     .mem\_start\_addr = 0x6E,
00575     .prgm\_start\_h   = 0x70
00576 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00577     ,.raw\_compass   = 0x49,
00578     .s0\_addr        = 0x25,
00579     .s0\_reg         = 0x26,
00580     .s0\_ctrl        = 0x27,
00581     .s1\_addr        = 0x28,
00582     .s1\_reg         = 0x29,
00583     .s1\_ctrl        = 0x2A,
00584     .s4\_ctrl        = 0x34,
00585     .s0\_do          = 0x63,
00586     .s1\_do          = 0x64,
00587     .i2c\_delay\_ctrl = 0x67
00588 \textcolor{preprocessor}{#endif}
00589 \};
00590 \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structhw__s}{hw\_s} hw = \{
00591     .\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}           = 0x68,
00592     .max\_fifo       = 1024,
00593     .num\_reg        = 128,
00594     .temp\_sens      = 321,
00595     .temp\_offset    = 0,
00596     .bank\_size      = 256
00597 \textcolor{preprocessor}{#if defined AK89xx\_SECONDARY}
00598     ,.compass\_fsr    = AK89xx\_FSR
00599 \textcolor{preprocessor}{#endif}
00600 \};
00601 
00602 \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structtest__s}{test\_s} test = \{
00603     .\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens}      = 32768/250,
00604     .accel\_sens     = 32768/2,  \textcolor{comment}{//FSR = +-2G = 16384 LSB/G}
00605     .reg\_rate\_div   = 0,    \textcolor{comment}{/* 1kHz. */}
00606     .reg\_lpf        = 2,    \textcolor{comment}{/* 92Hz low pass filter*/}
00607     .reg\_gyro\_fsr   = 0,    \textcolor{comment}{/* 250dps. */}
00608     .reg\_accel\_fsr  = 0x0,  \textcolor{comment}{/* Accel FSR setting = 2g. */}
00609     .wait\_ms        = 200,   \textcolor{comment}{//200ms stabilization time}
00610     .packet\_thresh  = 200,    \textcolor{comment}{/* 200 samples */}
00611     .min\_dps        = 20.f,  \textcolor{comment}{//20 dps for Gyro Criteria C}
00612     .max\_dps        = 60.f, \textcolor{comment}{//Must exceed 60 dps threshold for Gyro Criteria B}
00613     .max\_gyro\_var   = .5f, \textcolor{comment}{//Must exceed +50% variation for Gyro Criteria A}
00614     .min\_g          = .225f, \textcolor{comment}{//Accel must exceed Min 225 mg for Criteria B}
00615     .max\_g          = .675f, \textcolor{comment}{//Accel cannot exceed Max 675 mg for Criteria B}
00616     .max\_accel\_var  = .5f,  \textcolor{comment}{//Accel must be within 50% variation for Criteria A}
00617     .max\_g\_offset   = .5f,   \textcolor{comment}{//500 mg for Accel Criteria C}
00618     .sample\_wait\_ms = 10    \textcolor{comment}{//10ms sample time wait}
00619 \};
00620 
00621 \textcolor{keyword}{static} \textcolor{keyword}{struct }\hyperlink{structgyro__state__s}{gyro\_state\_s} st = \{
00622     .\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg} = &\hyperlink{inv__mpu_8c_a5448c351fc95ff052b110eee80e5f75c}{reg},
00623     .hw = &\hyperlink{inv__mpu_8c_a7fefd0bb47e09b7e39e25e9795cd7edc}{hw},
00624     .test = &test
00625 \};
00626 \textcolor{preprocessor}{#endif}
00627 
\hypertarget{inv__mpu_8c_source.tex_l00628}{}\hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{00628} \textcolor{preprocessor}{#define MAX\_PACKET\_LENGTH (12)}
00629 \textcolor{preprocessor}{#ifdef MPU6500}
00630 \textcolor{preprocessor}{#define HWST\_MAX\_PACKET\_LENGTH (512)}
00631 \textcolor{preprocessor}{#endif}
00632 
00633 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00634 \textcolor{keyword}{static} \textcolor{keywordtype}{int} setup\_compass(\textcolor{keywordtype}{void});
00635 \textcolor{preprocessor}{#define MAX\_COMPASS\_SAMPLE\_RATE (100)}
00636 \textcolor{preprocessor}{#endif}
00637 
00645 \textcolor{keyword}{static} \textcolor{keywordtype}{int} set\_int\_enable(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} enable)
00646 \{
00647     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp;
00648 
00649     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on}) \{
00650         \textcolor{keywordflow}{if} (enable)
00651             tmp = \hyperlink{inv__mpu_8c_a4dc5309ed09fc683d8e5a247feaad69d}{BIT\_DMP\_INT\_EN};
00652         \textcolor{keywordflow}{else}
00653             tmp = 0x00;
00654         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, &tmp))
00655             \textcolor{keywordflow}{return} -1;
00656         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable} = tmp;
00657     \} \textcolor{keywordflow}{else} \{
00658         \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
00659             \textcolor{keywordflow}{return} -1;
00660         \textcolor{keywordflow}{if} (enable && st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable})
00661             \textcolor{keywordflow}{return} 0;
00662         \textcolor{keywordflow}{if} (enable)
00663             tmp = \hyperlink{inv__mpu_8c_a45eec9dbc46778c356703dcf90b9e0c3}{BIT\_DATA\_RDY\_EN};
00664         \textcolor{keywordflow}{else}
00665             tmp = 0x00;
00666         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, &tmp))
00667             \textcolor{keywordflow}{return} -1;
00668         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable} = tmp;
00669     \}
00670     \textcolor{keywordflow}{return} 0;
00671 \}
00672 
\hypertarget{inv__mpu_8c_source.tex_l00677}{}\hyperlink{group___d_r_i_v_e_r_s_ga0e1201ecfd8453f1d89e4299528baaf6}{00677} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga0e1201ecfd8453f1d89e4299528baaf6}{mpu\_reg\_dump}(\textcolor{keywordtype}{void})
00678 \{
00679     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} ii;
00680     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
00681 
00682     \textcolor{keywordflow}{for} (ii = 0; ii < st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a0c4fc172c338358ef1754c16c627eb08}{num\_reg}; ii++) \{
00683         \textcolor{keywordflow}{if} (ii == st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w} || ii == st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a1e6aa9b45ef18f1e5f6369c6383e1f0f}{mem\_r\_w})
00684             \textcolor{keywordflow}{continue};
00685         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, ii, 1, &data))
00686             \textcolor{keywordflow}{return} -1;
00687         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"%#5x: %#5x\(\backslash\)r\(\backslash\)n"}, ii, data);
00688     \}
00689     \textcolor{keywordflow}{return} 0;
00690 \}
00691 
\hypertarget{inv__mpu_8c_source.tex_l00699}{}\hyperlink{group___d_r_i_v_e_r_s_ga5c35a3363337014e11769a0ea7c0dfa9}{00699} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga5c35a3363337014e11769a0ea7c0dfa9}{mpu\_read\_reg}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} reg, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data)
00700 \{
00701     \textcolor{keywordflow}{if} (reg == st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w} || reg == st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a1e6aa9b45ef18f1e5f6369c6383e1f0f}{mem\_r\_w})
00702         \textcolor{keywordflow}{return} -1;
00703     \textcolor{keywordflow}{if} (reg >= st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a0c4fc172c338358ef1754c16c627eb08}{num\_reg})
00704         \textcolor{keywordflow}{return} -1;
00705     \textcolor{keywordflow}{return} \hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, reg, 1, data);
00706 \}
00707 
\hypertarget{inv__mpu_8c_source.tex_l00721}{}\hyperlink{group___d_r_i_v_e_r_s_ga63637cf3771995aeda99d91d5f345f29}{00721} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga63637cf3771995aeda99d91d5f345f29}{mpu\_init}()\textcolor{comment}{//struct int\_param\_s *int\_param)}
00722 \{
00723     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6];
00724 
00725     \textcolor{comment}{/* Reset device. */}
00726     data[0] = \hyperlink{inv__mpu_8c_af4ce49fd1fc9b1461b5241f9ef4812f4}{BIT\_RESET};
00727     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, data))
00728         \textcolor{keywordflow}{return} -1;
00729     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(100);
00730 
00731     \textcolor{comment}{/* Wake up chip. */}
00732     data[0] = 0x00;
00733     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, data))
00734         \textcolor{keywordflow}{return} -1;
00735 
00736    st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_af73df77287fdeba8d408c18f3905650f}{accel\_half} = 0;
00737 
00738 \textcolor{preprocessor}{#ifdef MPU6500}
00739     \textcolor{comment}{/* MPU6500 shares 4kB of memory between the DMP and the FIFO. Since the}
00740 \textcolor{comment}{     * first 3kB are needed by the DMP, we'll use the last 1kB for the FIFO.}
00741 \textcolor{comment}{     */}
00742     data[0] = \hyperlink{inv__mpu_8c_a3769fd3fa71deaef1e77ce14c26f679d}{BIT\_FIFO\_SIZE\_1024};
00743     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{accel\_cfg2}, 1, data))
00744         \textcolor{keywordflow}{return} -1;
00745 \textcolor{preprocessor}{#endif}
00746 
00747     \textcolor{comment}{/* Set to invalid values to ensure no I2C writes are skipped. */}
00748     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = 0xFF;
00749     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr} = 0xFF;
00750     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr} = 0xFF;
00751     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf} = 0xFF;
00752     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} = 0xFFFF;
00753     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} = 0xFF;
00754     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{bypass\_mode} = 0xFF;
00755 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00756     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_sample\_rate = 0xFFFF;
00757 \textcolor{preprocessor}{#endif}
00758     \textcolor{comment}{/* mpu\_set\_sensors always preserves this setting. */}
00759     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src} = \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{INV\_CLK\_PLL};
00760     \textcolor{comment}{/* Handled in next call to mpu\_set\_bypass. */}
00761     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{active\_low\_int} = 1;
00762     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{latched\_int} = 0;
00763     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a28c5c373e0d7189a11c4ae5ca351ca30}{int\_motion\_only} = 0;
00764     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode} = 0;
00765     memset(&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}, 0, \textcolor{keyword}{sizeof}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}));
00766     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on} = 0;
00767     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_afc32c3e58317c589014257dc9b1ee04b}{dmp\_loaded} = 0;
00768     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a5d17c6049cc8cb74faf5cdb942988294}{dmp\_sample\_rate} = 0;
00769 
00770     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_gad09e6031c8677adc0b8a39b6deea8e27}{mpu\_set\_gyro\_fsr}(2000))
00771         \textcolor{keywordflow}{return} -1;
00772     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_ga2713a96af104cfb2ae8e0ed4c3718119}{mpu\_set\_accel\_fsr}(2))
00773         \textcolor{keywordflow}{return} -1;
00774     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(42))
00775         \textcolor{keywordflow}{return} -1;
00776     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{mpu\_set\_sample\_rate}(50))
00777         \textcolor{keywordflow}{return} -1;
00778     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{mpu\_configure\_fifo}(0))
00779         \textcolor{keywordflow}{return} -1;
00780 
00781     \textcolor{comment}{//if (int\_param)}
00782         \textcolor{comment}{//reg\_int\_cb(int\_param);}
00783 
00784 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
00785     setup\_compass();
00786     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_ga78da3828de0ef9d080c4d03e7bc45e7b}{mpu\_set\_compass\_sample\_rate}(10))
00787         \textcolor{keywordflow}{return} -1;
00788 \textcolor{preprocessor}{#else}
00789     \textcolor{comment}{/* Already disabled by setup\_compass. */}
00790     \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(0))
00791         \textcolor{keywordflow}{return} -1;
00792 \textcolor{preprocessor}{#endif}
00793 
00794     \hyperlink{group___d_r_i_v_e_r_s_ga6e77e7cc1cf6be5e8fdf617c5b4586d1}{mpu\_set\_sensors}(0);
00795     \textcolor{keywordflow}{return} 0;
00796 \}
00797 
\hypertarget{inv__mpu_8c_source.tex_l00813}{}\hyperlink{group___d_r_i_v_e_r_s_gabdcf10922a1a20f1b5bbd7576d3189b9}{00813} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gabdcf10922a1a20f1b5bbd7576d3189b9}{mpu\_lp\_accel\_mode}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} rate)
00814 \{
00815     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];
00816 
00817 \textcolor{preprocessor}{#if defined MPU6500}
00818     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
00819 \textcolor{preprocessor}{#endif}
00820 
00821     \textcolor{keywordflow}{if} (!rate) \{
00822         \hyperlink{group___d_r_i_v_e_r_s_ga653cb855300bff9285ce4b8dca6a503b}{mpu\_set\_int\_latched}(0);
00823         tmp[0] = 0;
00824         tmp[1] = \hyperlink{inv__mpu_8c_a4e2ef22b94b90f9b83394dfe1f688ce4}{BIT\_STBY\_XYZG};
00825         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 2, tmp))
00826             \textcolor{keywordflow}{return} -1;
00827         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode} = 0;
00828         \textcolor{keywordflow}{return} 0;
00829     \}
00830     \textcolor{comment}{/* For LP accel, we automatically configure the hardware to produce latched}
00831 \textcolor{comment}{     * interrupts. In LP accel mode, the hardware cycles into sleep mode before}
00832 \textcolor{comment}{     * it gets a chance to deassert the interrupt pin; therefore, we shift this}
00833 \textcolor{comment}{     * responsibility over to the MCU.}
00834 \textcolor{comment}{     *}
00835 \textcolor{comment}{     * Any register read will clear the interrupt.}
00836 \textcolor{comment}{     */}
00837     \hyperlink{group___d_r_i_v_e_r_s_ga653cb855300bff9285ce4b8dca6a503b}{mpu\_set\_int\_latched}(1);
00838 \textcolor{preprocessor}{#if defined MPU6050}
00839     tmp[0] = \hyperlink{inv__mpu_8c_a63e6f23af37626aa1498d8c248f259e7}{BIT\_LPA\_CYCLE};
00840     \textcolor{keywordflow}{if} (rate == 1) \{
00841         tmp[1] = \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7ab44c7d0127a9466747853533a537b567}{INV\_LPA\_1\_25HZ};
00842         \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(5);
00843     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 5) \{
00844         tmp[1] = \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7a474cac76bff369dd656cc973207a1ca5}{INV\_LPA\_5HZ};
00845         \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(5);
00846     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 20) \{
00847         tmp[1] = \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7accaaf47c58dfe32cbf2ffa11fdb83108}{INV\_LPA\_20HZ};
00848         \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(10);
00849     \} \textcolor{keywordflow}{else} \{
00850         tmp[1] = \hyperlink{inv__mpu_8c_a23c3fcde795e5aa2b141232d490c9ca7a798d2b86eafcf3fc7c7fe775f46cb4cb}{INV\_LPA\_40HZ};
00851         \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(20);
00852     \}
00853     tmp[1] = (tmp[1] << 6) | \hyperlink{inv__mpu_8c_a4e2ef22b94b90f9b83394dfe1f688ce4}{BIT\_STBY\_XYZG};
00854     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 2, tmp))
00855         \textcolor{keywordflow}{return} -1;
00856 \textcolor{preprocessor}{#elif defined MPU6500}
00857     \textcolor{comment}{/* Set wake frequency. */}
00858     \textcolor{keywordflow}{if} (rate == 1)
00859         data = INV\_LPA\_0\_98HZ;
00860     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate == 2)
00861         data = INV\_LPA\_1\_95HZ;
00862     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 5)
00863         data = INV\_LPA\_3\_91HZ;
00864     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 10)
00865         data = INV\_LPA\_7\_81HZ;
00866     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 20)
00867         data = INV\_LPA\_15\_63HZ;
00868     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 40)
00869         data = INV\_LPA\_31\_25HZ;
00870     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 70)
00871         data = INV\_LPA\_62\_50HZ;
00872     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 125)
00873         data = INV\_LPA\_125HZ;
00874     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate <= 250)
00875         data = INV\_LPA\_250HZ;
00876     \textcolor{keywordflow}{else}
00877         data = INV\_LPA\_500HZ;
00878 
00879     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a14a0bff136c827f3f58f619f8045788b}{lp\_accel\_odr}, 1, &data))
00880         \textcolor{keywordflow}{return} -1;
00881 
00882     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{accel\_cfg2}, 1, &data))
00883         \textcolor{keywordflow}{return} -1;
00884 
00885     data = data | \hyperlink{inv__mpu_8c_a51c6f0bce9d0ad115514fd5d343c76e9}{BIT\_ACCL\_FC\_B};
00886     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{accel\_cfg2}, 1, &data))
00887             \textcolor{keywordflow}{return} -1;
00888 
00889     data = \hyperlink{inv__mpu_8c_a63e6f23af37626aa1498d8c248f259e7}{BIT\_LPA\_CYCLE};
00890     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, &data))
00891         \textcolor{keywordflow}{return} -1;
00892 \textcolor{preprocessor}{#endif}
00893     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL};
00894     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src} = 0;
00895     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode} = 1;
00896     \hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{mpu\_configure\_fifo}(0);
00897 
00898     \textcolor{keywordflow}{return} 0;
00899 \}
00900 
\hypertarget{inv__mpu_8c_source.tex_l00907}{}\hyperlink{group___d_r_i_v_e_r_s_ga5555854590ad11495c0e30401294bae2}{00907} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga5555854590ad11495c0e30401294bae2}{mpu\_get\_gyro\_reg}(\textcolor{keywordtype}{short} *data, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *timestamp)
00908 \{
00909     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[6];
00910 
00911     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} & \hyperlink{group___d_r_i_v_e_r_s_ga3fdc30f9c0a26c2c4e2bb88921f91629}{INV\_XYZ\_GYRO}))
00912         \textcolor{keywordflow}{return} -1;
00913 
00914     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a1366c90aec04a4e1d212de76d3f0b6cc}{raw\_gyro}, 6, tmp))
00915         \textcolor{keywordflow}{return} -1;
00916     data[0] = (tmp[0] << 8) | tmp[1];
00917     data[1] = (tmp[2] << 8) | tmp[3];
00918     data[2] = (tmp[4] << 8) | tmp[5];
00919     \textcolor{keywordflow}{if} (timestamp)
00920 
00921   \textcolor{comment}{//      get\_ms(timestamp);}
00922 
00923     \textcolor{keywordflow}{return} 0;
00924 \}
00925 
\hypertarget{inv__mpu_8c_source.tex_l00932}{}\hyperlink{group___d_r_i_v_e_r_s_gae4ae960e5df78049ece2647772a3d809}{00932} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gae4ae960e5df78049ece2647772a3d809}{mpu\_get\_accel\_reg}(\textcolor{keywordtype}{short} *data, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *timestamp)
00933 \{
00934     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[6];
00935 
00936     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} & \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL}))
00937         \textcolor{keywordflow}{return} -1;
00938 
00939     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a3a78e67f9066b6b8601f375fcaadf005}{raw\_accel}, 6, tmp))
00940         \textcolor{keywordflow}{return} -1;
00941     data[0] = (tmp[0] << 8) | tmp[1];
00942     data[1] = (tmp[2] << 8) | tmp[3];
00943     data[2] = (tmp[4] << 8) | tmp[5];
00944     \textcolor{keywordflow}{if} (timestamp)
00945 
00946         \textcolor{comment}{//get\_ms(timestamp);}
00947 
00948     \textcolor{keywordflow}{return} 0;
00949 \}
00950 
\hypertarget{inv__mpu_8c_source.tex_l00957}{}\hyperlink{group___d_r_i_v_e_r_s_gaa449b565a157b4b8ca0f491b7ed46018}{00957} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaa449b565a157b4b8ca0f491b7ed46018}{mpu\_get\_temperature}(\textcolor{keywordtype}{long} *data, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *timestamp)
00958 \{
00959     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];
00960     \textcolor{keywordtype}{short} raw;
00961 
00962     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
00963         \textcolor{keywordflow}{return} -1;
00964 
00965     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_abe413cb96d839cbe31417aa52d920f21}{temp}, 2, tmp))
00966         \textcolor{keywordflow}{return} -1;
00967     raw = (tmp[0] << 8) | tmp[1];
00968     \textcolor{keywordflow}{if} (timestamp)
00969 
00970         \textcolor{comment}{//get\_ms(timestamp);}
00971 
00972 
00973     data[0] = (long)((35 + ((raw - (\textcolor{keywordtype}{float})st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_ac3cd6878189d0ca0cb389c5ab11c8395}{temp\_offset}) / st.
      \hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_ab73e7066167ecd424b3a619cddd0939a}{temp\_sens})) * 65536L);
00974     \textcolor{keywordflow}{return} 0;
00975 \}
00976 
\hypertarget{inv__mpu_8c_source.tex_l00985}{}\hyperlink{group___d_r_i_v_e_r_s_ga57bfbb356ce449135ce39659455041ae}{00985} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga57bfbb356ce449135ce39659455041ae}{mpu\_read\_6500\_accel\_bias}(\textcolor{keywordtype}{long} *accel\_bias) \{
00986     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6];
00987     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x77, 2, &data[0]))
00988         \textcolor{keywordflow}{return} -1;
00989     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x7A, 2, &data[2]))
00990         \textcolor{keywordflow}{return} -1;
00991     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x7D, 2, &data[4]))
00992         \textcolor{keywordflow}{return} -1;
00993     accel\_bias[0] = ((long)data[0]<<8) | data[1];
00994     accel\_bias[1] = ((long)data[2]<<8) | data[3];
00995     accel\_bias[2] = ((long)data[4]<<8) | data[5];
00996     \textcolor{keywordflow}{return} 0;
00997 \}
00998 
\hypertarget{inv__mpu_8c_source.tex_l01007}{}\hyperlink{group___d_r_i_v_e_r_s_gaed37421e1f140d10ee0eff0efeade27b}{01007} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaed37421e1f140d10ee0eff0efeade27b}{mpu\_read\_6050\_accel\_bias}(\textcolor{keywordtype}{long} *accel\_bias) \{
01008     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6];
01009     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x06, 2, &data[0]))
01010         \textcolor{keywordflow}{return} -1;
01011     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x08, 2, &data[2]))
01012         \textcolor{keywordflow}{return} -1;
01013     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x0A, 2, &data[4]))
01014         \textcolor{keywordflow}{return} -1;
01015     accel\_bias[0] = ((long)data[0]<<8) | data[1];
01016     accel\_bias[1] = ((long)data[2]<<8) | data[3];
01017     accel\_bias[2] = ((long)data[4]<<8) | data[5];
01018     \textcolor{keywordflow}{return} 0;
01019 \}
01020 
\hypertarget{inv__mpu_8c_source.tex_l01021}{}\hyperlink{inv__mpu_8c_ae387f1342e10bce129609f3c279a50a2}{01021} \textcolor{keywordtype}{int} \hyperlink{inv__mpu_8c_ae387f1342e10bce129609f3c279a50a2}{mpu\_read\_6500\_gyro\_bias}(\textcolor{keywordtype}{long} *gyro\_bias) \{
01022     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6];
01023     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x13, 2, &data[0]))
01024         \textcolor{keywordflow}{return} -1;
01025     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x15, 2, &data[2]))
01026         \textcolor{keywordflow}{return} -1;
01027     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x17, 2, &data[4]))
01028         \textcolor{keywordflow}{return} -1;
01029     gyro\_bias[0] = ((long)data[0]<<8) | data[1];
01030     gyro\_bias[1] = ((long)data[2]<<8) | data[3];
01031     gyro\_bias[2] = ((long)data[4]<<8) | data[5];
01032     \textcolor{keywordflow}{return} 0;
01033 \}
01034 
\hypertarget{inv__mpu_8c_source.tex_l01043}{}\hyperlink{group___d_r_i_v_e_r_s_ga01361a0f5c1f048cb0742bd3d0e4d3a5}{01043} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga01361a0f5c1f048cb0742bd3d0e4d3a5}{mpu\_set\_gyro\_bias\_reg}(\textcolor{keywordtype}{long} *gyro\_bias)
01044 \{
01045     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6] = \{0, 0, 0, 0, 0, 0\};
01046     \textcolor{keywordtype}{long} gyro\_reg\_bias[3] = \{0, 0, 0\};
01047     \textcolor{keywordtype}{int} i=0;
01048 
01049     \textcolor{keywordflow}{if}(\hyperlink{inv__mpu_8c_ae387f1342e10bce129609f3c279a50a2}{mpu\_read\_6500\_gyro\_bias}(gyro\_reg\_bias))
01050         \textcolor{keywordflow}{return} -1;
01051 
01052     \textcolor{keywordflow}{for}(i=0;i<3;i++) \{
01053         gyro\_reg\_bias[i]-= gyro\_bias[i];
01054     \}
01055 
01056     data[0] = (gyro\_reg\_bias[0] >> 8) & 0xff;
01057     data[1] = (gyro\_reg\_bias[0]) & 0xff;
01058     data[2] = (gyro\_reg\_bias[1] >> 8) & 0xff;
01059     data[3] = (gyro\_reg\_bias[1]) & 0xff;
01060     data[4] = (gyro\_reg\_bias[2] >> 8) & 0xff;
01061     data[5] = (gyro\_reg\_bias[2]) & 0xff;
01062 
01063     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x13, 2, &data[0]))
01064         \textcolor{keywordflow}{return} -1;
01065     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x15, 2, &data[2]))
01066         \textcolor{keywordflow}{return} -1;
01067     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x17, 2, &data[4]))
01068         \textcolor{keywordflow}{return} -1;
01069     \textcolor{keywordflow}{return} 0;
01070 \}
01071 
\hypertarget{inv__mpu_8c_source.tex_l01080}{}\hyperlink{group___d_r_i_v_e_r_s_gae2eb5073dacc7455101bf6818e35c40a}{01080} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gae2eb5073dacc7455101bf6818e35c40a}{mpu\_set\_accel\_bias\_6050\_reg}(\textcolor{keyword}{const} \textcolor{keywordtype}{long} *accel\_bias)
01081 \{
01082     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6] = \{0, 0, 0, 0, 0, 0\};
01083     \textcolor{keywordtype}{long} accel\_reg\_bias[3] = \{0, 0, 0\};
01084 
01085     \textcolor{keywordflow}{if}(\hyperlink{group___d_r_i_v_e_r_s_gaed37421e1f140d10ee0eff0efeade27b}{mpu\_read\_6050\_accel\_bias}(accel\_reg\_bias))
01086         \textcolor{keywordflow}{return} -1;
01087 
01088     accel\_reg\_bias[0] -= (accel\_bias[0] & ~1);
01089     accel\_reg\_bias[1] -= (accel\_bias[1] & ~1);
01090     accel\_reg\_bias[2] -= (accel\_bias[2] & ~1);
01091 
01092     data[0] = (accel\_reg\_bias[0] >> 8) & 0xff;
01093     data[1] = (accel\_reg\_bias[0]) & 0xff;
01094     data[2] = (accel\_reg\_bias[1] >> 8) & 0xff;
01095     data[3] = (accel\_reg\_bias[1]) & 0xff;
01096     data[4] = (accel\_reg\_bias[2] >> 8) & 0xff;
01097     data[5] = (accel\_reg\_bias[2]) & 0xff;
01098 
01099     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x06, 2, &data[0]))
01100         \textcolor{keywordflow}{return} -1;
01101     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x08, 2, &data[2]))
01102         \textcolor{keywordflow}{return} -1;
01103     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x0A, 2, &data[4]))
01104         \textcolor{keywordflow}{return} -1;
01105 
01106     \textcolor{keywordflow}{return} 0;
01107 \}
01108 
\hypertarget{inv__mpu_8c_source.tex_l01117}{}\hyperlink{group___d_r_i_v_e_r_s_gaa7265afee29b8307ff49a8b1ccd9238a}{01117} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaa7265afee29b8307ff49a8b1ccd9238a}{mpu\_set\_accel\_bias\_6500\_reg}(\textcolor{keyword}{const} \textcolor{keywordtype}{long} *accel\_bias) \{
01118     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[6] = \{0, 0, 0, 0, 0, 0\};
01119     \textcolor{keywordtype}{long} accel\_reg\_bias[3] = \{0, 0, 0\};
01120 
01121     \textcolor{keywordflow}{if}(\hyperlink{group___d_r_i_v_e_r_s_ga57bfbb356ce449135ce39659455041ae}{mpu\_read\_6500\_accel\_bias}(accel\_reg\_bias))
01122         \textcolor{keywordflow}{return} -1;
01123 
01124     \textcolor{comment}{// Preserve bit 0 of factory value (for temperature compensation)}
01125     accel\_reg\_bias[0] -= (accel\_bias[0] & ~1);
01126     accel\_reg\_bias[1] -= (accel\_bias[1] & ~1);
01127     accel\_reg\_bias[2] -= (accel\_bias[2] & ~1);
01128 
01129     data[0] = (accel\_reg\_bias[0] >> 8) & 0xff;
01130     data[1] = (accel\_reg\_bias[0]) & 0xff;
01131     data[2] = (accel\_reg\_bias[1] >> 8) & 0xff;
01132     data[3] = (accel\_reg\_bias[1]) & 0xff;
01133     data[4] = (accel\_reg\_bias[2] >> 8) & 0xff;
01134     data[5] = (accel\_reg\_bias[2]) & 0xff;
01135 
01136     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x77, 2, &data[0]))
01137         \textcolor{keywordflow}{return} -1;
01138     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x7A, 2, &data[2]))
01139         \textcolor{keywordflow}{return} -1;
01140     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x7D, 2, &data[4]))
01141         \textcolor{keywordflow}{return} -1;
01142 
01143     \textcolor{keywordflow}{return} 0;
01144 \}
01145 
\hypertarget{inv__mpu_8c_source.tex_l01150}{}\hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{01150} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{mpu\_reset\_fifo}(\textcolor{keywordtype}{void})
01151 \{
01152     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
01153 
01154     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
01155         \textcolor{keywordflow}{return} -1;
01156 
01157     data = 0;
01158     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, &data))
01159         \textcolor{keywordflow}{return} -1;
01160     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, &data))
01161         \textcolor{keywordflow}{return} -1;
01162     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &data))
01163         \textcolor{keywordflow}{return} -1;
01164 
01165     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on}) \{
01166         data = \hyperlink{inv__mpu_8c_aeae2cc64314ad05f3a93d2358a2369db}{BIT\_FIFO\_RST} | \hyperlink{inv__mpu_8c_a37d5ceb74c3568e4bab6dcdd0afaa95b}{BIT\_DMP\_RST};
01167         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &data))
01168             \textcolor{keywordflow}{return} -1;
01169         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(50);
01170         data = \hyperlink{inv__mpu_8c_a02c3e9ddd63128f1c3cf50bf1e9b5fe6}{BIT\_DMP\_EN} | \hyperlink{inv__mpu_8c_ae3c4a18accb84992faaf2534a84a147c}{BIT\_FIFO\_EN};
01171         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} & \hyperlink{group___d_r_i_v_e_r_s_ga7fc9c1dbdcb2ac8cc2a4128a5799482a}{INV\_XYZ\_COMPASS})
01172             data |= \hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01173         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &data))
01174             \textcolor{keywordflow}{return} -1;
01175         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable})
01176             data = \hyperlink{inv__mpu_8c_a4dc5309ed09fc683d8e5a247feaad69d}{BIT\_DMP\_INT\_EN};
01177         \textcolor{keywordflow}{else}
01178             data = 0;
01179         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, &data))
01180             \textcolor{keywordflow}{return} -1;
01181         data = 0;
01182         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, &data))
01183             \textcolor{keywordflow}{return} -1;
01184     \} \textcolor{keywordflow}{else} \{
01185         data = \hyperlink{inv__mpu_8c_aeae2cc64314ad05f3a93d2358a2369db}{BIT\_FIFO\_RST};
01186         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &data))
01187             \textcolor{keywordflow}{return} -1;
01188         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{bypass\_mode} || !(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.
      \hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} & \hyperlink{group___d_r_i_v_e_r_s_ga7fc9c1dbdcb2ac8cc2a4128a5799482a}{INV\_XYZ\_COMPASS}))
01189             data = \hyperlink{inv__mpu_8c_ae3c4a18accb84992faaf2534a84a147c}{BIT\_FIFO\_EN};
01190         \textcolor{keywordflow}{else}
01191             data = \hyperlink{inv__mpu_8c_ae3c4a18accb84992faaf2534a84a147c}{BIT\_FIFO\_EN} | \hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01192         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &data))
01193             \textcolor{keywordflow}{return} -1;
01194         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(50);
01195         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable})
01196             data = \hyperlink{inv__mpu_8c_a45eec9dbc46778c356703dcf90b9e0c3}{BIT\_DATA\_RDY\_EN};
01197         \textcolor{keywordflow}{else}
01198             data = 0;
01199         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, &data))
01200             \textcolor{keywordflow}{return} -1;
01201         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, &st.
      \hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable}))
01202             \textcolor{keywordflow}{return} -1;
01203     \}
01204     \textcolor{keywordflow}{return} 0;
01205 \}
01206 
\hypertarget{inv__mpu_8c_source.tex_l01212}{}\hyperlink{group___d_r_i_v_e_r_s_gaf973c32c73ba912ff512aab948fc31ca}{01212} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaf973c32c73ba912ff512aab948fc31ca}{mpu\_get\_gyro\_fsr}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *fsr)
01213 \{
01214     \textcolor{keywordflow}{switch} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr}) \{
01215     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a5b8251a49db5cb8a676076b0b308ae35}{INV\_FSR\_250DPS}:
01216         fsr[0] = 250;
01217         \textcolor{keywordflow}{break};
01218     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a50901470ff389927fd010081e2b8fd09}{INV\_FSR\_500DPS}:
01219         fsr[0] = 500;
01220         \textcolor{keywordflow}{break};
01221     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90aee922e0daa4fbb404c3db6c49d897a13}{INV\_FSR\_1000DPS}:
01222         fsr[0] = 1000;
01223         \textcolor{keywordflow}{break};
01224     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ac0c37efc1c8acd6f70c0c5a768e5b8be}{INV\_FSR\_2000DPS}:
01225         fsr[0] = 2000;
01226         \textcolor{keywordflow}{break};
01227     \textcolor{keywordflow}{default}:
01228         fsr[0] = 0;
01229         \textcolor{keywordflow}{break};
01230     \}
01231     \textcolor{keywordflow}{return} 0;
01232 \}
01233 
\hypertarget{inv__mpu_8c_source.tex_l01239}{}\hyperlink{group___d_r_i_v_e_r_s_gad09e6031c8677adc0b8a39b6deea8e27}{01239} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gad09e6031c8677adc0b8a39b6deea8e27}{mpu\_set\_gyro\_fsr}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} fsr)
01240 \{
01241     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
01242 
01243     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
01244         \textcolor{keywordflow}{return} -1;
01245 
01246     \textcolor{keywordflow}{switch} (fsr) \{
01247     \textcolor{keywordflow}{case} 250:
01248         data = \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a5b8251a49db5cb8a676076b0b308ae35}{INV\_FSR\_250DPS} << 3;
01249         \textcolor{keywordflow}{break};
01250     \textcolor{keywordflow}{case} 500:
01251         data = \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a50901470ff389927fd010081e2b8fd09}{INV\_FSR\_500DPS} << 3;
01252         \textcolor{keywordflow}{break};
01253     \textcolor{keywordflow}{case} 1000:
01254         data = \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90aee922e0daa4fbb404c3db6c49d897a13}{INV\_FSR\_1000DPS} << 3;
01255         \textcolor{keywordflow}{break};
01256     \textcolor{keywordflow}{case} 2000:
01257         data = \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ac0c37efc1c8acd6f70c0c5a768e5b8be}{INV\_FSR\_2000DPS} << 3;
01258         \textcolor{keywordflow}{break};
01259     \textcolor{keywordflow}{default}:
01260         \textcolor{keywordflow}{return} -1;
01261     \}
01262 
01263     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr} == (data >> 3))
01264         \textcolor{keywordflow}{return} 0;
01265     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ac2b87a25876eb44862043cd56d33d49b}{gyro\_cfg}, 1, &data))
01266         \textcolor{keywordflow}{return} -1;
01267     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr} = data >> 3;
01268     \textcolor{keywordflow}{return} 0;
01269 \}
01270 
\hypertarget{inv__mpu_8c_source.tex_l01276}{}\hyperlink{group___d_r_i_v_e_r_s_gab6087a15ee23db23b6aec41590329a60}{01276} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gab6087a15ee23db23b6aec41590329a60}{mpu\_get\_accel\_fsr}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *fsr)
01277 \{
01278     \textcolor{keywordflow}{switch} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr}) \{
01279     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eae27c6f69463dab7de81fac0c51ff8aa7}{INV\_FSR\_2G}:
01280         fsr[0] = 2;
01281         \textcolor{keywordflow}{break};
01282     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eaa91e3a89d0bbd01149fe71148595be6d}{INV\_FSR\_4G}:
01283         fsr[0] = 4;
01284         \textcolor{keywordflow}{break};
01285     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea0a40371bdda397d234c53d0ee2f3be8b}{INV\_FSR\_8G}:
01286         fsr[0] = 8;
01287         \textcolor{keywordflow}{break};
01288     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6712e8563c97c11b458ef721d4f5f9d5}{INV\_FSR\_16G}:
01289         fsr[0] = 16;
01290         \textcolor{keywordflow}{break};
01291     \textcolor{keywordflow}{default}:
01292         \textcolor{keywordflow}{return} -1;
01293     \}
01294     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_af73df77287fdeba8d408c18f3905650f}{accel\_half})
01295         fsr[0] <<= 1;
01296     \textcolor{keywordflow}{return} 0;
01297 \}
01298 
\hypertarget{inv__mpu_8c_source.tex_l01304}{}\hyperlink{group___d_r_i_v_e_r_s_ga2713a96af104cfb2ae8e0ed4c3718119}{01304} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga2713a96af104cfb2ae8e0ed4c3718119}{mpu\_set\_accel\_fsr}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} fsr)
01305 \{
01306     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
01307 
01308     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
01309         \textcolor{keywordflow}{return} -1;
01310 
01311     \textcolor{keywordflow}{switch} (fsr) \{
01312     \textcolor{keywordflow}{case} 2:
01313         data = \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eae27c6f69463dab7de81fac0c51ff8aa7}{INV\_FSR\_2G} << 3;
01314         \textcolor{keywordflow}{break};
01315     \textcolor{keywordflow}{case} 4:
01316         data = \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eaa91e3a89d0bbd01149fe71148595be6d}{INV\_FSR\_4G} << 3;
01317         \textcolor{keywordflow}{break};
01318     \textcolor{keywordflow}{case} 8:
01319         data = \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea0a40371bdda397d234c53d0ee2f3be8b}{INV\_FSR\_8G} << 3;
01320         \textcolor{keywordflow}{break};
01321     \textcolor{keywordflow}{case} 16:
01322         data = \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6712e8563c97c11b458ef721d4f5f9d5}{INV\_FSR\_16G} << 3;
01323         \textcolor{keywordflow}{break};
01324     \textcolor{keywordflow}{default}:
01325         \textcolor{keywordflow}{return} -1;
01326     \}
01327 
01328     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr} == (data >> 3))
01329         \textcolor{keywordflow}{return} 0;
01330     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a3e39cea9e122765d4770876d4ce6adc7}{accel\_cfg}, 1, &data))
01331         \textcolor{keywordflow}{return} -1;
01332     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr} = data >> 3;
01333     \textcolor{keywordflow}{return} 0;
01334 \}
01335 
\hypertarget{inv__mpu_8c_source.tex_l01341}{}\hyperlink{group___d_r_i_v_e_r_s_gaa95c7e216dcb2d888e9796001ca555f8}{01341} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaa95c7e216dcb2d888e9796001ca555f8}{mpu\_get\_lpf}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *\hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf})
01342 \{
01343     \textcolor{keywordflow}{switch} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf}) \{
01344     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9ab58e52e0b6be4cbaf0c7f32705a9fcec}{INV\_FILTER\_188HZ}:
01345         lpf[0] = 188;
01346         \textcolor{keywordflow}{break};
01347     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a0f288da0c97b325a6cb57f1223f0cf98}{INV\_FILTER\_98HZ}:
01348         lpf[0] = 98;
01349         \textcolor{keywordflow}{break};
01350     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a995b18a52a5bd919aa9c1411a2292110}{INV\_FILTER\_42HZ}:
01351         lpf[0] = 42;
01352         \textcolor{keywordflow}{break};
01353     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9aebecb86604e475ed8e2cb68340010ff1}{INV\_FILTER\_20HZ}:
01354         lpf[0] = 20;
01355         \textcolor{keywordflow}{break};
01356     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a327619f406c6b2f6a221793881013508}{INV\_FILTER\_10HZ}:
01357         lpf[0] = 10;
01358         \textcolor{keywordflow}{break};
01359     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9abdaaf85666fd6a490ee01dcd8a315678}{INV\_FILTER\_5HZ}:
01360         lpf[0] = 5;
01361         \textcolor{keywordflow}{break};
01362     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a9f0263fbbdccd3c5a18fcb65be278d24}{INV\_FILTER\_256HZ\_NOLPF2}:
01363     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a76de97a6c2f8eb3c5d1a73d717513f5d}{INV\_FILTER\_2100HZ\_NOLPF}:
01364     \textcolor{keywordflow}{default}:
01365         lpf[0] = 0;
01366         \textcolor{keywordflow}{break};
01367     \}
01368     \textcolor{keywordflow}{return} 0;
01369 \}
01370 
\hypertarget{inv__mpu_8c_source.tex_l01377}{}\hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{01377} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf})
01378 \{
01379     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
01380 
01381     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
01382         \textcolor{keywordflow}{return} -1;
01383 
01384     \textcolor{keywordflow}{if} (lpf >= 188)
01385         data = \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9ab58e52e0b6be4cbaf0c7f32705a9fcec}{INV\_FILTER\_188HZ};
01386     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpf >= 98)
01387         data = \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a0f288da0c97b325a6cb57f1223f0cf98}{INV\_FILTER\_98HZ};
01388     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpf >= 42)
01389         data = \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a995b18a52a5bd919aa9c1411a2292110}{INV\_FILTER\_42HZ};
01390     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpf >= 20)
01391         data = \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9aebecb86604e475ed8e2cb68340010ff1}{INV\_FILTER\_20HZ};
01392     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpf >= 10)
01393         data = \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9a327619f406c6b2f6a221793881013508}{INV\_FILTER\_10HZ};
01394     \textcolor{keywordflow}{else}
01395         data = \hyperlink{inv__mpu_8c_a91c762a5bd71461f7911dc49ee7696e9abdaaf85666fd6a490ee01dcd8a315678}{INV\_FILTER\_5HZ};
01396 
01397     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf} == data)
01398         \textcolor{keywordflow}{return} 0;
01399 
01400     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf}, 1, &data))
01401         \textcolor{keywordflow}{return} -1;
01402 
01403 \textcolor{preprocessor}{#ifdef MPU6500 //MPU6500 accel/gyro dlpf separately}
01404     data = \hyperlink{inv__mpu_8c_a3769fd3fa71deaef1e77ce14c26f679d}{BIT\_FIFO\_SIZE\_1024} | data;
01405     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{accel\_cfg2}, 1, &data))
01406             \textcolor{keywordflow}{return} -1;
01407 \textcolor{preprocessor}{#endif}
01408 
01409     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf} = data;
01410     \textcolor{keywordflow}{return} 0;
01411 \}
01412 
\hypertarget{inv__mpu_8c_source.tex_l01418}{}\hyperlink{group___d_r_i_v_e_r_s_ga2487dd551b701c1c7ed4d6335f02b2f1}{01418} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga2487dd551b701c1c7ed4d6335f02b2f1}{mpu\_get\_sample\_rate}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *rate)
01419 \{
01420     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on})
01421         \textcolor{keywordflow}{return} -1;
01422     \textcolor{keywordflow}{else}
01423         rate[0] = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate};
01424     \textcolor{keywordflow}{return} 0;
01425 \}
01426 
\hypertarget{inv__mpu_8c_source.tex_l01433}{}\hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{01433} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{mpu\_set\_sample\_rate}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} rate)
01434 \{
01435     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
01436 
01437     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
01438         \textcolor{keywordflow}{return} -1;
01439 
01440     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on})
01441         \textcolor{keywordflow}{return} -1;
01442     \textcolor{keywordflow}{else} \{
01443         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode}) \{
01444             \textcolor{keywordflow}{if} (rate && (rate <= 40)) \{
01445                 \textcolor{comment}{/* Just stay in low-power accel mode. */}
01446                 \hyperlink{group___d_r_i_v_e_r_s_gabdcf10922a1a20f1b5bbd7576d3189b9}{mpu\_lp\_accel\_mode}(rate);
01447                 \textcolor{keywordflow}{return} 0;
01448             \}
01449             \textcolor{comment}{/* Requested rate exceeds the allowed frequencies in LP accel mode,}
01450 \textcolor{comment}{             * switch back to full-power mode.}
01451 \textcolor{comment}{             */}
01452             \hyperlink{group___d_r_i_v_e_r_s_gabdcf10922a1a20f1b5bbd7576d3189b9}{mpu\_lp\_accel\_mode}(0);
01453         \}
01454         \textcolor{keywordflow}{if} (rate < 4)
01455             rate = 4;
01456         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rate > 1000)
01457             rate = 1000;
01458 
01459         data = 1000 / rate - 1;
01460         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a401bb6ee7e48a2bf55398cbaf70c0dc3}{rate\_div}, 1, &data))
01461             \textcolor{keywordflow}{return} -1;
01462 
01463         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} = 1000 / (1 + data);
01464 
01465 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
01466         \hyperlink{group___d_r_i_v_e_r_s_ga78da3828de0ef9d080c4d03e7bc45e7b}{mpu\_set\_compass\_sample\_rate}(\hyperlink{group___d_r_i_v_e_r_s_gac6afabdc09a49a433ee19d8a9486056d}{min}(st.
      \hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_sample\_rate, MAX\_COMPASS\_SAMPLE\_RATE));
01467 \textcolor{preprocessor}{#endif}
01468 
01469         \textcolor{comment}{/* Automatically set LPF to 1/2 sampling rate. */}
01470         \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} >> 1);
01471         \textcolor{keywordflow}{return} 0;
01472     \}
01473 \}
01474 
\hypertarget{inv__mpu_8c_source.tex_l01480}{}\hyperlink{group___d_r_i_v_e_r_s_gab5a45cd7783f6937788c0decb0b18b16}{01480} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gab5a45cd7783f6937788c0decb0b18b16}{mpu\_get\_compass\_sample\_rate}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *rate)
01481 \{
01482 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
01483     rate[0] = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_sample\_rate;
01484     \textcolor{keywordflow}{return} 0;
01485 \textcolor{preprocessor}{#else}
01486     rate[0] = 0;
01487     \textcolor{keywordflow}{return} -1;
01488 \textcolor{preprocessor}{#endif}
01489 \}
01490 
\hypertarget{inv__mpu_8c_source.tex_l01502}{}\hyperlink{group___d_r_i_v_e_r_s_ga78da3828de0ef9d080c4d03e7bc45e7b}{01502} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga78da3828de0ef9d080c4d03e7bc45e7b}{mpu\_set\_compass\_sample\_rate}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} rate)
01503 \{
01504 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
01505     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} div;
01506     \textcolor{keywordflow}{if} (!rate || rate > st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} || rate > MAX\_COMPASS\_SAMPLE\_RATE)
01507         \textcolor{keywordflow}{return} -1;
01508 
01509     div = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} / rate - 1;
01510     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s4\_ctrl, 1, &div))
01511         \textcolor{keywordflow}{return} -1;
01512     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_sample\_rate = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} / (div + 1);
01513     \textcolor{keywordflow}{return} 0;
01514 \textcolor{preprocessor}{#else}
01515     \textcolor{keywordflow}{return} -1;
01516 \textcolor{preprocessor}{#endif}
01517 \}
01518 
\hypertarget{inv__mpu_8c_source.tex_l01524}{}\hyperlink{group___d_r_i_v_e_r_s_ga023c0cc94aa8f162dc33b15048a49421}{01524} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga023c0cc94aa8f162dc33b15048a49421}{mpu\_get\_gyro\_sens}(\textcolor{keywordtype}{float} *sens)
01525 \{
01526     \textcolor{keywordflow}{switch} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr}) \{
01527     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a5b8251a49db5cb8a676076b0b308ae35}{INV\_FSR\_250DPS}:
01528         sens[0] = 131.f;
01529         \textcolor{keywordflow}{break};
01530     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90a50901470ff389927fd010081e2b8fd09}{INV\_FSR\_500DPS}:
01531         sens[0] = 65.5f;
01532         \textcolor{keywordflow}{break};
01533     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90aee922e0daa4fbb404c3db6c49d897a13}{INV\_FSR\_1000DPS}:
01534         sens[0] = 32.8f;
01535         \textcolor{keywordflow}{break};
01536     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_a83acdc0eb37e8bfe0c2ae2348ded0a90ac0c37efc1c8acd6f70c0c5a768e5b8be}{INV\_FSR\_2000DPS}:
01537         sens[0] = 16.4f;
01538         \textcolor{keywordflow}{break};
01539     \textcolor{keywordflow}{default}:
01540         \textcolor{keywordflow}{return} -1;
01541     \}
01542     \textcolor{keywordflow}{return} 0;
01543 \}
01544 
\hypertarget{inv__mpu_8c_source.tex_l01550}{}\hyperlink{group___d_r_i_v_e_r_s_ga620408949052b96e856cad920f856583}{01550} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga620408949052b96e856cad920f856583}{mpu\_get\_accel\_sens}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *sens)
01551 \{
01552     \textcolor{keywordflow}{switch} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr}) \{
01553     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eae27c6f69463dab7de81fac0c51ff8aa7}{INV\_FSR\_2G}:
01554         sens[0] = 16384;
01555         \textcolor{keywordflow}{break};
01556     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81eaa91e3a89d0bbd01149fe71148595be6d}{INV\_FSR\_4G}:
01557         sens[0] = 8092;
01558         \textcolor{keywordflow}{break};
01559     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea0a40371bdda397d234c53d0ee2f3be8b}{INV\_FSR\_8G}:
01560         sens[0] = 4096;
01561         \textcolor{keywordflow}{break};
01562     \textcolor{keywordflow}{case} \hyperlink{inv__mpu_8c_aec8501b935143099e5f729dee221a81ea6712e8563c97c11b458ef721d4f5f9d5}{INV\_FSR\_16G}:
01563         sens[0] = 2048;
01564         \textcolor{keywordflow}{break};
01565     \textcolor{keywordflow}{default}:
01566         \textcolor{keywordflow}{return} -1;
01567     \}
01568     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_af73df77287fdeba8d408c18f3905650f}{accel\_half})
01569         sens[0] >>= 1;
01570     \textcolor{keywordflow}{return} 0;
01571 \}
01572 
\hypertarget{inv__mpu_8c_source.tex_l01582}{}\hyperlink{group___d_r_i_v_e_r_s_ga093f11eb10b2639a4b9fe344ea348c54}{01582} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga093f11eb10b2639a4b9fe344ea348c54}{mpu\_get\_fifo\_config}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *sensors)
01583 \{
01584     sensors[0] = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable};
01585     \textcolor{keywordflow}{return} 0;
01586 \}
01587 
\hypertarget{inv__mpu_8c_source.tex_l01597}{}\hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{01597} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{mpu\_configure\_fifo}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} sensors)
01598 \{
01599     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} prev;
01600     \textcolor{keywordtype}{int} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result} = 0;
01601 
01602     \textcolor{comment}{/* Compass data isn't going into the FIFO. Stop trying. */}
01603     sensors &= ~\hyperlink{group___d_r_i_v_e_r_s_ga7fc9c1dbdcb2ac8cc2a4128a5799482a}{INV\_XYZ\_COMPASS};
01604 
01605     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on})
01606         \textcolor{keywordflow}{return} 0;
01607     \textcolor{keywordflow}{else} \{
01608         \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors}))
01609             \textcolor{keywordflow}{return} -1;
01610         prev = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable};
01611         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} = sensors & st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.
      \hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors};
01612         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} != sensors)
01613             \textcolor{comment}{/* You're not getting what you asked for. Some sensors are}
01614 \textcolor{comment}{             * asleep.}
01615 \textcolor{comment}{             */}
01616             result = -1;
01617         \textcolor{keywordflow}{else}
01618             result = 0;
01619         \textcolor{keywordflow}{if} (sensors || st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode})
01620             set\_int\_enable(1);
01621         \textcolor{keywordflow}{else}
01622             set\_int\_enable(0);
01623         \textcolor{keywordflow}{if} (sensors) \{
01624             \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{mpu\_reset\_fifo}()) \{
01625                 st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} = prev;
01626                 \textcolor{keywordflow}{return} -1;
01627             \}
01628         \}
01629     \}
01630 
01631     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
01632 \}
01633 
\hypertarget{inv__mpu_8c_source.tex_l01639}{}\hyperlink{group___d_r_i_v_e_r_s_gaec8fa7a067988d174516bb735a4a0bc9}{01639} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gaec8fa7a067988d174516bb735a4a0bc9}{mpu\_get\_power\_state}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *power\_on)
01640 \{
01641     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
01642         power\_on[0] = 1;
01643     \textcolor{keywordflow}{else}
01644         power\_on[0] = 0;
01645     \textcolor{keywordflow}{return} 0;
01646 \}
01647 
\hypertarget{inv__mpu_8c_source.tex_l01658}{}\hyperlink{group___d_r_i_v_e_r_s_ga6e77e7cc1cf6be5e8fdf617c5b4586d1}{01658} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga6e77e7cc1cf6be5e8fdf617c5b4586d1}{mpu\_set\_sensors}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} sensors)
01659 \{
01660     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data;
01661 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
01662     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl};
01663 \textcolor{preprocessor}{#endif}
01664 
01665     \textcolor{keywordflow}{if} (sensors & \hyperlink{group___d_r_i_v_e_r_s_ga3fdc30f9c0a26c2c4e2bb88921f91629}{INV\_XYZ\_GYRO})
01666         data = \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{INV\_CLK\_PLL};
01667     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sensors)
01668         data = 0;
01669     \textcolor{keywordflow}{else}
01670         data = \hyperlink{inv__mpu_8c_a1fed8bd436e9b7dfccb1cae99ca89103}{BIT\_SLEEP};
01671     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, &data)) \{
01672         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = 0;
01673         \textcolor{keywordflow}{return} -1;
01674     \}
01675     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src} = data & ~\hyperlink{inv__mpu_8c_a1fed8bd436e9b7dfccb1cae99ca89103}{BIT\_SLEEP};
01676 
01677     data = 0;
01678     \textcolor{keywordflow}{if} (!(sensors & \hyperlink{group___d_r_i_v_e_r_s_gabf02bf28541421d59f8be764f2b95407}{INV\_X\_GYRO}))
01679         data |= \hyperlink{inv__mpu_8c_a82256fedeffe5b2443ab3ae34cf032d9}{BIT\_STBY\_XG};
01680     \textcolor{keywordflow}{if} (!(sensors & \hyperlink{group___d_r_i_v_e_r_s_gacdd8ff833a34dba08ca2aa145eb92b44}{INV\_Y\_GYRO}))
01681         data |= \hyperlink{inv__mpu_8c_abf1c0a844906a5e887a659971a4af417}{BIT\_STBY\_YG};
01682     \textcolor{keywordflow}{if} (!(sensors & \hyperlink{group___d_r_i_v_e_r_s_ga50205b5cc6089b33b2561c854eb8b0fd}{INV\_Z\_GYRO}))
01683         data |= \hyperlink{inv__mpu_8c_a30967a4efdf3c3f1e39814e72a4168b0}{BIT\_STBY\_ZG};
01684     \textcolor{keywordflow}{if} (!(sensors & \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL}))
01685         data |= \hyperlink{inv__mpu_8c_a04a57159e34387dafe9b86b171c4654c}{BIT\_STBY\_XYZA};
01686     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_adc9ae0e35f199b3349174ac09e219ecb}{pwr\_mgmt\_2}, 1, &data)) \{
01687         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = 0;
01688         \textcolor{keywordflow}{return} -1;
01689     \}
01690 
01691     \textcolor{keywordflow}{if} (sensors && (sensors != INV\_XYZ\_ACCEL))
01692         \textcolor{comment}{/* Latched interrupts only used in LP accel mode. */}
01693         \hyperlink{group___d_r_i_v_e_r_s_ga653cb855300bff9285ce4b8dca6a503b}{mpu\_set\_int\_latched}(0);
01694 
01695 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
01696 \textcolor{preprocessor}{#ifdef AK89xx\_BYPASS}
01697     \textcolor{keywordflow}{if} (sensors & \hyperlink{group___d_r_i_v_e_r_s_ga7fc9c1dbdcb2ac8cc2a4128a5799482a}{INV\_XYZ\_COMPASS})
01698         \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(1);
01699     \textcolor{keywordflow}{else}
01700         \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(0);
01701 \textcolor{preprocessor}{#else}
01702     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &user\_ctrl))
01703         \textcolor{keywordflow}{return} -1;
01704     \textcolor{comment}{/* Handle AKM power management. */}
01705     \textcolor{keywordflow}{if} (sensors & INV\_XYZ\_COMPASS) \{
01706         data = AKM\_SINGLE\_MEASUREMENT;
01707         user\_ctrl |= \hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01708     \} \textcolor{keywordflow}{else} \{
01709         data = AKM\_POWER\_DOWN;
01710         user\_ctrl &= ~\hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01711     \}
01712     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on})
01713         user\_ctrl |= \hyperlink{inv__mpu_8c_a02c3e9ddd63128f1c3cf50bf1e9b5fe6}{BIT\_DMP\_EN};
01714     \textcolor{keywordflow}{else}
01715         user\_ctrl &= ~\hyperlink{inv__mpu_8c_a02c3e9ddd63128f1c3cf50bf1e9b5fe6}{BIT\_DMP\_EN};
01716     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s1\_do, 1, &data))
01717         \textcolor{keywordflow}{return} -1;
01718     \textcolor{comment}{/* Enable/disable I2C master mode. */}
01719     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &user\_ctrl))
01720         \textcolor{keywordflow}{return} -1;
01721 \textcolor{preprocessor}{#endif}
01722 \textcolor{preprocessor}{#endif}
01723 
01724     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = sensors;
01725     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aeb8fb45fc306b199be68b3f61940fbb0}{lp\_accel\_mode} = 0;
01726     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(50);
01727     \textcolor{keywordflow}{return} 0;
01728 \}
01729 
\hypertarget{inv__mpu_8c_source.tex_l01735}{}\hyperlink{group___d_r_i_v_e_r_s_ga0afd02d8c76d3278b488ef7038c26e3e}{01735} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga0afd02d8c76d3278b488ef7038c26e3e}{mpu\_get\_int\_status}(\textcolor{keywordtype}{short} *status)
01736 \{
01737     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];
01738     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
01739         \textcolor{keywordflow}{return} -1;
01740     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a5362f39039c1bbcc9aaa5a973eb762da}{dmp\_int\_status}, 2, tmp))
01741         \textcolor{keywordflow}{return} -1;
01742     status[0] = (tmp[0] << 8) | tmp[1];
01743     \textcolor{keywordflow}{return} 0;
01744 \}
01745 
\hypertarget{inv__mpu_8c_source.tex_l01764}{}\hyperlink{group___d_r_i_v_e_r_s_ga2da20453aafbbba4a0f6fb9fbdd25572}{01764} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga2da20453aafbbba4a0f6fb9fbdd25572}{mpu\_read\_fifo}(\textcolor{keywordtype}{short} *gyro, \textcolor{keywordtype}{short} *accel, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *timestamp,
01765         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *sensors, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *more)
01766 \{
01767     \textcolor{comment}{/* Assumes maximum packet size is gyro (6) + accel (6). */}
01768     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[\hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH}];
01769     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} packet\_size = 0;
01770     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} fifo\_count, index = 0;
01771 
01772     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on})
01773         \textcolor{keywordflow}{return} -1;
01774 
01775     sensors[0] = 0;
01776     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
01777         \textcolor{keywordflow}{return} -1;
01778     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable})
01779         \textcolor{keywordflow}{return} -1;
01780 
01781     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & \hyperlink{group___d_r_i_v_e_r_s_gabf02bf28541421d59f8be764f2b95407}{INV\_X\_GYRO})
01782         packet\_size += 2;
01783     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & \hyperlink{group___d_r_i_v_e_r_s_gacdd8ff833a34dba08ca2aa145eb92b44}{INV\_Y\_GYRO})
01784         packet\_size += 2;
01785     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & \hyperlink{group___d_r_i_v_e_r_s_ga50205b5cc6089b33b2561c854eb8b0fd}{INV\_Z\_GYRO})
01786         packet\_size += 2;
01787     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL})
01788         packet\_size += 6;
01789 
01790     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a769e352846cc0f576d321f5655f7c11c}{fifo\_count\_h}, 2, data))
01791         \textcolor{keywordflow}{return} -1;
01792     fifo\_count = (data[0] << 8) | data[1];
01793     \textcolor{keywordflow}{if} (fifo\_count < packet\_size)
01794         \textcolor{keywordflow}{return} 0;
01795 \textcolor{comment}{//    log\_i("FIFO count: %hd\(\backslash\)n", fifo\_count);}
01796     \textcolor{keywordflow}{if} (fifo\_count > (st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a36e9e2aea952cea137504c539cdb97dc}{max\_fifo} >> 1)) \{
01797         \textcolor{comment}{/* FIFO is 50% full, better check overflow bit. */}
01798         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a39621694d9d5d0c0488c66fa8d088562}{int\_status}, 1, data))
01799             \textcolor{keywordflow}{return} -1;
01800         \textcolor{keywordflow}{if} (data[0] & \hyperlink{inv__mpu_8c_afb9b49ce5dd973b3c29ae72680924fa7}{BIT\_FIFO\_OVERFLOW}) \{
01801             \hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{mpu\_reset\_fifo}();
01802             \textcolor{keywordflow}{return} -2;
01803         \}
01804     \}
01805 
01806  \textcolor{comment}{//   get\_ms((unsigned long*)timestamp);}
01807 
01808 
01809     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w}, packet\_size, data))
01810         \textcolor{keywordflow}{return} -1;
01811     more[0] = fifo\_count / packet\_size - 1;
01812     sensors[0] = 0;
01813 
01814     \textcolor{keywordflow}{if} ((index != packet\_size) && st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & 
      \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL}) \{
01815         accel[0] = (data[index+0] << 8) | data[index+1];
01816         accel[1] = (data[index+2] << 8) | data[index+3];
01817         accel[2] = (data[index+4] << 8) | data[index+5];
01818         sensors[0] |= \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL};
01819         index += 6;
01820     \}
01821     \textcolor{keywordflow}{if} ((index != packet\_size) && st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & 
      \hyperlink{group___d_r_i_v_e_r_s_gabf02bf28541421d59f8be764f2b95407}{INV\_X\_GYRO}) \{
01822         gyro[0] = (data[index+0] << 8) | data[index+1];
01823         sensors[0] |= \hyperlink{group___d_r_i_v_e_r_s_gabf02bf28541421d59f8be764f2b95407}{INV\_X\_GYRO};
01824         index += 2;
01825     \}
01826     \textcolor{keywordflow}{if} ((index != packet\_size) && st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & 
      \hyperlink{group___d_r_i_v_e_r_s_gacdd8ff833a34dba08ca2aa145eb92b44}{INV\_Y\_GYRO}) \{
01827         gyro[1] = (data[index+0] << 8) | data[index+1];
01828         sensors[0] |= \hyperlink{group___d_r_i_v_e_r_s_gacdd8ff833a34dba08ca2aa145eb92b44}{INV\_Y\_GYRO};
01829         index += 2;
01830     \}
01831     \textcolor{keywordflow}{if} ((index != packet\_size) && st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} & 
      \hyperlink{group___d_r_i_v_e_r_s_ga50205b5cc6089b33b2561c854eb8b0fd}{INV\_Z\_GYRO}) \{
01832         gyro[2] = (data[index+0] << 8) | data[index+1];
01833         sensors[0] |= \hyperlink{group___d_r_i_v_e_r_s_ga50205b5cc6089b33b2561c854eb8b0fd}{INV\_Z\_GYRO};
01834         index += 2;
01835     \}
01836 
01837     \textcolor{keywordflow}{return} 0;
01838 \}
01839 
\hypertarget{inv__mpu_8c_source.tex_l01847}{}\hyperlink{group___d_r_i_v_e_r_s_ga13593044949b460e9f571eb57e9a0788}{01847} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga13593044949b460e9f571eb57e9a0788}{mpu\_read\_fifo\_stream}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} length, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data,
01848     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *more)
01849 \{
01850     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];
01851     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} fifo\_count;
01852     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on})
01853         \textcolor{keywordflow}{return} -1;
01854     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
01855         \textcolor{keywordflow}{return} -1;
01856 
01857     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a769e352846cc0f576d321f5655f7c11c}{fifo\_count\_h}, 2, tmp))
01858         \textcolor{keywordflow}{return} -1;
01859     fifo\_count = (tmp[0] << 8) | tmp[1];
01860     \textcolor{keywordflow}{if} (fifo\_count < length) \{
01861         more[0] = 0;
01862         \textcolor{keywordflow}{return} -1;
01863     \}
01864     \textcolor{keywordflow}{if} (fifo\_count > (st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a36e9e2aea952cea137504c539cdb97dc}{max\_fifo} >> 1)) \{
01865         \textcolor{comment}{/* FIFO is 50% full, better check overflow bit. */}
01866         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a39621694d9d5d0c0488c66fa8d088562}{int\_status}, 1, tmp))
01867             \textcolor{keywordflow}{return} -1;
01868         \textcolor{keywordflow}{if} (tmp[0] & \hyperlink{inv__mpu_8c_afb9b49ce5dd973b3c29ae72680924fa7}{BIT\_FIFO\_OVERFLOW}) \{
01869             \hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{mpu\_reset\_fifo}();
01870             \textcolor{keywordflow}{return} -2;
01871         \}
01872     \}
01873 
01874     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w}, length, data))
01875         \textcolor{keywordflow}{return} -1;
01876     more[0] = fifo\_count / length - 1;
01877     \textcolor{keywordflow}{return} 0;
01878 \}
01879 
\hypertarget{inv__mpu_8c_source.tex_l01885}{}\hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{01885} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} bypass\_on)
01886 \{
01887     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp;
01888 
01889     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{bypass\_mode} == bypass\_on)
01890         \textcolor{keywordflow}{return} 0;
01891 
01892     \textcolor{keywordflow}{if} (bypass\_on) \{
01893         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &tmp))
01894             \textcolor{keywordflow}{return} -1;
01895         tmp &= ~\hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01896         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &tmp))
01897             \textcolor{keywordflow}{return} -1;
01898         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(3);
01899         tmp = \hyperlink{inv__mpu_8c_add12a8d89e1a4c4e008b12a96dd4c75d}{BIT\_BYPASS\_EN};
01900         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{active\_low\_int})
01901             tmp |= \hyperlink{inv__mpu_8c_a8467782bedc44051c95643e303543655}{BIT\_ACTL};
01902         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{latched\_int})
01903             tmp |= \hyperlink{inv__mpu_8c_a588b5a95724c4a68c6868faa78fd3a7f}{BIT\_LATCH\_EN} | \hyperlink{inv__mpu_8c_a1f50796ca0363292d9ac9cc1d29d9225}{BIT\_ANY\_RD\_CLR};
01904         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a135c6ee7cb6bdbf6ef9471ce5a6e1724}{int\_pin\_cfg}, 1, &tmp))
01905             \textcolor{keywordflow}{return} -1;
01906     \} \textcolor{keywordflow}{else} \{
01907         \textcolor{comment}{/* Enable I2C master mode if compass is being used. */}
01908         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &tmp))
01909             \textcolor{keywordflow}{return} -1;
01910         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} & \hyperlink{group___d_r_i_v_e_r_s_ga7fc9c1dbdcb2ac8cc2a4128a5799482a}{INV\_XYZ\_COMPASS})
01911             tmp |= \hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01912         \textcolor{keywordflow}{else}
01913             tmp &= ~\hyperlink{inv__mpu_8c_abcdedbd3098140aa14ad17bcaca8e176}{BIT\_AUX\_IF\_EN};
01914         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, &tmp))
01915             \textcolor{keywordflow}{return} -1;
01916         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(3);
01917         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{active\_low\_int})
01918             tmp = \hyperlink{inv__mpu_8c_a8467782bedc44051c95643e303543655}{BIT\_ACTL};
01919         \textcolor{keywordflow}{else}
01920             tmp = 0;
01921         \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{latched\_int})
01922             tmp |= \hyperlink{inv__mpu_8c_a588b5a95724c4a68c6868faa78fd3a7f}{BIT\_LATCH\_EN} | \hyperlink{inv__mpu_8c_a1f50796ca0363292d9ac9cc1d29d9225}{BIT\_ANY\_RD\_CLR};
01923         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a135c6ee7cb6bdbf6ef9471ce5a6e1724}{int\_pin\_cfg}, 1, &tmp))
01924             \textcolor{keywordflow}{return} -1;
01925     \}
01926     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{bypass\_mode} = bypass\_on;
01927     \textcolor{keywordflow}{return} 0;
01928 \}
01929 
\hypertarget{inv__mpu_8c_source.tex_l01935}{}\hyperlink{group___d_r_i_v_e_r_s_gacc92fb1489ef32a04bcb6b0ebde4d657}{01935} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gacc92fb1489ef32a04bcb6b0ebde4d657}{mpu\_set\_int\_level}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} active\_low)
01936 \{
01937     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{active\_low\_int} = active\_low;
01938     \textcolor{keywordflow}{return} 0;
01939 \}
01940 
\hypertarget{inv__mpu_8c_source.tex_l01947}{}\hyperlink{group___d_r_i_v_e_r_s_ga653cb855300bff9285ce4b8dca6a503b}{01947} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga653cb855300bff9285ce4b8dca6a503b}{mpu\_set\_int\_latched}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} enable)
01948 \{
01949     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp;
01950     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{latched\_int} == enable)
01951         \textcolor{keywordflow}{return} 0;
01952 
01953     \textcolor{keywordflow}{if} (enable)
01954         tmp = \hyperlink{inv__mpu_8c_a588b5a95724c4a68c6868faa78fd3a7f}{BIT\_LATCH\_EN} | \hyperlink{inv__mpu_8c_a1f50796ca0363292d9ac9cc1d29d9225}{BIT\_ANY\_RD\_CLR};
01955     \textcolor{keywordflow}{else}
01956         tmp = 0;
01957     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2dd3f2719bc8ed1946811203ec330905}{bypass\_mode})
01958         tmp |= \hyperlink{inv__mpu_8c_add12a8d89e1a4c4e008b12a96dd4c75d}{BIT\_BYPASS\_EN};
01959     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_ac576d810c0c8bcd73af5908c10a83c3a}{active\_low\_int})
01960         tmp |= \hyperlink{inv__mpu_8c_a8467782bedc44051c95643e303543655}{BIT\_ACTL};
01961     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a135c6ee7cb6bdbf6ef9471ce5a6e1724}{int\_pin\_cfg}, 1, &tmp))
01962         \textcolor{keywordflow}{return} -1;
01963     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a6c37b8cd7cf4fd08a3200129cd23255c}{latched\_int} = enable;
01964     \textcolor{keywordflow}{return} 0;
01965 \}
01966 
01967 \textcolor{preprocessor}{#ifdef MPU6050}
01968 \textcolor{keyword}{static} \textcolor{keywordtype}{int} get\_accel\_prod\_shift(\textcolor{keywordtype}{float} *st\_shift)
01969 \{
01970     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[4], shift\_code[3], ii;
01971 
01972     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x0D, 4, tmp))
01973         \textcolor{keywordflow}{return} 0x07;
01974 
01975     shift\_code[0] = ((tmp[0] & 0xE0) >> 3) | ((tmp[3] & 0x30) >> 4);
01976     shift\_code[1] = ((tmp[1] & 0xE0) >> 3) | ((tmp[3] & 0x0C) >> 2);
01977     shift\_code[2] = ((tmp[2] & 0xE0) >> 3) | (tmp[3] & 0x03);
01978     \textcolor{keywordflow}{for} (ii = 0; ii < 3; ii++) \{
01979         \textcolor{keywordflow}{if} (!shift\_code[ii]) \{
01980             st\_shift[ii] = 0.f;
01981             \textcolor{keywordflow}{continue};
01982         \}
01983         \textcolor{comment}{/* Equivalent to..}
01984 \textcolor{comment}{         * st\_shift[ii] = 0.34f * powf(0.92f/0.34f, (shift\_code[ii]-1) / 30.f)}
01985 \textcolor{comment}{         */}
01986         st\_shift[ii] = 0.34f;
01987         \textcolor{keywordflow}{while} (--shift\_code[ii])
01988             st\_shift[ii] *= 1.034f;
01989     \}
01990     \textcolor{keywordflow}{return} 0;
01991 \}
01992 
01993 \textcolor{keyword}{static} \textcolor{keywordtype}{int} accel\_self\_test(\textcolor{keywordtype}{long} *bias\_regular, \textcolor{keywordtype}{long} *bias\_st)
01994 \{
01995     \textcolor{keywordtype}{int} jj, \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result} = 0;
01996     \textcolor{keywordtype}{float} st\_shift[3], st\_shift\_cust, st\_shift\_var;
01997 
01998     get\_accel\_prod\_shift(st\_shift);
01999     \textcolor{keywordflow}{for}(jj = 0; jj < 3; jj++) \{
02000         st\_shift\_cust = labs(bias\_regular[jj] - bias\_st[jj]) / 65536.f;
02001         \textcolor{keywordflow}{if} (st\_shift[jj]) \{
02002             st\_shift\_var = st\_shift\_cust / st\_shift[jj] - 1.f;
02003             \textcolor{keywordflow}{if} (fabs(st\_shift\_var) > test.\hyperlink{structtest__s_ad5bc54ab7d1b1a0f158ca1a79359c3bc}{max\_accel\_var})
02004                 result |= 1 << jj;
02005         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((st\_shift\_cust < test.\hyperlink{structtest__s_aa295cc026745ef7378eeff0c72638ed0}{min\_g}) ||
02006             (st\_shift\_cust > test.\hyperlink{structtest__s_a30dbaf47c9d41bf9e86370664d661bd0}{max\_g}))
02007             result |= 1 << jj;
02008     \}
02009 
02010     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02011 \}
02012 
02013 \textcolor{keyword}{static} \textcolor{keywordtype}{int} gyro\_self\_test(\textcolor{keywordtype}{long} *bias\_regular, \textcolor{keywordtype}{long} *bias\_st)
02014 \{
02015     \textcolor{keywordtype}{int} jj, \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result} = 0;
02016     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[3];
02017     \textcolor{keywordtype}{float} st\_shift, st\_shift\_cust, st\_shift\_var;
02018 
02019     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x0D, 3, tmp))
02020         \textcolor{keywordflow}{return} 0x07;
02021 
02022     tmp[0] &= 0x1F;
02023     tmp[1] &= 0x1F;
02024     tmp[2] &= 0x1F;
02025 
02026     \textcolor{keywordflow}{for} (jj = 0; jj < 3; jj++) \{
02027         st\_shift\_cust = labs(bias\_regular[jj] - bias\_st[jj]) / 65536.f;
02028         \textcolor{keywordflow}{if} (tmp[jj]) \{
02029             st\_shift = 3275.f / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens};
02030             \textcolor{keywordflow}{while} (--tmp[jj])
02031                 st\_shift *= 1.046f;
02032             st\_shift\_var = st\_shift\_cust / st\_shift - 1.f;
02033             \textcolor{keywordflow}{if} (fabs(st\_shift\_var) > test.\hyperlink{structtest__s_a629a75454f5af8caaff2fe8388975d32}{max\_gyro\_var})
02034                 result |= 1 << jj;
02035         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((st\_shift\_cust < test.\hyperlink{structtest__s_a73ee82e1de6d3bdc4cc37282c012f0e1}{min\_dps}) ||
02036             (st\_shift\_cust > test.\hyperlink{structtest__s_a9085b0647fbd57e7ed8e0c4371ad1de2}{max\_dps}))
02037             result |= 1 << jj;
02038     \}
02039     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02040 \}
02041 
02042 \textcolor{preprocessor}{#endif}
02043 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
02044 \textcolor{keyword}{static} \textcolor{keywordtype}{int} compass\_self\_test(\textcolor{keywordtype}{void})
02045 \{
02046     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[6];
02047     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tries = 10;
02048     \textcolor{keywordtype}{int} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result} = 0x07;
02049     \textcolor{keywordtype}{short} data;
02050 
02051     \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(1);
02052 
02053     tmp[0] = AKM\_POWER\_DOWN;
02054     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, tmp))
02055         \textcolor{keywordflow}{return} 0x07;
02056     tmp[0] = AKM\_BIT\_SELF\_TEST;
02057     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_ASTC, 1, tmp))
02058         \textcolor{keywordflow}{goto} AKM\_restore;
02059     tmp[0] = AKM\_MODE\_SELF\_TEST;
02060     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, tmp))
02061         \textcolor{keywordflow}{goto} AKM\_restore;
02062 
02063     \textcolor{keywordflow}{do} \{
02064         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(10);
02065         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_ST1, 1, tmp))
02066             \textcolor{keywordflow}{goto} AKM\_restore;
02067         \textcolor{keywordflow}{if} (tmp[0] & AKM\_DATA\_READY)
02068             \textcolor{keywordflow}{break};
02069     \} \textcolor{keywordflow}{while} (tries--);
02070     \textcolor{keywordflow}{if} (!(tmp[0] & AKM\_DATA\_READY))
02071         \textcolor{keywordflow}{goto} AKM\_restore;
02072 
02073     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_HXL, 6, tmp))
02074         \textcolor{keywordflow}{goto} AKM\_restore;
02075 
02076     result = 0;
02077 \textcolor{preprocessor}{#if defined MPU9150}
02078     data = (short)(tmp[1] << 8) | tmp[0];
02079     \textcolor{keywordflow}{if} ((data > 100) || (data < -100))
02080         result |= 0x01;
02081     data = (short)(tmp[3] << 8) | tmp[2];
02082     \textcolor{keywordflow}{if} ((data > 100) || (data < -100))
02083         result |= 0x02;
02084     data = (short)(tmp[5] << 8) | tmp[4];
02085     \textcolor{keywordflow}{if} ((data > -300) || (data < -1000))
02086         result |= 0x04;
02087 \textcolor{preprocessor}{#elif defined MPU9250}
02088     data = (short)(tmp[1] << 8) | tmp[0];
02089     \textcolor{keywordflow}{if} ((data > 200) || (data < -200))
02090         result |= 0x01;
02091     data = (short)(tmp[3] << 8) | tmp[2];
02092     \textcolor{keywordflow}{if} ((data > 200) || (data < -200))
02093         result |= 0x02;
02094     data = (short)(tmp[5] << 8) | tmp[4];
02095     \textcolor{keywordflow}{if} ((data > -800) || (data < -3200))
02096         result |= 0x04;
02097 \textcolor{preprocessor}{#endif}
02098 AKM\_restore:
02099     tmp[0] = 0 | SUPPORTS\_AK89xx\_HIGH\_SENS;
02100     \hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_ASTC, 1, tmp);
02101     tmp[0] = SUPPORTS\_AK89xx\_HIGH\_SENS;
02102     \hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, tmp);
02103     \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(0);
02104     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02105 \}
02106 \textcolor{preprocessor}{#endif}
02107 
02108 \textcolor{keyword}{static} \textcolor{keywordtype}{int} get\_st\_biases(\textcolor{keywordtype}{long} *gyro, \textcolor{keywordtype}{long} *accel, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} hw\_test)
02109 \{
02110     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[\hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH}];
02111     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} packet\_count, ii;
02112     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} fifo\_count;
02113 
02114     data[0] = 0x01;
02115     data[1] = 0;
02116     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 2, data))
02117         \textcolor{keywordflow}{return} -1;
02118     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(200);
02119     data[0] = 0;
02120     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, data))
02121         \textcolor{keywordflow}{return} -1;
02122     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, data))
02123         \textcolor{keywordflow}{return} -1;
02124     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, data))
02125         \textcolor{keywordflow}{return} -1;
02126     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_af48ab798d6b786068dfbba8bb176bf1e}{i2c\_mst}, 1, data))
02127         \textcolor{keywordflow}{return} -1;
02128     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, data))
02129         \textcolor{keywordflow}{return} -1;
02130     data[0] = \hyperlink{inv__mpu_8c_aeae2cc64314ad05f3a93d2358a2369db}{BIT\_FIFO\_RST} | \hyperlink{inv__mpu_8c_a37d5ceb74c3568e4bab6dcdd0afaa95b}{BIT\_DMP\_RST};
02131     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, data))
02132         \textcolor{keywordflow}{return} -1;
02133     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(15);
02134     data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a794ee75f43ca70e89a68b43642eb2c59}{reg\_lpf};
02135     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf}, 1, data))
02136         \textcolor{keywordflow}{return} -1;
02137     data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a82f9074fa4cc93f3d21f826a9e739294}{reg\_rate\_div};
02138     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a401bb6ee7e48a2bf55398cbaf70c0dc3}{rate\_div}, 1, data))
02139         \textcolor{keywordflow}{return} -1;
02140     \textcolor{keywordflow}{if} (hw\_test)
02141         data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a6063bc7c719cdaddf88633b1148fd323}{reg\_gyro\_fsr} | 0xE0;
02142     \textcolor{keywordflow}{else}
02143         data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a6063bc7c719cdaddf88633b1148fd323}{reg\_gyro\_fsr};
02144     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ac2b87a25876eb44862043cd56d33d49b}{gyro\_cfg}, 1, data))
02145         \textcolor{keywordflow}{return} -1;
02146 
02147     \textcolor{keywordflow}{if} (hw\_test)
02148         data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a08dc2a906129744a045950c3642a9023}{reg\_accel\_fsr} | 0xE0;
02149     \textcolor{keywordflow}{else}
02150         data[0] = test.\hyperlink{structtest__s_a08dc2a906129744a045950c3642a9023}{reg\_accel\_fsr};
02151     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a3e39cea9e122765d4770876d4ce6adc7}{accel\_cfg}, 1, data))
02152         \textcolor{keywordflow}{return} -1;
02153     \textcolor{keywordflow}{if} (hw\_test)
02154         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(200);
02155 
02156     \textcolor{comment}{/* Fill FIFO for test.wait\_ms milliseconds. */}
02157     data[0] = \hyperlink{inv__mpu_8c_ae3c4a18accb84992faaf2534a84a147c}{BIT\_FIFO\_EN};
02158     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, data))
02159         \textcolor{keywordflow}{return} -1;
02160 
02161     data[0] = \hyperlink{group___d_r_i_v_e_r_s_ga3fdc30f9c0a26c2c4e2bb88921f91629}{INV\_XYZ\_GYRO} | \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL};
02162     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, data))
02163         \textcolor{keywordflow}{return} -1;
02164     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(test.\hyperlink{structtest__s_a0abed830f8dc38c7bd17ce78ee2530d8}{wait\_ms});
02165     data[0] = 0;
02166     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, data))
02167         \textcolor{keywordflow}{return} -1;
02168 
02169     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a769e352846cc0f576d321f5655f7c11c}{fifo\_count\_h}, 2, data))
02170         \textcolor{keywordflow}{return} -1;
02171 
02172     fifo\_count = (data[0] << 8) | data[1];
02173     packet\_count = fifo\_count / \hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH};
02174     gyro[0] = gyro[1] = gyro[2] = 0;
02175     accel[0] = accel[1] = accel[2] = 0;
02176 
02177     \textcolor{keywordflow}{for} (ii = 0; ii < packet\_count; ii++) \{
02178         \textcolor{keywordtype}{short} accel\_cur[3], gyro\_cur[3];
02179         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w}, 
      \hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH}, data))
02180             \textcolor{keywordflow}{return} -1;
02181         accel\_cur[0] = ((short)data[0] << 8) | data[1];
02182         accel\_cur[1] = ((short)data[2] << 8) | data[3];
02183         accel\_cur[2] = ((short)data[4] << 8) | data[5];
02184         accel[0] += (long)accel\_cur[0];
02185         accel[1] += (long)accel\_cur[1];
02186         accel[2] += (long)accel\_cur[2];
02187         gyro\_cur[0] = (((short)data[6] << 8) | data[7]);
02188         gyro\_cur[1] = (((short)data[8] << 8) | data[9]);
02189         gyro\_cur[2] = (((short)data[10] << 8) | data[11]);
02190         gyro[0] += (long)gyro\_cur[0];
02191         gyro[1] += (long)gyro\_cur[1];
02192         gyro[2] += (long)gyro\_cur[2];
02193     \}
02194 \textcolor{preprocessor}{#ifdef EMPL\_NO\_64BIT}
02195     gyro[0] = (long)(((\textcolor{keywordtype}{float})gyro[0]*65536.f) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / packet\_count);
02196     gyro[1] = (long)(((\textcolor{keywordtype}{float})gyro[1]*65536.f) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / packet\_count);
02197     gyro[2] = (long)(((\textcolor{keywordtype}{float})gyro[2]*65536.f) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / packet\_count);
02198     \textcolor{keywordflow}{if} (has\_accel) \{
02199         accel[0] = (long)(((\textcolor{keywordtype}{float})accel[0]*65536.f) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} /
02200             packet\_count);
02201         accel[1] = (long)(((\textcolor{keywordtype}{float})accel[1]*65536.f) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} /
02202             packet\_count);
02203         accel[2] = (long)(((\textcolor{keywordtype}{float})accel[2]*65536.f) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} /
02204             packet\_count);
02205         \textcolor{comment}{/* Don't remove gravity! */}
02206         accel[2] -= 65536L;
02207     \}
02208 \textcolor{preprocessor}{#else}
02209     gyro[0] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})gyro[0]<<16) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / packet\_count);
02210     gyro[1] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})gyro[1]<<16) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / packet\_count);
02211     gyro[2] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})gyro[2]<<16) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / packet\_count);
02212     accel[0] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})accel[0]<<16) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} /
02213         packet\_count);
02214     accel[1] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})accel[1]<<16) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} /
02215         packet\_count);
02216     accel[2] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})accel[2]<<16) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} /
02217         packet\_count);
02218     \textcolor{comment}{/* Don't remove gravity! */}
02219     \textcolor{keywordflow}{if} (accel[2] > 0L)
02220         accel[2] -= 65536L;
02221     \textcolor{keywordflow}{else}
02222         accel[2] += 65536L;
02223 \textcolor{preprocessor}{#endif}
02224 
02225     \textcolor{keywordflow}{return} 0;
02226 \}
02227 
02228 \textcolor{preprocessor}{#ifdef MPU6500}
02229 \textcolor{preprocessor}{#define REG\_6500\_XG\_ST\_DATA     0x0}
02230 \textcolor{preprocessor}{#define REG\_6500\_XA\_ST\_DATA     0xD}
02231 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} mpu\_6500\_st\_tb[256] = \{
02232     2620,2646,2672,2699,2726,2753,2781,2808, \textcolor{comment}{//7}
02233     2837,2865,2894,2923,2952,2981,3011,3041, \textcolor{comment}{//15}
02234     3072,3102,3133,3165,3196,3228,3261,3293, \textcolor{comment}{//23}
02235     3326,3359,3393,3427,3461,3496,3531,3566, \textcolor{comment}{//31}
02236     3602,3638,3674,3711,3748,3786,3823,3862, \textcolor{comment}{//39}
02237     3900,3939,3979,4019,4059,4099,4140,4182, \textcolor{comment}{//47}
02238     4224,4266,4308,4352,4395,4439,4483,4528, \textcolor{comment}{//55}
02239     4574,4619,4665,4712,4759,4807,4855,4903, \textcolor{comment}{//63}
02240     4953,5002,5052,5103,5154,5205,5257,5310, \textcolor{comment}{//71}
02241     5363,5417,5471,5525,5581,5636,5693,5750, \textcolor{comment}{//79}
02242     5807,5865,5924,5983,6043,6104,6165,6226, \textcolor{comment}{//87}
02243     6289,6351,6415,6479,6544,6609,6675,6742, \textcolor{comment}{//95}
02244     6810,6878,6946,7016,7086,7157,7229,7301, \textcolor{comment}{//103}
02245     7374,7448,7522,7597,7673,7750,7828,7906, \textcolor{comment}{//111}
02246     7985,8065,8145,8227,8309,8392,8476,8561, \textcolor{comment}{//119}
02247     8647,8733,8820,8909,8998,9088,9178,9270,
02248     9363,9457,9551,9647,9743,9841,9939,10038,
02249     10139,10240,10343,10446,10550,10656,10763,10870,
02250     10979,11089,11200,11312,11425,11539,11654,11771,
02251     11889,12008,12128,12249,12371,12495,12620,12746,
02252     12874,13002,13132,13264,13396,13530,13666,13802,
02253     13940,14080,14221,14363,14506,14652,14798,14946,
02254     15096,15247,15399,15553,15709,15866,16024,16184,
02255     16346,16510,16675,16842,17010,17180,17352,17526,
02256     17701,17878,18057,18237,18420,18604,18790,18978,
02257     19167,19359,19553,19748,19946,20145,20347,20550,
02258     20756,20963,21173,21385,21598,21814,22033,22253,
02259     22475,22700,22927,23156,23388,23622,23858,24097,
02260     24338,24581,24827,25075,25326,25579,25835,26093,
02261     26354,26618,26884,27153,27424,27699,27976,28255,
02262     28538,28823,29112,29403,29697,29994,30294,30597,
02263     30903,31212,31524,31839,32157,32479,32804,33132
02264 \};
02265 \textcolor{keyword}{static} \textcolor{keywordtype}{int} accel\_6500\_self\_test(\textcolor{keywordtype}{long} *bias\_regular, \textcolor{keywordtype}{long} *bias\_st, \textcolor{keywordtype}{int} debug)
02266 \{
02267     \textcolor{keywordtype}{int} i, \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result} = 0, otp\_value\_zero = 0;
02268     \textcolor{keywordtype}{float} accel\_st\_al\_min, accel\_st\_al\_max;
02269     \textcolor{keywordtype}{float} st\_shift\_cust[3], st\_shift\_ratio[3], ct\_shift\_prod[3], accel\_offset\_max;
02270     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} regs[3];
02271     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, REG\_6500\_XA\_ST\_DATA, 3, regs)) \{
02272         \textcolor{keywordflow}{if}(debug)
02273             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Reading OTP Register Error.\(\backslash\)n"});
02274         \textcolor{keywordflow}{return} 0x07;
02275     \}
02276     \textcolor{keywordflow}{if}(debug)
02277         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Accel OTP:%d, %d, %d\(\backslash\)n"}, regs[0], regs[1], regs[2]);
02278     \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02279         \textcolor{keywordflow}{if} (regs[i] != 0) \{
02280             ct\_shift\_prod[i] = mpu\_6500\_st\_tb[regs[i] - 1];
02281             ct\_shift\_prod[i] *= 65536.f;
02282             ct\_shift\_prod[i] /= test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens};
02283         \}
02284         \textcolor{keywordflow}{else} \{
02285             ct\_shift\_prod[i] = 0;
02286             otp\_value\_zero = 1;
02287         \}
02288     \}
02289     \textcolor{keywordflow}{if}(otp\_value\_zero == 0) \{
02290         \textcolor{keywordflow}{if}(debug)
02291             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"ACCEL:CRITERIA A\(\backslash\)n"});
02292         \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02293             st\_shift\_cust[i] = bias\_st[i] - bias\_regular[i];
02294             \textcolor{keywordflow}{if}(debug) \{
02295                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Bias\_Shift=%7.4f, Bias\_Reg=%7.4f, Bias\_HWST=%7.4f\(\backslash\)r\(\backslash\)n"},
02296                         st\_shift\_cust[i]/1.f, bias\_regular[i]/1.f,
02297                         bias\_st[i]/1.f);
02298                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"OTP value: %7.4f\(\backslash\)r\(\backslash\)n"}, ct\_shift\_prod[i]/1.f);
02299             \}
02300 
02301             st\_shift\_ratio[i] = st\_shift\_cust[i] / ct\_shift\_prod[i] - 1.f;
02302 
02303             \textcolor{keywordflow}{if}(debug)
02304                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"ratio=%7.4f, threshold=%7.4f\(\backslash\)r\(\backslash\)n"}, st\_shift\_ratio[i]/1.f,
02305                             test.\hyperlink{structtest__s_ad5bc54ab7d1b1a0f158ca1a79359c3bc}{max\_accel\_var}/1.f);
02306 
02307             \textcolor{keywordflow}{if} (fabs(st\_shift\_ratio[i]) > test.\hyperlink{structtest__s_ad5bc54ab7d1b1a0f158ca1a79359c3bc}{max\_accel\_var}) \{
02308                 \textcolor{keywordflow}{if}(debug)
02309                     \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"ACCEL Fail Axis = %d\(\backslash\)n"}, i);
02310                 result |= 1 << i;   \textcolor{comment}{//Error condition}
02311             \}
02312         \}
02313     \}
02314     \textcolor{keywordflow}{else} \{
02315         \textcolor{comment}{/* Self Test Pass/Fail Criteria B */}
02316         accel\_st\_al\_min = test.\hyperlink{structtest__s_aa295cc026745ef7378eeff0c72638ed0}{min\_g} * 65536.f;
02317         accel\_st\_al\_max = test.\hyperlink{structtest__s_a30dbaf47c9d41bf9e86370664d661bd0}{max\_g} * 65536.f;
02318 
02319         \textcolor{keywordflow}{if}(debug) \{
02320             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"ACCEL:CRITERIA B\(\backslash\)r\(\backslash\)n"});
02321             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Min MG: %7.4f\(\backslash\)r\(\backslash\)n"}, accel\_st\_al\_min/1.f);
02322             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Max MG: %7.4f\(\backslash\)r\(\backslash\)n"}, accel\_st\_al\_max/1.f);
02323         \}
02324 
02325         \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02326             st\_shift\_cust[i] = bias\_st[i] - bias\_regular[i];
02327 
02328             \textcolor{keywordflow}{if}(debug)
02329                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Bias\_shift=%7.4f, st=%7.4f, reg=%7.4f\(\backslash\)n"}, st\_shift\_cust[i]/1.f, bias\_st[i]/1.f,
       bias\_regular[i]/1.f);
02330             \textcolor{keywordflow}{if}(st\_shift\_cust[i] < accel\_st\_al\_min || st\_shift\_cust[i] > accel\_st\_al\_max) \{
02331                 \textcolor{keywordflow}{if}(debug)
02332                     \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Accel FAIL axis:%d <= 225mg or >= 675mg\(\backslash\)n"}, i);
02333                 result |= 1 << i;   \textcolor{comment}{//Error condition}
02334             \}
02335         \}
02336     \}
02337 
02338     \textcolor{keywordflow}{if}(result == 0) \{
02339     \textcolor{comment}{/* Self Test Pass/Fail Criteria C */}
02340         accel\_offset\_max = test.max\_g\_offset * 65536.f;
02341         \textcolor{keywordflow}{if}(debug)
02342             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Accel:CRITERIA C: bias less than %7.4f\(\backslash\)n"}, accel\_offset\_max/1.f);
02343         \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02344             \textcolor{keywordflow}{if}(fabs(bias\_regular[i]) > accel\_offset\_max) \{
02345                 \textcolor{keywordflow}{if}(debug)
02346                     \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"FAILED: Accel axis:%d = %d > 500mg\(\backslash\)n"}, i, bias\_regular[i]);
02347                 result |= 1 << i;   \textcolor{comment}{//Error condition}
02348             \}
02349         \}
02350     \}
02351 
02352     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02353 \}
02354 
02355 \textcolor{keyword}{static} \textcolor{keywordtype}{int} gyro\_6500\_self\_test(\textcolor{keywordtype}{long} *bias\_regular, \textcolor{keywordtype}{long} *bias\_st, \textcolor{keywordtype}{int} debug)
02356 \{
02357     \textcolor{keywordtype}{int} i, \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result} = 0, otp\_value\_zero = 0;
02358     \textcolor{keywordtype}{float} gyro\_st\_al\_max;
02359     \textcolor{keywordtype}{float} st\_shift\_cust[3], st\_shift\_ratio[3], ct\_shift\_prod[3], gyro\_offset\_max;
02360     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} regs[3];
02361 
02362     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, REG\_6500\_XG\_ST\_DATA, 3, regs)) \{
02363         \textcolor{keywordflow}{if}(debug)
02364             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Reading OTP Register Error.\(\backslash\)n"});
02365         \textcolor{keywordflow}{return} 0x07;
02366     \}
02367 
02368     \textcolor{keywordflow}{if}(debug)
02369         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Gyro OTP:%d, %d, %d\(\backslash\)r\(\backslash\)n"}, regs[0], regs[1], regs[2]);
02370 
02371     \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02372         \textcolor{keywordflow}{if} (regs[i] != 0) \{
02373             ct\_shift\_prod[i] = mpu\_6500\_st\_tb[regs[i] - 1];
02374             ct\_shift\_prod[i] *= 65536.f;
02375             ct\_shift\_prod[i] /= test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens};
02376         \}
02377         \textcolor{keywordflow}{else} \{
02378             ct\_shift\_prod[i] = 0;
02379             otp\_value\_zero = 1;
02380         \}
02381     \}
02382 
02383     \textcolor{keywordflow}{if}(otp\_value\_zero == 0) \{
02384         \textcolor{keywordflow}{if}(debug)
02385             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"GYRO:CRITERIA A\(\backslash\)n"});
02386         \textcolor{comment}{/* Self Test Pass/Fail Criteria A */}
02387         \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02388             st\_shift\_cust[i] = bias\_st[i] - bias\_regular[i];
02389 
02390             \textcolor{keywordflow}{if}(debug) \{
02391                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Bias\_Shift=%7.4f, Bias\_Reg=%7.4f, Bias\_HWST=%7.4f\(\backslash\)r\(\backslash\)n"},
02392                         st\_shift\_cust[i]/1.f, bias\_regular[i]/1.f,
02393                         bias\_st[i]/1.f);
02394                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"OTP value: %7.4f\(\backslash\)r\(\backslash\)n"}, ct\_shift\_prod[i]/1.f);
02395             \}
02396 
02397             st\_shift\_ratio[i] = st\_shift\_cust[i] / ct\_shift\_prod[i];
02398 
02399             \textcolor{keywordflow}{if}(debug)
02400                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"ratio=%7.4f, threshold=%7.4f\(\backslash\)r\(\backslash\)n"}, st\_shift\_ratio[i]/1.f,
02401                             test.\hyperlink{structtest__s_a629a75454f5af8caaff2fe8388975d32}{max\_gyro\_var}/1.f);
02402 
02403             \textcolor{keywordflow}{if} (fabs(st\_shift\_ratio[i]) < test.\hyperlink{structtest__s_a629a75454f5af8caaff2fe8388975d32}{max\_gyro\_var}) \{
02404                 \textcolor{keywordflow}{if}(debug)
02405                     \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Gyro Fail Axis = %d\(\backslash\)n"}, i);
02406                 result |= 1 << i;   \textcolor{comment}{//Error condition}
02407             \}
02408         \}
02409     \}
02410     \textcolor{keywordflow}{else} \{
02411         \textcolor{comment}{/* Self Test Pass/Fail Criteria B */}
02412         gyro\_st\_al\_max = test.\hyperlink{structtest__s_a9085b0647fbd57e7ed8e0c4371ad1de2}{max\_dps} * 65536.f;
02413 
02414         \textcolor{keywordflow}{if}(debug) \{
02415             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"GYRO:CRITERIA B\(\backslash\)r\(\backslash\)n"});
02416             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Max DPS: %7.4f\(\backslash\)r\(\backslash\)n"}, gyro\_st\_al\_max/1.f);
02417         \}
02418 
02419         \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02420             st\_shift\_cust[i] = bias\_st[i] - bias\_regular[i];
02421 
02422             \textcolor{keywordflow}{if}(debug)
02423                 \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Bias\_shift=%7.4f, st=%7.4f, reg=%7.4f\(\backslash\)n"}, st\_shift\_cust[i]/1.f, bias\_st[i]/1.f,
       bias\_regular[i]/1.f);
02424             \textcolor{keywordflow}{if}(st\_shift\_cust[i] < gyro\_st\_al\_max) \{
02425                 \textcolor{keywordflow}{if}(debug)
02426                     \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"GYRO FAIL axis:%d greater than 60dps\(\backslash\)n"}, i);
02427                 result |= 1 << i;   \textcolor{comment}{//Error condition}
02428             \}
02429         \}
02430     \}
02431 
02432     \textcolor{keywordflow}{if}(result == 0) \{
02433     \textcolor{comment}{/* Self Test Pass/Fail Criteria C */}
02434         gyro\_offset\_max = test.\hyperlink{structtest__s_a73ee82e1de6d3bdc4cc37282c012f0e1}{min\_dps} * 65536.f;
02435         \textcolor{keywordflow}{if}(debug)
02436             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Gyro:CRITERIA C: bias less than %7.4f\(\backslash\)n"}, gyro\_offset\_max/1.f);
02437         \textcolor{keywordflow}{for} (i = 0; i < 3; i++) \{
02438             \textcolor{keywordflow}{if}(fabs(bias\_regular[i]) > gyro\_offset\_max) \{
02439                 \textcolor{keywordflow}{if}(debug)
02440                     \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"FAILED: Gyro axis:%d = %d > 20dps\(\backslash\)n"}, i, bias\_regular[i]);
02441                 result |= 1 << i;   \textcolor{comment}{//Error condition}
02442             \}
02443         \}
02444     \}
02445     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02446 \}
02447 
02448 \textcolor{keyword}{static} \textcolor{keywordtype}{int} get\_st\_6500\_biases(\textcolor{keywordtype}{long} *gyro, \textcolor{keywordtype}{long} *accel, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} hw\_test, \textcolor{keywordtype}{int} debug)
02449 \{
02450     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[HWST\_MAX\_PACKET\_LENGTH];
02451     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} packet\_count, ii;
02452     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} fifo\_count;
02453     \textcolor{keywordtype}{int} s = 0, read\_size = 0, ind;
02454 
02455     data[0] = 0x01;
02456     data[1] = 0;
02457     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 2, data))
02458         \textcolor{keywordflow}{return} -1;
02459     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(200);
02460     data[0] = 0;
02461     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, data))
02462         \textcolor{keywordflow}{return} -1;
02463     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, data))
02464         \textcolor{keywordflow}{return} -1;
02465     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, data))
02466         \textcolor{keywordflow}{return} -1;
02467     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_af48ab798d6b786068dfbba8bb176bf1e}{i2c\_mst}, 1, data))
02468         \textcolor{keywordflow}{return} -1;
02469     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, data))
02470         \textcolor{keywordflow}{return} -1;
02471     data[0] = \hyperlink{inv__mpu_8c_aeae2cc64314ad05f3a93d2358a2369db}{BIT\_FIFO\_RST} | \hyperlink{inv__mpu_8c_a37d5ceb74c3568e4bab6dcdd0afaa95b}{BIT\_DMP\_RST};
02472     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, data))
02473         \textcolor{keywordflow}{return} -1;
02474     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(15);
02475     data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a794ee75f43ca70e89a68b43642eb2c59}{reg\_lpf};
02476     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf}, 1, data))
02477         \textcolor{keywordflow}{return} -1;
02478     data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a82f9074fa4cc93f3d21f826a9e739294}{reg\_rate\_div};
02479     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a401bb6ee7e48a2bf55398cbaf70c0dc3}{rate\_div}, 1, data))
02480         \textcolor{keywordflow}{return} -1;
02481     \textcolor{keywordflow}{if} (hw\_test)
02482         data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a6063bc7c719cdaddf88633b1148fd323}{reg\_gyro\_fsr} | 0xE0;
02483     \textcolor{keywordflow}{else}
02484         data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a6063bc7c719cdaddf88633b1148fd323}{reg\_gyro\_fsr};
02485     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ac2b87a25876eb44862043cd56d33d49b}{gyro\_cfg}, 1, data))
02486         \textcolor{keywordflow}{return} -1;
02487 
02488     \textcolor{keywordflow}{if} (hw\_test)
02489         data[0] = st.\hyperlink{structgyro__state__s_a4dc7fb069be996a5f40e25c01338a3ca}{test}->\hyperlink{structtest__s_a08dc2a906129744a045950c3642a9023}{reg\_accel\_fsr} | 0xE0;
02490     \textcolor{keywordflow}{else}
02491         data[0] = test.\hyperlink{structtest__s_a08dc2a906129744a045950c3642a9023}{reg\_accel\_fsr};
02492     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a3e39cea9e122765d4770876d4ce6adc7}{accel\_cfg}, 1, data))
02493         \textcolor{keywordflow}{return} -1;
02494 
02495     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(test.\hyperlink{structtest__s_a0abed830f8dc38c7bd17ce78ee2530d8}{wait\_ms});  \textcolor{comment}{//wait 200ms for sensors to stabilize}
02496 
02497     \textcolor{comment}{/* Enable FIFO */}
02498     data[0] = \hyperlink{inv__mpu_8c_ae3c4a18accb84992faaf2534a84a147c}{BIT\_FIFO\_EN};
02499     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 1, data))
02500         \textcolor{keywordflow}{return} -1;
02501     data[0] = \hyperlink{group___d_r_i_v_e_r_s_ga3fdc30f9c0a26c2c4e2bb88921f91629}{INV\_XYZ\_GYRO} | \hyperlink{group___d_r_i_v_e_r_s_gaa03f025a17ed491e70b88274e89c75c5}{INV\_XYZ\_ACCEL};
02502     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, data))
02503         \textcolor{keywordflow}{return} -1;
02504 
02505     \textcolor{comment}{//initialize the bias return values}
02506     gyro[0] = gyro[1] = gyro[2] = 0;
02507     accel[0] = accel[1] = accel[2] = 0;
02508 
02509     \textcolor{keywordflow}{if}(debug)
02510         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Starting Bias Loop Reads\(\backslash\)n"});
02511 
02512     \textcolor{comment}{//start reading samples}
02513     \textcolor{keywordflow}{while} (s < test.\hyperlink{structtest__s_aa8dbf099c1734ea67c1ef1938c0baec8}{packet\_thresh}) \{
02514         \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(test.sample\_wait\_ms); \textcolor{comment}{//wait 10ms to fill FIFO}
02515         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a769e352846cc0f576d321f5655f7c11c}{fifo\_count\_h}, 2, data))
02516             \textcolor{keywordflow}{return} -1;
02517         fifo\_count = (data[0] << 8) | data[1];
02518         packet\_count = fifo\_count / \hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH};
02519         \textcolor{keywordflow}{if} ((test.\hyperlink{structtest__s_aa8dbf099c1734ea67c1ef1938c0baec8}{packet\_thresh} - s) < packet\_count)
02520                     packet\_count = test.\hyperlink{structtest__s_aa8dbf099c1734ea67c1ef1938c0baec8}{packet\_thresh} - s;
02521         read\_size = packet\_count * \hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH};
02522 
02523         \textcolor{comment}{//burst read from FIFO}
02524         if (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a698342c34cc426e84e3435c6b46da120}{fifo\_r\_w}, read\_size, data))
02525                         \textcolor{keywordflow}{return} -1;
02526         ind = 0;
02527         \textcolor{keywordflow}{for} (ii = 0; ii < packet\_count; ii++) \{
02528             \textcolor{keywordtype}{short} accel\_cur[3], gyro\_cur[3];
02529             accel\_cur[0] = ((short)data[ind + 0] << 8) | data[ind + 1];
02530             accel\_cur[1] = ((short)data[ind + 2] << 8) | data[ind + 3];
02531             accel\_cur[2] = ((short)data[ind + 4] << 8) | data[ind + 5];
02532             accel[0] += (long)accel\_cur[0];
02533             accel[1] += (long)accel\_cur[1];
02534             accel[2] += (long)accel\_cur[2];
02535             gyro\_cur[0] = (((short)data[ind + 6] << 8) | data[ind + 7]);
02536             gyro\_cur[1] = (((short)data[ind + 8] << 8) | data[ind + 9]);
02537             gyro\_cur[2] = (((short)data[ind + 10] << 8) | data[ind + 11]);
02538             gyro[0] += (long)gyro\_cur[0];
02539             gyro[1] += (long)gyro\_cur[1];
02540             gyro[2] += (long)gyro\_cur[2];
02541             ind += \hyperlink{inv__mpu_8c_a973c680573b37fc359fc68d0707da355}{MAX\_PACKET\_LENGTH};
02542         \}
02543         s += packet\_count;
02544     \}
02545 
02546     \textcolor{keywordflow}{if}(debug)
02547         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Samples: %d\(\backslash\)n"}, s);
02548 
02549     \textcolor{comment}{//stop FIFO}
02550     data[0] = 0;
02551     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a480d2fa5db4e9c42c61d886d09c5e448}{fifo\_en}, 1, data))
02552         \textcolor{keywordflow}{return} -1;
02553 
02554     gyro[0] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})gyro[0]<<16) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / s);
02555     gyro[1] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})gyro[1]<<16) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / s);
02556     gyro[2] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})gyro[2]<<16) / test.\hyperlink{structtest__s_a32da1174cf6569aa99bdff70055bb45a}{gyro\_sens} / s);
02557     accel[0] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})accel[0]<<16) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} / s);
02558     accel[1] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})accel[1]<<16) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} / s);
02559     accel[2] = (long)(((\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})accel[2]<<16) / test.\hyperlink{structtest__s_a22a1d8ebbceb431baa0dfdc911fbc8ab}{accel\_sens} / s);
02560     \textcolor{comment}{/* remove gravity from bias calculation */}
02561     \textcolor{keywordflow}{if} (accel[2] > 0L)
02562         accel[2] -= 65536L;
02563     \textcolor{keywordflow}{else}
02564         accel[2] += 65536L;
02565 
02566 
02567     \textcolor{keywordflow}{if}(debug) \{
02568         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Accel offset data HWST bit=%d: %7.4f %7.4f %7.4f\(\backslash\)r\(\backslash\)n"}, hw\_test, accel[0]/65536.f, accel
      [1]/65536.f, accel[2]/65536.f);
02569         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Gyro offset data HWST bit=%d: %7.4f %7.4f %7.4f\(\backslash\)r\(\backslash\)n"}, hw\_test, gyro[0]/65536.f, gyro[1]
      /65536.f, gyro[2]/65536.f);
02570     \}
02571 
02572     \textcolor{keywordflow}{return} 0;
02573 \}
02590 \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gac22890157bd3f7cc3752c0342f105b72}{mpu\_run\_6500\_self\_test}(\textcolor{keywordtype}{long} *gyro, \textcolor{keywordtype}{long} *accel, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} debug)
02591 \{
02592     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tries = 2;
02593     \textcolor{keywordtype}{long} gyro\_st[3], accel\_st[3];
02594     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} accel\_result, gyro\_result;
02595 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
02596     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} compass\_result;
02597 \textcolor{preprocessor}{#endif}
02598     \textcolor{keywordtype}{int} ii;
02599 
02600     \textcolor{keywordtype}{int} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02601     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} accel\_fsr, fifo\_sensors, sensors\_on;
02602     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} gyro\_fsr, sample\_rate, \hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf};
02603     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} dmp\_was\_on;
02604 
02605 
02606 
02607     \textcolor{keywordflow}{if}(debug)
02608         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Starting MPU6500 HWST!\(\backslash\)r\(\backslash\)n"});
02609 
02610     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on}) \{
02611         \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(0);
02612         dmp\_was\_on = 1;
02613     \} \textcolor{keywordflow}{else}
02614         dmp\_was\_on = 0;
02615 
02616     \textcolor{comment}{/* Get initial settings. */}
02617     \hyperlink{group___d_r_i_v_e_r_s_gaf973c32c73ba912ff512aab948fc31ca}{mpu\_get\_gyro\_fsr}(&gyro\_fsr);
02618     \hyperlink{group___d_r_i_v_e_r_s_gab6087a15ee23db23b6aec41590329a60}{mpu\_get\_accel\_fsr}(&accel\_fsr);
02619     \hyperlink{group___d_r_i_v_e_r_s_gaa95c7e216dcb2d888e9796001ca555f8}{mpu\_get\_lpf}(&lpf);
02620     \hyperlink{group___d_r_i_v_e_r_s_ga2487dd551b701c1c7ed4d6335f02b2f1}{mpu\_get\_sample\_rate}(&sample\_rate);
02621     sensors\_on = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors};
02622     \hyperlink{group___d_r_i_v_e_r_s_ga093f11eb10b2639a4b9fe344ea348c54}{mpu\_get\_fifo\_config}(&fifo\_sensors);
02623 
02624     \textcolor{keywordflow}{if}(debug)
02625         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Retrieving Biases\(\backslash\)r\(\backslash\)n"});
02626 
02627     \textcolor{keywordflow}{for} (ii = 0; ii < tries; ii++)
02628         \textcolor{keywordflow}{if} (!get\_st\_6500\_biases(gyro, accel, 0, debug))
02629             \textcolor{keywordflow}{break};
02630     \textcolor{keywordflow}{if} (ii == tries) \{
02631         \textcolor{comment}{/* If we reach this point, we most likely encountered an I2C error.}
02632 \textcolor{comment}{         * We'll just report an error for all three sensors.}
02633 \textcolor{comment}{         */}
02634         \textcolor{keywordflow}{if}(debug)
02635             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Retrieving Biases Error - possible I2C error\(\backslash\)n"});
02636 
02637         result = 0;
02638         \textcolor{keywordflow}{goto} restore;
02639     \}
02640 
02641     \textcolor{keywordflow}{if}(debug)
02642         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Retrieving ST Biases\(\backslash\)n"});
02643 
02644     \textcolor{keywordflow}{for} (ii = 0; ii < tries; ii++)
02645         \textcolor{keywordflow}{if} (!get\_st\_6500\_biases(gyro\_st, accel\_st, 1, debug))
02646             \textcolor{keywordflow}{break};
02647     \textcolor{keywordflow}{if} (ii == tries) \{
02648 
02649         \textcolor{keywordflow}{if}(debug)
02650             \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Retrieving ST Biases Error - possible I2C error\(\backslash\)n"});
02651 
02652         \textcolor{comment}{/* Again, probably an I2C error. */}
02653         result = 0;
02654         \textcolor{keywordflow}{goto} restore;
02655     \}
02656 
02657     accel\_result = accel\_6500\_self\_test(accel, accel\_st, debug);
02658     \textcolor{keywordflow}{if}(debug)
02659         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Accel Self Test Results: %d\(\backslash\)n"}, accel\_result);
02660 
02661     gyro\_result = gyro\_6500\_self\_test(gyro, gyro\_st, debug);
02662     \textcolor{keywordflow}{if}(debug)
02663         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Gyro Self Test Results: %d\(\backslash\)n"}, gyro\_result);
02664 
02665     result = 0;
02666     \textcolor{keywordflow}{if} (!gyro\_result)
02667         result |= 0x01;
02668     \textcolor{keywordflow}{if} (!accel\_result)
02669         result |= 0x02;
02670 
02671 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
02672     compass\_result = compass\_self\_test();
02673     \textcolor{keywordflow}{if}(debug)
02674         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Compass Self Test Results: %d\(\backslash\)n"}, compass\_result);
02675     \textcolor{keywordflow}{if} (!compass\_result)
02676         result |= 0x04;
02677 \textcolor{preprocessor}{#else}
02678     result |= 0x04;
02679 \textcolor{preprocessor}{#endif}
02680 restore:
02681     \textcolor{keywordflow}{if}(debug)
02682         \hyperlink{inv__mpu_8c_a67fc07fa528d8e62dc7b88a847b563f5}{log\_i}(\textcolor{stringliteral}{"Exiting HWST\(\backslash\)n"});
02683     \textcolor{comment}{/* Set to invalid values to ensure no I2C writes are skipped. */}
02684     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr} = 0xFF;
02685     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr} = 0xFF;
02686     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf} = 0xFF;
02687     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} = 0xFFFF;
02688     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = 0xFF;
02689     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} = 0xFF;
02690     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src} = \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{INV\_CLK\_PLL};
02691     \hyperlink{group___d_r_i_v_e_r_s_gad09e6031c8677adc0b8a39b6deea8e27}{mpu\_set\_gyro\_fsr}(gyro\_fsr);
02692     \hyperlink{group___d_r_i_v_e_r_s_ga2713a96af104cfb2ae8e0ed4c3718119}{mpu\_set\_accel\_fsr}(accel\_fsr);
02693     \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(lpf);
02694     \hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{mpu\_set\_sample\_rate}(sample\_rate);
02695     \hyperlink{group___d_r_i_v_e_r_s_ga6e77e7cc1cf6be5e8fdf617c5b4586d1}{mpu\_set\_sensors}(sensors\_on);
02696     \hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{mpu\_configure\_fifo}(fifo\_sensors);
02697 
02698     \textcolor{keywordflow}{if} (dmp\_was\_on)
02699         \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(1);
02700 
02701     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02702 \}
02703 \textcolor{preprocessor}{#endif}
02704  \textcolor{comment}{/*}
02705 \textcolor{comment}{ *  \(\backslash\)n This function must be called with the device either face-up or face-down}
02706 \textcolor{comment}{ *  (z-axis is parallel to gravity).}
02707 \textcolor{comment}{ *  @param[out] gyro        Gyro biases in q16 format.}
02708 \textcolor{comment}{ *  @param[out] accel       Accel biases (if applicable) in q16 format.}
02709 \textcolor{comment}{ *  @return     Result mask (see above).}
02710 \textcolor{comment}{ */}
\hypertarget{inv__mpu_8c_source.tex_l02711}{}\hyperlink{group___d_r_i_v_e_r_s_ga3773dc98eb1ba15da0091ae75abcf62f}{02711} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga3773dc98eb1ba15da0091ae75abcf62f}{mpu\_run\_self\_test}(\textcolor{keywordtype}{long} *gyro, \textcolor{keywordtype}{long} *accel)
02712 \{
02713 \textcolor{preprocessor}{#ifdef MPU6050}
02714     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tries = 2;
02715     \textcolor{keywordtype}{long} gyro\_st[3], accel\_st[3];
02716     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} accel\_result, gyro\_result;
02717 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
02718     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} compass\_result;
02719 \textcolor{preprocessor}{#endif}
02720     \textcolor{keywordtype}{int} ii;
02721 \textcolor{preprocessor}{#endif}
02722     \textcolor{keywordtype}{int} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02723     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} accel\_fsr, fifo\_sensors, sensors\_on;
02724     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} gyro\_fsr, sample\_rate, \hyperlink{structgyro__reg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf};
02725     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} dmp\_was\_on;
02726 
02727     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on}) \{
02728         \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(0);
02729         dmp\_was\_on = 1;
02730     \} \textcolor{keywordflow}{else}
02731         dmp\_was\_on = 0;
02732 
02733     \textcolor{comment}{/* Get initial settings. */}
02734     \hyperlink{group___d_r_i_v_e_r_s_gaf973c32c73ba912ff512aab948fc31ca}{mpu\_get\_gyro\_fsr}(&gyro\_fsr);
02735     \hyperlink{group___d_r_i_v_e_r_s_gab6087a15ee23db23b6aec41590329a60}{mpu\_get\_accel\_fsr}(&accel\_fsr);
02736     \hyperlink{group___d_r_i_v_e_r_s_gaa95c7e216dcb2d888e9796001ca555f8}{mpu\_get\_lpf}(&lpf);
02737     \hyperlink{group___d_r_i_v_e_r_s_ga2487dd551b701c1c7ed4d6335f02b2f1}{mpu\_get\_sample\_rate}(&sample\_rate);
02738     sensors\_on = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors};
02739     \hyperlink{group___d_r_i_v_e_r_s_ga093f11eb10b2639a4b9fe344ea348c54}{mpu\_get\_fifo\_config}(&fifo\_sensors);
02740 
02741     \textcolor{comment}{/* For older chips, the self-test will be different. */}
02742 \textcolor{preprocessor}{#if defined MPU6050}
02743     \textcolor{keywordflow}{for} (ii = 0; ii < tries; ii++)
02744         \textcolor{keywordflow}{if} (!get\_st\_biases(gyro, accel, 0))
02745             \textcolor{keywordflow}{break};
02746     \textcolor{keywordflow}{if} (ii == tries) \{
02747         \textcolor{comment}{/* If we reach this point, we most likely encountered an I2C error.}
02748 \textcolor{comment}{         * We'll just report an error for all three sensors.}
02749 \textcolor{comment}{         */}
02750         result = 0;
02751         \textcolor{keywordflow}{goto} restore;
02752     \}
02753     \textcolor{keywordflow}{for} (ii = 0; ii < tries; ii++)
02754         \textcolor{keywordflow}{if} (!get\_st\_biases(gyro\_st, accel\_st, 1))
02755             \textcolor{keywordflow}{break};
02756     \textcolor{keywordflow}{if} (ii == tries) \{
02757         \textcolor{comment}{/* Again, probably an I2C error. */}
02758         result = 0;
02759         \textcolor{keywordflow}{goto} restore;
02760     \}
02761     accel\_result = accel\_self\_test(accel, accel\_st);
02762     gyro\_result = gyro\_self\_test(gyro, gyro\_st);
02763 
02764     result = 0;
02765     \textcolor{keywordflow}{if} (!gyro\_result)
02766         result |= 0x01;
02767     \textcolor{keywordflow}{if} (!accel\_result)
02768         result |= 0x02;
02769 
02770 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
02771     compass\_result = compass\_self\_test();
02772     \textcolor{keywordflow}{if} (!compass\_result)
02773         result |= 0x04;
02774 \textcolor{preprocessor}{#else}
02775         result |= 0x04;
02776 \textcolor{preprocessor}{#endif}
02777 restore:
02778 \textcolor{preprocessor}{#elif defined MPU6500}
02779     \textcolor{comment}{/* For now, this function will return a "pass" result for all three sensors}
02780 \textcolor{comment}{     * for compatibility with current test applications.}
02781 \textcolor{comment}{     */}
02782     get\_st\_biases(gyro, accel, 0);
02783     result = 0x7;
02784 \textcolor{preprocessor}{#endif}
02785     \textcolor{comment}{/* Set to invalid values to ensure no I2C writes are skipped. */}
02786     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr} = 0xFF;
02787     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr} = 0xFF;
02788     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf} = 0xFF;
02789     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} = 0xFFFF;
02790     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = 0xFF;
02791     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} = 0xFF;
02792     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src} = \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{INV\_CLK\_PLL};
02793     \hyperlink{group___d_r_i_v_e_r_s_gad09e6031c8677adc0b8a39b6deea8e27}{mpu\_set\_gyro\_fsr}(gyro\_fsr);
02794     \hyperlink{group___d_r_i_v_e_r_s_ga2713a96af104cfb2ae8e0ed4c3718119}{mpu\_set\_accel\_fsr}(accel\_fsr);
02795     \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(lpf);
02796     \hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{mpu\_set\_sample\_rate}(sample\_rate);
02797     \hyperlink{group___d_r_i_v_e_r_s_ga6e77e7cc1cf6be5e8fdf617c5b4586d1}{mpu\_set\_sensors}(sensors\_on);
02798     \hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{mpu\_configure\_fifo}(fifo\_sensors);
02799 
02800     \textcolor{keywordflow}{if} (dmp\_was\_on)
02801         \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(1);
02802 
02803     \textcolor{keywordflow}{return} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02804 \}
02805 
\hypertarget{inv__mpu_8c_source.tex_l02815}{}\hyperlink{group___d_r_i_v_e_r_s_gafea59910bc3dd30ba3356b1c75213a5f}{02815} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gafea59910bc3dd30ba3356b1c75213a5f}{mpu\_write\_mem}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} mem\_addr, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} length,
02816         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data)
02817 \{
02818     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];
02819 
02820     \textcolor{keywordflow}{if} (!data)
02821         \textcolor{keywordflow}{return} -1;
02822     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
02823         \textcolor{keywordflow}{return} -1;
02824 
02825     tmp[0] = (\textcolor{keywordtype}{unsigned} char)(mem\_addr >> 8);
02826     tmp[1] = (\textcolor{keywordtype}{unsigned} char)(mem\_addr & 0xFF);
02827 
02828     \textcolor{comment}{/* Check bank boundaries. */}
02829     \textcolor{keywordflow}{if} (tmp[1] + length > st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a9e26f1784621a59cabcbfff28dc0b8ba}{bank\_size})
02830         \textcolor{keywordflow}{return} -1;
02831 
02832     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ac5fa957c7e1347ce8cf61f4a5fc52a5c}{bank\_sel}, 2, tmp))
02833         \textcolor{keywordflow}{return} -1;
02834     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a1e6aa9b45ef18f1e5f6369c6383e1f0f}{mem\_r\_w}, length, data))
02835         \textcolor{keywordflow}{return} -1;
02836     \textcolor{keywordflow}{return} 0;
02837 \}
02838 
\hypertarget{inv__mpu_8c_source.tex_l02848}{}\hyperlink{group___d_r_i_v_e_r_s_ga3374bececb6743893c9eab27645c1182}{02848} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga3374bececb6743893c9eab27645c1182}{mpu\_read\_mem}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} mem\_addr, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} length,
02849         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data)
02850 \{
02851     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];
02852 
02853     \textcolor{keywordflow}{if} (!data)
02854         \textcolor{keywordflow}{return} -1;
02855     \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors})
02856         \textcolor{keywordflow}{return} -1;
02857 
02858     tmp[0] = (\textcolor{keywordtype}{unsigned} char)(mem\_addr >> 8);
02859     tmp[1] = (\textcolor{keywordtype}{unsigned} char)(mem\_addr & 0xFF);
02860 
02861     \textcolor{comment}{/* Check bank boundaries. */}
02862     \textcolor{keywordflow}{if} (tmp[1] + length > st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a9e26f1784621a59cabcbfff28dc0b8ba}{bank\_size})
02863         \textcolor{keywordflow}{return} -1;
02864 
02865     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ac5fa957c7e1347ce8cf61f4a5fc52a5c}{bank\_sel}, 2, tmp))
02866         \textcolor{keywordflow}{return} -1;
02867     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a1e6aa9b45ef18f1e5f6369c6383e1f0f}{mem\_r\_w}, length, data))
02868         \textcolor{keywordflow}{return} -1;
02869     \textcolor{keywordflow}{return} 0;
02870 \}
02871 
\hypertarget{inv__mpu_8c_source.tex_l02880}{}\hyperlink{group___d_r_i_v_e_r_s_ga8fbdfe1a50285d4ab438e29c2efc70f5}{02880} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga8fbdfe1a50285d4ab438e29c2efc70f5}{mpu\_load\_firmware}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} length, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *firmware,
02881     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} start\_addr, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} sample\_rate)
02882 \{
02883     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} ii;
02884     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} this\_write;
02885     \textcolor{comment}{/* Must divide evenly into st.hw->bank\_size to avoid bank crossings. */}
02886 \textcolor{preprocessor}{#define LOAD\_CHUNK  (16)}
02887     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} cur[\hyperlink{inv__mpu_8c_a7750730ae7e5c713b619e347d44185fe}{LOAD\_CHUNK}], tmp[2];
02888 
02889     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_afc32c3e58317c589014257dc9b1ee04b}{dmp\_loaded})
02890         \textcolor{comment}{/* DMP should only be loaded once. */}
02891         \textcolor{keywordflow}{return} -1;
02892 
02893     \textcolor{keywordflow}{if} (!firmware)
02894         \textcolor{keywordflow}{return} -1;
02895     \textcolor{keywordflow}{for} (ii = 0; ii < length; ii += this\_write) \{
02896         this\_write = \hyperlink{group___d_r_i_v_e_r_s_gac6afabdc09a49a433ee19d8a9486056d}{min}(\hyperlink{inv__mpu_8c_a7750730ae7e5c713b619e347d44185fe}{LOAD\_CHUNK}, length - ii);
02897         \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_gafea59910bc3dd30ba3356b1c75213a5f}{mpu\_write\_mem}(ii, this\_write, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)&firmware[ii]))
02898             \textcolor{keywordflow}{return} -1;
02899         \textcolor{keywordflow}{if} (\hyperlink{group___d_r_i_v_e_r_s_ga3374bececb6743893c9eab27645c1182}{mpu\_read\_mem}(ii, this\_write, cur))
02900             \textcolor{keywordflow}{return} -1;
02901         \textcolor{keywordflow}{if} (memcmp(firmware+ii, cur, this\_write))
02902             \textcolor{keywordflow}{return} -2;
02903     \}
02904 
02905     \textcolor{comment}{/* Set program start address. */}
02906     tmp[0] = start\_addr >> 8;
02907     tmp[1] = start\_addr & 0xFF;
02908     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a0813e85e389743e828cc84c5b903ada1}{prgm\_start\_h}, 2, tmp))
02909         \textcolor{keywordflow}{return} -1;
02910 
02911     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_afc32c3e58317c589014257dc9b1ee04b}{dmp\_loaded} = 1;
02912     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a5d17c6049cc8cb74faf5cdb942988294}{dmp\_sample\_rate} = sample\_rate;
02913     \textcolor{keywordflow}{return} 0;
02914 \}
02915 
\hypertarget{inv__mpu_8c_source.tex_l02921}{}\hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{02921} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} enable)
02922 \{
02923     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp;
02924     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on} == enable)
02925         \textcolor{keywordflow}{return} 0;
02926 
02927     \textcolor{keywordflow}{if} (enable) \{
02928         \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_afc32c3e58317c589014257dc9b1ee04b}{dmp\_loaded})
02929             \textcolor{keywordflow}{return} -1;
02930         \textcolor{comment}{/* Disable data ready interrupt. */}
02931         set\_int\_enable(0);
02932         \textcolor{comment}{/* Disable bypass mode. */}
02933         \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(0);
02934         \textcolor{comment}{/* Keep constant sample rate, FIFO rate controlled by DMP. */}
02935         \hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{mpu\_set\_sample\_rate}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.
      \hyperlink{structchip__cfg__s_a5d17c6049cc8cb74faf5cdb942988294}{dmp\_sample\_rate});
02936         \textcolor{comment}{/* Remove FIFO elements. */}
02937         tmp = 0;
02938         \hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x23, 1, &tmp);
02939         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on} = 1;
02940         \textcolor{comment}{/* Enable DMP interrupt. */}
02941         set\_int\_enable(1);
02942         \hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{mpu\_reset\_fifo}();
02943     \} \textcolor{keywordflow}{else} \{
02944         \textcolor{comment}{/* Disable DMP interrupt. */}
02945         set\_int\_enable(0);
02946         \textcolor{comment}{/* Restore FIFO settings. */}
02947         tmp = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable};
02948         \hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, 0x23, 1, &tmp);
02949         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on} = 0;
02950         \hyperlink{group___d_r_i_v_e_r_s_gaf23e9f57c0059be6ec57862f0584de10}{mpu\_reset\_fifo}();
02951     \}
02952     \textcolor{keywordflow}{return} 0;
02953 \}
02954 
\hypertarget{inv__mpu_8c_source.tex_l02960}{}\hyperlink{group___d_r_i_v_e_r_s_gafe0f60ed0d7f8fd2dcd55d45b95a2363}{02960} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gafe0f60ed0d7f8fd2dcd55d45b95a2363}{mpu\_get\_dmp\_state}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *enabled)
02961 \{
02962     enabled[0] = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on};
02963     \textcolor{keywordflow}{return} 0;
02964 \}
02965 
02966 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
02967 \textcolor{comment}{/* This initialization is similar to the one in ak8975.c. */}
02968 \textcolor{keyword}{static} \textcolor{keywordtype}{int} setup\_compass(\textcolor{keywordtype}{void})
02969 \{
02970     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[4], akm\_addr;
02971 
02972     \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(1);
02973 
02974     \textcolor{comment}{/* Find compass. Possible addresses range from 0x0C to 0x0F. */}
02975     \textcolor{keywordflow}{for} (akm\_addr = 0x0C; akm\_addr <= 0x0F; akm\_addr++) \{
02976         \textcolor{keywordtype}{int} \hyperlink{sensor_8h_a4c9d9cb8bb9d2b707a152051408f40e5}{result};
02977         result = \hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(akm\_addr, AKM\_REG\_WHOAMI, 1, data);
02978         \textcolor{keywordflow}{if} (!result && (data[0] == AKM\_WHOAMI))
02979             \textcolor{keywordflow}{break};
02980     \}
02981 
02982     \textcolor{keywordflow}{if} (akm\_addr > 0x0F) \{
02983         \textcolor{comment}{/* TODO: Handle this case in all compass-related functions. */}
02984         \hyperlink{group___d_r_i_v_e_r_s_gac9308c888b394d1b403d9ba6e1f13fd2}{log\_e}(\textcolor{stringliteral}{"Compass not found.\(\backslash\)n"});
02985         \textcolor{keywordflow}{return} -1;
02986     \}
02987 
02988     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr = akm\_addr;
02989 
02990     data[0] = AKM\_POWER\_DOWN;
02991     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, data))
02992         \textcolor{keywordflow}{return} -1;
02993     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(1);
02994 
02995     data[0] = AKM\_FUSE\_ROM\_ACCESS;
02996     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, data))
02997         \textcolor{keywordflow}{return} -1;
02998     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(1);
02999 
03000     \textcolor{comment}{/* Get sensitivity adjustment data from fuse ROM. */}
03001     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_ASAX, 3, data))
03002         \textcolor{keywordflow}{return} -1;
03003     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.mag\_sens\_adj[0] = (long)data[0] + 128;
03004     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.mag\_sens\_adj[1] = (long)data[1] + 128;
03005     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.mag\_sens\_adj[2] = (long)data[2] + 128;
03006 
03007     data[0] = AKM\_POWER\_DOWN;
03008     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, data))
03009         \textcolor{keywordflow}{return} -1;
03010     \hyperlink{inv__mpu_8c_ae36aca5baf9b6b7d74992aef00686d67}{delay\_ms}(1);
03011 
03012     \hyperlink{group___d_r_i_v_e_r_s_ga36f70f38371b48d81094d3b061233e15}{mpu\_set\_bypass}(0);
03013 
03014     \textcolor{comment}{/* Set up master mode, master clock, and ES bit. */}
03015     data[0] = 0x40;
03016     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_af48ab798d6b786068dfbba8bb176bf1e}{i2c\_mst}, 1, data))
03017         \textcolor{keywordflow}{return} -1;
03018 
03019     \textcolor{comment}{/* Slave 0 reads from AKM data registers. */}
03020     data[0] = \hyperlink{inv__mpu_8c_a8ef1963ec6fb3df5586e50959cf00a70}{BIT\_I2C\_READ} | st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr;
03021     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s0\_addr, 1, data))
03022         \textcolor{keywordflow}{return} -1;
03023 
03024     \textcolor{comment}{/* Compass reads start at this register. */}
03025     data[0] = AKM\_REG\_ST1;
03026     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s0\_reg, 1, data))
03027         \textcolor{keywordflow}{return} -1;
03028 
03029     \textcolor{comment}{/* Enable slave 0, 8-byte reads. */}
03030     data[0] = \hyperlink{inv__mpu_8c_ae9440f48b6d70d900366dc040a8714d7}{BIT\_SLAVE\_EN} | 8;
03031     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s0\_ctrl, 1, data))
03032         \textcolor{keywordflow}{return} -1;
03033 
03034     \textcolor{comment}{/* Slave 1 changes AKM measurement mode. */}
03035     data[0] = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr;
03036     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s1\_addr, 1, data))
03037         \textcolor{keywordflow}{return} -1;
03038 
03039     \textcolor{comment}{/* AKM measurement mode register. */}
03040     data[0] = AKM\_REG\_CNTL;
03041     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s1\_reg, 1, data))
03042         \textcolor{keywordflow}{return} -1;
03043 
03044     \textcolor{comment}{/* Enable slave 1, 1-byte writes. */}
03045     data[0] = \hyperlink{inv__mpu_8c_ae9440f48b6d70d900366dc040a8714d7}{BIT\_SLAVE\_EN} | 1;
03046     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s1\_ctrl, 1, data))
03047         \textcolor{keywordflow}{return} -1;
03048 
03049     \textcolor{comment}{/* Set slave 1 data. */}
03050     data[0] = AKM\_SINGLE\_MEASUREMENT;
03051     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->s1\_do, 1, data))
03052         \textcolor{keywordflow}{return} -1;
03053 
03054     \textcolor{comment}{/* Trigger slave 0 and slave 1 actions at each sample. */}
03055     data[0] = 0x03;
03056     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->i2c\_delay\_ctrl, 1, data))
03057         \textcolor{keywordflow}{return} -1;
03058 
03059 \textcolor{preprocessor}{#ifdef MPU9150}
03060     \textcolor{comment}{/* For the MPU9150, the auxiliary I2C bus needs to be set to VDD. */}
03061     data[0] = \hyperlink{inv__mpu_8c_ac52d7caf4efc485ef6faa1211bfe60dc}{BIT\_I2C\_MST\_VDDIO};
03062     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->yg\_offs\_tc, 1, data))
03063         \textcolor{keywordflow}{return} -1;
03064 \textcolor{preprocessor}{#endif}
03065 
03066     \textcolor{keywordflow}{return} 0;
03067 \}
03068 \textcolor{preprocessor}{#endif}
03069 
\hypertarget{inv__mpu_8c_source.tex_l03076}{}\hyperlink{group___d_r_i_v_e_r_s_ga65e6b0ce980b8c0255d7be9b55c88c08}{03076} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga65e6b0ce980b8c0255d7be9b55c88c08}{mpu\_get\_compass\_reg}(\textcolor{keywordtype}{short} *data, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *timestamp)
03077 \{
03078 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
03079     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[9];
03080 
03081     \textcolor{keywordflow}{if} (!(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} & \hyperlink{group___d_r_i_v_e_r_s_ga7fc9c1dbdcb2ac8cc2a4128a5799482a}{INV\_XYZ\_COMPASS}))
03082         \textcolor{keywordflow}{return} -1;
03083 
03084 \textcolor{preprocessor}{#ifdef AK89xx\_BYPASS}
03085     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_ST1, 8, tmp))
03086         \textcolor{keywordflow}{return} -1;
03087     tmp[8] = AKM\_SINGLE\_MEASUREMENT;
03088     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.compass\_addr, AKM\_REG\_CNTL, 1, tmp+8))
03089         \textcolor{keywordflow}{return} -1;
03090 \textcolor{preprocessor}{#else}
03091     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac2d47e7a6c76f93f9b537c31a2986e7b}{i2c\_read}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->raw\_compass, 8, tmp))
03092         \textcolor{keywordflow}{return} -1;
03093 \textcolor{preprocessor}{#endif}
03094 
03095 \textcolor{preprocessor}{#if defined AK8975\_SECONDARY}
03096     \textcolor{comment}{/* AK8975 doesn't have the overrun error bit. */}
03097     \textcolor{keywordflow}{if} (!(tmp[0] & AKM\_DATA\_READY))
03098         \textcolor{keywordflow}{return} -2;
03099     \textcolor{keywordflow}{if} ((tmp[7] & AKM\_OVERFLOW) || (tmp[7] & AKM\_DATA\_ERROR))
03100         \textcolor{keywordflow}{return} -3;
03101 \textcolor{preprocessor}{#elif defined AK8963\_SECONDARY}
03102     \textcolor{comment}{/* AK8963 doesn't have the data read error bit. */}
03103     \textcolor{keywordflow}{if} (!(tmp[0] & AKM\_DATA\_READY) || (tmp[0] & AKM\_DATA\_OVERRUN))
03104         \textcolor{keywordflow}{return} -2;
03105     \textcolor{keywordflow}{if} (tmp[7] & AKM\_OVERFLOW)
03106         \textcolor{keywordflow}{return} -3;
03107 \textcolor{preprocessor}{#endif}
03108     data[0] = (tmp[2] << 8) | tmp[1];
03109     data[1] = (tmp[4] << 8) | tmp[3];
03110     data[2] = (tmp[6] << 8) | tmp[5];
03111 
03112     data[0] = ((long)data[0] * st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.mag\_sens\_adj[0]) >> 8;
03113     data[1] = ((long)data[1] * st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.mag\_sens\_adj[1]) >> 8;
03114     data[2] = ((long)data[2] * st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.mag\_sens\_adj[2]) >> 8;
03115 
03116     \textcolor{keywordflow}{if} (timestamp)
03117        \textcolor{comment}{// get\_ms(timestamp);}
03118     \textcolor{keywordflow}{return} 0;
03119 \textcolor{preprocessor}{#else}
03120     \textcolor{keywordflow}{return} -1;
03121 \textcolor{preprocessor}{#endif}
03122 \}
03123 
\hypertarget{inv__mpu_8c_source.tex_l03129}{}\hyperlink{group___d_r_i_v_e_r_s_gade8589573d09e0f14b84130428f286df}{03129} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_gade8589573d09e0f14b84130428f286df}{mpu\_get\_compass\_fsr}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *fsr)
03130 \{
03131 \textcolor{preprocessor}{#ifdef AK89xx\_SECONDARY}
03132     fsr[0] = st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->compass\_fsr;
03133     \textcolor{keywordflow}{return} 0;
03134 \textcolor{preprocessor}{#else}
03135     \textcolor{keywordflow}{return} -1;
03136 \textcolor{preprocessor}{#endif}
03137 \}
03138 
\hypertarget{inv__mpu_8c_source.tex_l03177}{}\hyperlink{group___d_r_i_v_e_r_s_ga7d0b3259346898ccd1ba6ef78bf7df97}{03177} \textcolor{keywordtype}{int} \hyperlink{group___d_r_i_v_e_r_s_ga7d0b3259346898ccd1ba6ef78bf7df97}{mpu\_lp\_motion\_interrupt}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} thresh, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} time,
03178     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} lpa\_freq)
03179 \{
03180 
03181 \textcolor{preprocessor}{#if defined MPU6500}
03182     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} data[3];
03183 \textcolor{preprocessor}{#endif}
03184     \textcolor{keywordflow}{if} (lpa\_freq) \{
03185 \textcolor{preprocessor}{#if defined MPU6500}
03186         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} thresh\_hw;
03187 
03188         \textcolor{comment}{/* 1LSb = 4mg. */}
03189         \textcolor{keywordflow}{if} (thresh > 1020)
03190             thresh\_hw = 255;
03191         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (thresh < 4)
03192             thresh\_hw = 1;
03193         \textcolor{keywordflow}{else}
03194             thresh\_hw = thresh >> 2;
03195 \textcolor{preprocessor}{#endif}
03196 
03197         \textcolor{keywordflow}{if} (!time)
03198             \textcolor{comment}{/* Minimum duration must be 1ms. */}
03199             time = 1;
03200 
03201 \textcolor{preprocessor}{#if defined MPU6500}
03202         \textcolor{keywordflow}{if} (lpa\_freq > 500)
03203             \textcolor{comment}{/* At this point, the chip has not been re-configured, so the}
03204 \textcolor{comment}{             * function can safely exit.}
03205 \textcolor{comment}{             */}
03206             \textcolor{keywordflow}{return} -1;
03207 \textcolor{preprocessor}{#endif}
03208 
03209         \textcolor{keywordflow}{if} (!st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a28c5c373e0d7189a11c4ae5ca351ca30}{int\_motion\_only}) \{
03210             \textcolor{comment}{/* Store current settings for later. */}
03211             \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a49fb51079238683b21264827348b5968}{dmp\_on}) \{
03212                 \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(0);
03213                 st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a49fb51079238683b21264827348b5968}{dmp\_on} = 1;
03214             \} \textcolor{keywordflow}{else}
03215                 st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a49fb51079238683b21264827348b5968}{dmp\_on} = 0;
03216             \hyperlink{group___d_r_i_v_e_r_s_gaf973c32c73ba912ff512aab948fc31ca}{mpu\_get\_gyro\_fsr}(&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.
      \hyperlink{structmotion__int__cache__s_a6424d033f39042e9e1105c14f6fa89d7}{gyro\_fsr});
03217             \hyperlink{group___d_r_i_v_e_r_s_gab6087a15ee23db23b6aec41590329a60}{mpu\_get\_accel\_fsr}(&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.
      \hyperlink{structmotion__int__cache__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr});
03218             \hyperlink{group___d_r_i_v_e_r_s_gaa95c7e216dcb2d888e9796001ca555f8}{mpu\_get\_lpf}(&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a0ba1d4e0bb375eb3050352ddef12d25f}{lpf});
03219             \hyperlink{group___d_r_i_v_e_r_s_ga2487dd551b701c1c7ed4d6335f02b2f1}{mpu\_get\_sample\_rate}(&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.
      \hyperlink{structmotion__int__cache__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate});
03220             st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a90574f8e8515ef8fee3114ba7e0ddc5c}{sensors\_on} = st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.
      \hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors};
03221             \hyperlink{group___d_r_i_v_e_r_s_ga093f11eb10b2639a4b9fe344ea348c54}{mpu\_get\_fifo\_config}(&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.
      \hyperlink{structmotion__int__cache__s_ae3cc01b3471d10bd06f81fbf628f3e19}{fifo\_sensors});
03222         \}
03223 
03224 \textcolor{preprocessor}{#if defined MPU6500}
03225         \textcolor{comment}{/* Disable hardware interrupts. */}
03226         set\_int\_enable(0);
03227 
03228         \textcolor{comment}{/* Enter full-power accel-only mode, no FIFO/DMP. */}
03229         data[0] = 0;
03230         data[1] = 0;
03231         data[2] = \hyperlink{inv__mpu_8c_a4e2ef22b94b90f9b83394dfe1f688ce4}{BIT\_STBY\_XYZG};
03232         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad8384710853dc1f9580b9ff19e87efbc}{user\_ctrl}, 3, data))
03233             \textcolor{keywordflow}{goto} lp\_int\_restore;
03234 
03235         \textcolor{comment}{/* Set motion threshold. */}
03236         data[0] = thresh\_hw;
03237         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a31322df7c5727b98480d1fcb18e040c5}{motion\_thr}, 1, data))
03238             \textcolor{keywordflow}{goto} lp\_int\_restore;
03239 
03240         \textcolor{comment}{/* Set wake frequency. */}
03241         \textcolor{keywordflow}{if} (lpa\_freq == 1)
03242             data[0] = INV\_LPA\_0\_98HZ;
03243         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq == 2)
03244             data[0] = INV\_LPA\_1\_95HZ;
03245         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 5)
03246             data[0] = INV\_LPA\_3\_91HZ;
03247         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 10)
03248             data[0] = INV\_LPA\_7\_81HZ;
03249         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 20)
03250             data[0] = INV\_LPA\_15\_63HZ;
03251         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 40)
03252             data[0] = INV\_LPA\_31\_25HZ;
03253         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 70)
03254             data[0] = INV\_LPA\_62\_50HZ;
03255         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 125)
03256             data[0] = INV\_LPA\_125HZ;
03257         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (lpa\_freq <= 250)
03258             data[0] = INV\_LPA\_250HZ;
03259         \textcolor{keywordflow}{else}
03260             data[0] = INV\_LPA\_500HZ;
03261         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a14a0bff136c827f3f58f619f8045788b}{lp\_accel\_odr}, 1, data))
03262             \textcolor{keywordflow}{goto} lp\_int\_restore;
03263 
03264         \textcolor{comment}{/* Enable motion interrupt (MPU6500 version). */}
03265         data[0] = \hyperlink{inv__mpu_8c_a75b1479e451b747afb3b24cbc4df99f7}{BITS\_WOM\_EN};
03266         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a9c4b97b2bf0f2fcee9538e74fcaf5c3f}{accel\_intel}, 1, data))
03267             \textcolor{keywordflow}{goto} lp\_int\_restore;
03268 
03269         \textcolor{comment}{/* Bypass DLPF ACCEL\_FCHOICE\_B=1*/}
03270         data[0] = \hyperlink{inv__mpu_8c_a51c6f0bce9d0ad115514fd5d343c76e9}{BIT\_ACCL\_FC\_B} | 0x01;
03271         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a4878318dd0c9243015d4963e00b2d954}{accel\_cfg2}, 1, data))
03272             \textcolor{keywordflow}{goto} lp\_int\_restore;
03273 
03274         \textcolor{comment}{/* Enable interrupt. */}
03275         data[0] = \hyperlink{inv__mpu_8c_a6a8f2f7f3dd17bc05d9c6286d15c7ada}{BIT\_MOT\_INT\_EN};
03276         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ab0cc290f4f43cd8a8b6562a97f540493}{int\_enable}, 1, data))
03277             \textcolor{keywordflow}{goto} lp\_int\_restore;
03278 
03279         \textcolor{comment}{/* Enable cycle mode. */}
03280         data[0] = \hyperlink{inv__mpu_8c_a63e6f23af37626aa1498d8c248f259e7}{BIT\_LPA\_CYCLE};
03281         \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_ad746a196c317f0f4d557a92b9eb98d34}{pwr\_mgmt\_1}, 1, data))
03282             \textcolor{keywordflow}{goto} lp\_int\_restore;
03283 
03284         st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a28c5c373e0d7189a11c4ae5ca351ca30}{int\_motion\_only} = 1;
03285         \textcolor{keywordflow}{return} 0;
03286 \textcolor{preprocessor}{#endif}
03287     \} \textcolor{keywordflow}{else} \{
03288         \textcolor{comment}{/* Don't "restore" the previous state if no state has been saved. */}
03289         \textcolor{keywordtype}{int} ii;
03290         \textcolor{keywordtype}{char} *cache\_ptr = (\textcolor{keywordtype}{char}*)&st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache};
03291         for (ii = 0; ii < \textcolor{keyword}{sizeof}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}); ii++) \{
03292             \textcolor{keywordflow}{if} (cache\_ptr[ii] != 0)
03293                 \textcolor{keywordflow}{goto} lp\_int\_restore;
03294         \}
03295         \textcolor{comment}{/* If we reach this point, motion interrupt mode hasn't been used yet. */}
03296         \textcolor{keywordflow}{return} -1;
03297     \}
03298 lp\_int\_restore:
03299     \textcolor{comment}{/* Set to invalid values to ensure no I2C writes are skipped. */}
03300     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_abae9129fae33706b5f73b2b1867fcc89}{gyro\_fsr} = 0xFF;
03301     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr} = 0xFF;
03302     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a0a4067140c6a3704b4312ba62b77aadb}{lpf} = 0xFF;
03303     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate} = 0xFFFF;
03304     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aaa21c01566947e7007476657cb614e3f}{sensors} = 0xFF;
03305     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a1f258910658cfcf4bed56c0de8637441}{fifo\_enable} = 0xFF;
03306     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a2ac4d2f6d885669a21842e13dd3c5241}{clk\_src} = \hyperlink{inv__mpu_8c_a75570f009627c6f4ddfb2d936d81e207a01b240917a78674d3e387110a6a8f94c}{INV\_CLK\_PLL};
03307     \hyperlink{group___d_r_i_v_e_r_s_ga6e77e7cc1cf6be5e8fdf617c5b4586d1}{mpu\_set\_sensors}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a90574f8e8515ef8fee3114ba7e0ddc5c}{sensors\_on});
03308     \hyperlink{group___d_r_i_v_e_r_s_gad09e6031c8677adc0b8a39b6deea8e27}{mpu\_set\_gyro\_fsr}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a6424d033f39042e9e1105c14f6fa89d7}{gyro\_fsr});
03309     \hyperlink{group___d_r_i_v_e_r_s_ga2713a96af104cfb2ae8e0ed4c3718119}{mpu\_set\_accel\_fsr}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a97d5de8aa2fab5cc81ca2180130fc6ac}{accel\_fsr});
03310     \hyperlink{group___d_r_i_v_e_r_s_ga5661a9dee25152166769910767a2a93d}{mpu\_set\_lpf}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a0ba1d4e0bb375eb3050352ddef12d25f}{lpf});
03311     \hyperlink{group___d_r_i_v_e_r_s_ga0144d666a67a82888b8580002afe8b55}{mpu\_set\_sample\_rate}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.
      \hyperlink{structmotion__int__cache__s_a1aa4e026c4d2f691506f2d713a405aea}{sample\_rate});
03312     \hyperlink{group___d_r_i_v_e_r_s_gababbdda287e1f19323489f90a0889dd7}{mpu\_configure\_fifo}(st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.
      \hyperlink{structmotion__int__cache__s_ae3cc01b3471d10bd06f81fbf628f3e19}{fifo\_sensors});
03313 
03314     \textcolor{keywordflow}{if} (st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_aab21a113d97da9c015f6f1928662927b}{cache}.\hyperlink{structmotion__int__cache__s_a49fb51079238683b21264827348b5968}{dmp\_on})
03315         \hyperlink{group___d_r_i_v_e_r_s_ga68ed20e6c9663cd7c50469329af8715f}{mpu\_set\_dmp\_state}(1);
03316 
03317 \textcolor{preprocessor}{#ifdef MPU6500}
03318     \textcolor{comment}{/* Disable motion interrupt (MPU6500 version). */}
03319     data[0] = 0;
03320     \textcolor{keywordflow}{if} (\hyperlink{_i2_c_8c_ac0f145afe8d662af199043939f4398d6}{i2c\_write}(st.\hyperlink{structgyro__state__s_a5bac30a96752691e4cc723735060e360}{hw}->\hyperlink{structhw__s_a4c34a946600e9d68b6355d23f54d291b}{addr}, st.\hyperlink{structgyro__state__s_ae857e1285c583b7438a208edd691a38e}{reg}->\hyperlink{structgyro__reg__s_a9c4b97b2bf0f2fcee9538e74fcaf5c3f}{accel\_intel}, 1, data))
03321         \textcolor{keywordflow}{goto} lp\_int\_restore;
03322 \textcolor{preprocessor}{#endif}
03323 
03324     st.\hyperlink{structgyro__state__s_ac895217592e2084bd520b0be8e9d20ee}{chip\_cfg}.\hyperlink{structchip__cfg__s_a28c5c373e0d7189a11c4ae5ca351ca30}{int\_motion\_only} = 0;
03325     \textcolor{keywordflow}{return} 0;
03326 \}
03327 
\end{DoxyCode}
